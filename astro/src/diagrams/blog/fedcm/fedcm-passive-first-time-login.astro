---
import Diagram from "../../../components/mermaid/SequenceDiagram.astro";
const { alt } = Astro.props;

//language=Mermaid
const diagram = `
sequenceDiagram
    participant Browser
    participant WebApp as Relying Party
    participant AuthProvider as IdP 

    Browser->>WebApp: 1. Navigate to protected resource
    WebApp->>Browser: 2. Redirect to login page<br/>including FedCM API JavaScript
    Browser->>Browser: 3. Calls FedCM API on page render
    Browser->>AuthProvider: 4. Makes requests to standard endpoints to <br/>determine configuration, support, use accounts, and relying party 
    Browser->>Browser: 5. Determines user is logged out
    Browser->>AuthProvider: 6. Requests login URL,<br/>prompting user to log in
    AuthProvider->>Browser: 7. Sends login page
    Browser->>AuthProvider : 8. Submits credentials
    AuthProvider->>AuthProvider : 9. Verifies credentials
    AuthProvider->>Browser: 10. Returns requested data
    Browser->>Browser: 11. FedCM API Call Succeeds
    Browser->>WebApp: 12. Presents token 
    Note over WebApp: Token received, end of FedCM dictated interaction
    WebApp->>WebApp: 13. Validate token using JWKS or other means
    WebApp->>WebApp: 14. Create user session
        WebApp->>Browser: 15. Redirect to protected resource
        Browser->>WebApp: 16. Access protected resource
        WebApp->>Browser: 17. Return protected content
`;
---
<Diagram code={diagram} alt={alt} />

