---
import Diagram from "../../../components/mermaid/SequenceDiagram.astro";
const { alt } = Astro.props;

//language=Mermaid
const diagram = `
sequenceDiagram
    participant Browser as User Agent
    participant WebApp as Relying Party
    participant AuthProvider as IDP 

    Browser->>WebApp: 1. Navigate to protected resource
    WebApp->>Browser: 2. Redirect to login page<br/>including FedCM API JavaScript
    Browser->>Browser: 3. Calls FedCM API on page render
    Browser->>AuthProvider: 4. Makes requests to standard endpoints to <br/>determine configuration, support, use accounts, and relying party 
    AuthProvider->>Browser: 5. Returns requested data
    Browser->>Browser: 6. FedCM API Call Succeeds
    Browser->>WebApp: 7. Presents token 
    Note over WebApp: Token received, end of FedCM dictated interaction

    WebApp->>WebApp: 8. Validate token using JWKS or other means
    WebApp->>WebApp: 9. Create user session
        WebApp->>Browser: 9. Redirect to protected resource
        Browser->>WebApp: 10. Access protected resource
        WebApp->>Browser: 11. Return protected content

`;
---
<Diagram code={diagram} alt={alt} />

