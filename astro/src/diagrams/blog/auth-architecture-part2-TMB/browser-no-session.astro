---
import Diagram from "../../../components/mermaid/SequenceDiagram.astro";
const { alt } = Astro.props;

//language=Mermaid
const diagram = `
sequenceDiagram

	%%{init:{"themeVariables": { "noteBkgColor":"transparent", "noteTextColor":"transparent", "noteBorderColor":"transparent" }}}%%
	participant B as Browser
	participant T as TMB
	participant A as Authorization Endpoint <br/>(FusionAuth)
	participant O as Token Endpoint <br/>(FusionAuth)
	participant R as Resource server

	B->>T: Is there an active session?
	T->>B: No

	B->>T: Start Authorization Code flow with PKCE extension
	B->>A: Redirected to log in on this web page
	A->>B: Returns authorization code
	B->>T: Send code
	T->>O: Send PKCE verifier and code
	O->>T: Return refresh token and access token
	T->>B: Return access token and session cookie

	B->>R: Make a purchase (include access token)
`;
---
<Diagram code={diagram} alt={alt}/>

