---
import Diagram from "../../../components/mermaid/SequenceDiagram.astro";
const { alt } = Astro.props;

//https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowSteps
//language=Mermaid
const diagram = `
sequenceDiagram

  participant u as User/Browser
  participant rp as Relying Party
  participant op as OpenID Provider
  
  u ->> rp : Request protected resource<br /> requiring authentication
  rp ->> rp : Prepare authentication request
  rp ->> u : Redirect to OpenID Provider (OP)
  u ->> op : Sends request 
  op ->> op : Authenticates the user
  op ->> op : Obtains consent from the user
  op ->> rp : Sends one-time authorization code
  rp ->> op : Exchanges one-time authorization code<br/>and other info
  op ->> rp : Sends tokens
  rp ->> rp : Validates Id token
  rp ->> u  : Sends requested resource
`;
---
<Diagram code={diagram} alt={alt}/>
