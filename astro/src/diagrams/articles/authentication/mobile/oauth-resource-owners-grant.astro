---
import { Diagram, type Config } from "astro-diagram";
import * as include from "./_includes.astro";

const config = {
  boxMargin: 30,
  messageMargin: 5000,
  mirrorActors: true,
  noteMargin: 5,
  wrap: true
} as Config;

const oauth = `
sequenceDiagram
  autonumber
  ${include.participants}
  ${include.intro}

  Note over Mobile,Hacker: Login (inside Mobile App)
  Mobile->>Store: POST /api/login
  Store->>FusionAuth: POST /oauth2/token<br/>(grant_type=password)
  FusionAuth->>Store: (Refresh Token and JWT)
  Store->>Mobile: (Refresh Token and JWT)

  ${include.shoppingCartLoad}
  
  ${include.shoppingCartRefresh}
  
  ${include.shoppingCartRelogin}
  
  ${include.mobileAttack}
  
  ${include.stolenJWT}
  
  ${include.stolenRefresh}
`;
---

<style is:global>
  #diagram g:nth-child(17) .note, #diagram g:nth-child(19) .note {
    fill: #fecaca !important;
    stroke: #f87171 !important;
  }
  .dark #diagram g:nth-child(17) .note, .dark #diagram g:nth-child(19) .note {
    fill: #f87171 !important;
    stroke: #fecaca !important;
  }
</style>

<Diagram code={oauth} config={config}/>
