---
publish_date: 2025-12-01
title: "Analyzing why customers leave — cohort analysis in FusionAuth"
description: ""
authors: Person McPersonface
image: /img/blogs/header-example.svg
categories: Education
tags: user, analysis, retention
excerpt_separator: "{/* more */}"
---

import Aside from 'src/components/Aside.astro';
import Breadcrumb from 'src/components/Breadcrumb.astro';
import InlineField from 'src/components/InlineField.astro';
import InlineUIElement from 'src/components/InlineUIElement.astro';

- [Introduction](#introduction)
- [FusionAuth Native Reports](#fusionauth-native-reports)
- [An Overview Of Cohort Analysis](#an-overview-of-cohort-analysis)
- [Understanding Additional User Charts](#understanding-additional-user-charts)
  - [Total Users Charts](#total-users-charts)
  - [User Acquisition Charts](#user-acquisition-charts)
  - [User Age Chart](#user-age-chart)
  - [Logins Per Year Charts](#logins-per-year-charts)
  - [Percent Logins Per Year Charts](#percent-logins-per-year-charts)
  - [Abandonment Charts](#abandonment-charts)
  - [Activity Cohort Chart](#activity-cohort-chart)
  - [Returning Users Chart](#returning-users-chart)
  - [Friction Chart](#friction-chart)
  - [Login Frequency Chart](#login-frequency-chart)
  - [Cohort Analysis Chart](#cohort-analysis-chart)
- [How To Run The Chart Code For Your FA Instance](#how-to-run-the-chart-code-for-your-fa-instance)
  - [Extract Customer Data](#extract-customer-data)
- [Calculate And Display The Charts](#calculate-and-display-the-charts)
- [Summary](#summary)
- [Appendix — How To Create Fake Customer Data In FA](#appendix--how-to-create-fake-customer-data-in-fa)
- [todo](#todo)


## Introduction

Do you know how frequently your customers use your app? Do you know how many people sign up but quickly lose interest in your service? In this article, you'll learn how to use FA to track customer statistics: retention rates, customer age analysis, and customer cohorts (groups). While you need to investigate your own application database for reasons *why* customers stay or leave, having a base of FA login stats to work from lets you know who to analyze.

## FusionAuth Native Reports

FA has a few built-in charts with views of total logins and registrations in the <Breadcrumb>Reports</Breadcrumb> section.

![Existing FA charts](../../../../astro/public/img/blogs/cohort-analysis/faCharts.webp)

FA provides several simple charts:

- Number of logins: Per application, time period, and user
- Number of registrations: Per application and time period
- Number of daily active users: Per application and time period
- Number of monthly active users: Per application and time period

Unfortunately more complex charts aren't possible directly in FA because they are overly time-consuming to calculate. If you want more informative charts, you need to export your data and calculate statistics manually. This guide will you show how to do that.

If you then want even deeper analysis on a regular basis, you to dive into the world of business intelligence (BI): data extraction, denormalization, and dashboards.

## An Overview Of Cohort Analysis

Cohort analysis is a behavioral analytics technique that groups users by shared characteristics or experiences within a period. You can then track the actions of each group over time.

There are three concepts involved in an analysis:

- **Cohort:** A group of users who performed a specific action (like registration) within a specific timeframe (a day, week, or month).
- **Metric:** The behavior you are measuring, such as logins, purchases, or feature usage.
- **Time Horizon:** The period over which you track that metric (Day 0, Day 1, Week 4, etc.).

Cohort analysis is useful to distinguish between **growth** and **retention**. A product might have 10,000 active users, which looks healthy. However, cohort analysis might reveal that 9,000 of those users registered this month, while only 5% of users from six months ago ever returned. This indicates an abandonment problem, where you are successfully acquiring users but failing to keep them.

There are two types of cohorts:

- **Acquisition cohorts:** Groups defined by *when* they joined. This is the most common type and helps identify if newer versions of your product are better at retaining users than older versions.
- **Behavioral cohorts:** Groups defined by *what they did*. For example, you might compare a cohort of users who uploaded a profile picture in their first hour versus a cohort that didn't.

Since this article focusses only on FA, or any other authentication gateway you use, the only data you have are registration and login dates, not purchases or features. Thus, behavioral cohorts are not covered here.

## Understanding Additional User Charts

This guide is accompanied by code that creates charts from your FA user registration and login data. This section explains how to use each chart. In the next section, you'll learn how to run the code.

The charts below were created from a thousand random users with random registration and login dates, so you won't see realistic patterns, but they're enough to illustrate the concepts. Some charts are for cohorts, but the dashboard starts with some useful general charts first.

### Total Users Charts

![Total users charts](../../../../astro/public/img/blogs/cohort-analysis/chartTotalUsers.webp)

The total user charts show the number of users that joined your service. This allows you to see if your business is growing as well as you expect. Users who are registered but are no longer active are not shown here. So you need to compare total users with user activity and abandonment metrics (shown later).

This chart, like many others, separates users into those that verified themselves (confirming their email address) and those that did not. Unverified users can act like an outlier in your data, distorting your statistics. But it's still useful to know how many there are, and to try ways of encouraging users to verify.

### User Acquisition Charts

![New users charts](../../../../astro/public/img/blogs/cohort-analysis/chartNewUsers.webp)

A user acquisition chart is useful to see if any advertising campaigns, or new features, have attracted new users. Be aware that there might be a time delay between your marketing effort and the number of new registrations. You can also investigate any spikes (such as in the middle of 2018) or dips in the chart and see if there was any extra conversation about your business online, or complaints about competitors.

This chart doesn't show if the users actually use your service after registering — it's user acquisition not user retention.

### User Age Chart

![Years since registered chart](../../../../astro/public/img/blogs/cohort-analysis/chartYearsSinceRegistered.webp)

The age chart groups users into the number of years they have used your service. It's an indication of how much experience the average user has with your business.

Notice that this chart is the mirror image of the new users per year chart.

### Logins Per Year Charts

![Logins per year and month charts](../../../../astro/public/img/blogs/cohort-analysis/chartLoginsPerYear.webp)

The logins per year and month show how active your users are. These charts, and some of the later charts, depend on the expiry duration of your login tokens. Longer expiry times mean that users login less frequently. You can adjust the sample code to analyze a period that makes sense for your configuration.

Sometimes it's more meaningful to work with deduplicated logins for a period. In other words, if a user logins more than once in a year or month, they are counted as logging in only once in that period. This prevents the service appearing more used than it actually is, by a small fraction of users who log in frequently.

### Percent Logins Per Year Charts

![Percent logins per year and month charts](../../../../astro/public/img/blogs/cohort-analysis/chartPercentLoginsPerYear.webp)

The percent login charts are a more useful version of the previous charts. Here the value shown is a ratio of logins to number of users. In 2025 you can see just less than half, 0.45, of users are actively using your service. The increasing trend of usage over time indicates this example business has shown increasing value to customers.

### Abandonment Charts

![Abandonment charts](../../../../astro/public/img/blogs/cohort-analysis/chartAbandonment.webp)

The first abandonment chart is the opposite of user activity. Here you see how many users haven't logged in for 1, 2, 6, or more than 12 months. The majority (over 500 out of 1000 users) haven't logged in for at least a year.

While the first chart is a static metric calculated today, the second abandonment chart shows the trend of users who haven't logged in for at least six months, per year. You can see this amount is steadily increasing over time. This contradicts the activity chart shown earlier, which said that users are logging in *more* each year. This apparent contradiction is because the activity chart was relative (percent of users) and the abandonment chart is absolute (number of users). Depending on which statistic is more useful to you, you can change any absolute chart in the code to a relative chart by dividing the annual value by the number of users in that year. The total number of users is found in `totalUsersPerYearChart.verifiedData` and `totalUsersPerYearChart.unverifiedData`.

### Activity Cohort Chart

![2025 logins chart](../../../../astro/public/img/blogs/cohort-analysis/chart2025Logins.webp)

The activity cohort chart groups users by how frequently they use the service. Here you can see most registered users don't login at all. There is a large number who logged in up to four times in the last year (you should change the period to match your business and token expiry duration). And there is a barely a handful of dedicated users who log in more than four times a year.

Like the abandonment chart and other cohort charts, you should take some sample users in each group and investigate which features they use, to determine which parts of your business offer the most value to customers and keeps them engaged.

### Returning Users Chart

![Returning users chart](../../../../astro/public/img/blogs/cohort-analysis/chartReturningUsers.webp)

The returning users chart shows how many users log in after at least a year of not using your service. If you notice any clear spikes, it might correlate to the release of a new version or feature, a marketing campaign you ran, or customers leaving a competitor. This is similar to the analysis in the user acquisition chart, but for customers who are already familiar with your offering and are coming back to give you another try.

### Friction Chart

![Friction chart](../../../../astro/public/img/blogs/cohort-analysis/chartFriction.webp)

The friction chart groups users by how long it takes them to log in the first time after registering. It shows both how easy the registration to usage flow is (low friction), and how much the registration process interests the users in actually using your offering. If they realise while registering that your service isn't what they're really looking for, the time until they login might be never.

This example chart shows that nearly all users do login, which is good and indicates high interest, but only after a month, which means the business should make it easier for users to explore the service after registering.

### Login Frequency Chart

![Login frequency chart](../../../../astro/public/img/blogs/cohort-analysis/chartLoginFrequency.webp)

A login frequency chart groups users by the number of times they logged in in the past month. You want this chart to be as far to the right as possible.

In this example, you can see the vast majority of users didn't log in at all. This business is not currently healthy.

This chart is also known as the L30 chart or Power User Curve.

### Cohort Analysis Chart

![Cohort analysis chart](../../../../astro/public/img/blogs/cohort-analysis/chartHeatmap.webp)

The cohort analysis chart is a heatmap that shows user retention over the following year, per month. The x-axis shows the number of months after registration, from 0 to 12. The y-axis shows the month of registration. Pick any row (point on the y-axis) and read the chart from left to right. You'll see how many users log in in the first month after they register, after the second month, and so on. You'll likely see most users log in a lot in the first month or two, and slowly decline in logins over the next twelve months. If the decline tends towards zero however, then your service doesn't provide long-term value to customers.

The y-axis is valuable because it shows you if your business is getting better or worse at retaining customers over time. In this example, you can see the business has become better with retention over time as there are darker colors higher in the chart. (But in this hypothetical example, the increase is just because users with later registration dates have to squeeze more random login dates into less time).

## How To Run The Chart Code For Your FA Instance

Let's look at how to create the charts above for your business. All you need is [Docker](https://www.docker.com/get-started). If you prefer not to use Docker, you need to have [Go](https://go.dev/doc/install) installed and a PostgreSql client (like the free IDE [DBeaver](https://dbeaver.io/download/)).

You also need to have an instance of FusionAuth with data you want to analyze. If you don't have any data yet, you can use the code in the addendum to create test data.

### Extract Customer Data

While application databases, like FA, store data in a denormalized structure to save space, data analysis needs data to be normalized for fast retrieval and computation.

The first step to analyze your user data in FA is to extract it and store it in a usable format. As this process puts the database under load, you should run it on a copy of your database using a separate FA instance.

Use git to clone the [accompanying repository](https://github.com/ritza-co/fusionauth-user-charts), or download and unzip it.

```sh
git clone https://github.com/ritza-co/fusionauth-user-charts.git
cd fusionauth-user-charts
```

Edit the file `3extract.go` and update the constants near the top to match your FusionAuth URL, API key, and application Id.

To run the extraction with Docker, use the command below.

```sh
docker run --init  -it  --rm --platform linux/amd64 --name "app" --network faNetwork -v .:/app -v ./gocache:/go/pkg -v ./buildcache:/root/.cache/go-build -w /app golang:1.25-bookworm sh -c "go run 3extract.go"
```

The only parameter you need to change is `--network faNetwork`. Ensure that your FusionAuth instance is running on the same network as the extraction code (`localhost` won't work in Docker), or if you run FusionAuth remotely you can remove the network parameter entirely.

If you installed Go directly on your computer, you can run the command below instead of using Docker.

```sh
go run 3extract.go
```

The extraction creates two files, `faUsers.json` containing the raw data from FA, and `users.json` containing the processed set of users with all login dates.

The `users.json` file has structure below.

```js
  [{
    id: string
    email: string
    isVerified: bool
    registeredDate: string // timestamp since 1970
    loginDates: string[] // oldest dates first
  }]
```

<Aside type="warning">
If you have more than 999999 users, you will need to edit `numberOfResults=999999` in the script and extract your users in batches, then concatenate the JSON files.
</Aside>

## Calculate And Display The Charts

The last step is to run the webserver that displays the charts.

TODO run code


## Summary

## Appendix — How To Create Fake Customer Data In FA

To create an FA application with fake users and login data you need to run a JS and SQL script.

Create a file called `fake.mjs` containing the code below. It will register 10 000 new users when run.

```js
async function registerUsers(num) {
  for (let i = 1; i <= num; i++) {
    try {
      const response = await fetch('http://fa:9011/api/user/registration', {
        method: 'POST',
        headers: {
          Authorization: '33052c8a-c283-4e96-9d2a-eb1215c69f8f-not-for-prod',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          user: { email: `${i}@example.com`, password: 'password' },
          registration: { applicationId: 'e9fdb985-9173-4e01-9d73-ac2d60d1dc8e' }
        })
      });
      if (!response.ok) {
        const errorBody = await response.text();
        console.log(`httpError ${response.status} for user ${i}@example.com: ${errorBody}`);
        return;
      }
      const result = await response.json();
      console.log(JSON.stringify(result));
    } catch (error) {
      console.log(`networkError for user ${i}@example.com: ${(error).message}`);
    }
    console.log('');
  }
}

await registerUsers(10000);
```

Adjust the URL, authorization key, and application Id in the code above to match your FA instance. Then run the file with the command below.

```sh
node fake.mjs
```

If you don't have Node installed, or want to avoid running code directly on your computer, you can use Docker with the command below. (If you're running FA on your local machine, you need to put FA and the command on the same `--network`.)

```sh
docker run --init  -it --rm --name "app" -v ".:/app" -w "/app" --network faNetwork node:24.12.0-slim sh -c  "node fake.mjs";
```

Once the users are created, you need randomize their registration dates, set 5% of user email addresses to unverified, and create thousands of login dates. This can't be done with the FA API, so you need to run SQL directly on the PostgreSQL FA database.

Run the SQL below.

```sql
-- randomize registration dates. a day from 2015 to 2025
UPDATE user_registrations SET insert_instant =
    EXTRACT(EPOCH FROM (
        '2015-01-01'::DATE + (FLOOR(('2025-12-31'::DATE - '2015-01-01'::DATE) * random()))::INT
    )::TIMESTAMP WITHOUT TIME ZONE)::BIGINT;

-- check dates if you want
-- SELECT * FROM user_registrations

-- set 5% users to unverified
UPDATE identities
SET verified = CASE
    WHEN random() < 0.05 THEN false
    ELSE true
END
WHERE identities.is_primary = true;

UPDATE identities
SET verified_reason = 5
WHERE identities.is_primary = true;

-- add login dates
WITH user_min_instant AS (
    SELECT
        user_registrations.users_id,
        MIN(user_registrations.insert_instant) AS minInstant
    FROM
        user_registrations
    GROUP BY
        user_registrations.users_id
),
users_with_series AS (
    SELECT
        users.id AS usersId,
        user_min_instant.minInstant,
        generate_series(1, (1 + floor(random() * 4991))::INTEGER) AS seriesNum -- 10 to 5000 logins
    FROM
        users
    JOIN
        user_min_instant ON users.id = user_min_instant.users_id
)
INSERT INTO raw_logins (applications_id, instant, ip_address, identities_value, identities_type, users_id)
SELECT
    'e9fdb985-9173-4e01-9d73-ac2d60d1dc8e',
    (users_with_series.minInstant + FLOOR(
        (EXTRACT(EPOCH FROM '2026-01-01 00:00:00Z'::timestamp) - users_with_series.minInstant) * random()
    ))::BIGINT,
    '127.0.0.1',
    NULL,
    NULL,
    users_with_series.usersId
FROM
    users_with_series;

-- delete logins for unverified users
delete from raw_logins
where users_id in (select users_id from identities WHERE is_primary=true and verified=false)
```

## todo

use go instead of js
fa

https://github.com/FusionAuth/fusionauth-site/issues/2990 - cohort analysis
