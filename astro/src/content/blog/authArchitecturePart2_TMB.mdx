---
publish_date: 2025-10-08
title: "Token-mediating backend: An alternative to the BFF architecture"
htmlTitle: "Part 2 of 3 on authentication architecture | FusionAuth"
description: "Learn how a token-mediating backend (TMB) is less secure than a BFF, and when to use it. Part 2 of 3 in the architecture-driven auth series."
image: /img/blogs/bff/bff-header.png # TODO: replace image
authors: Kim Maida
categories: Education, Security
tags: oauth, security, BFF, TMB, React, tokens, architecture, FusionAuth
excerpt_separator: "{/* more */}"
---

import {RemoteCode} from '@fusionauth/astro-components';
import Aside from 'src/components/Aside.astro';
import Breadcrumb from 'src/components/Breadcrumb.astro';
import InlineField from 'src/components/InlineField.astro';
import InlineUIElement from 'src/components/InlineUIElement.astro';
import PremiumPlanBlurb from 'src/content/docs/_shared/_premium-plan-blurb.astro';

{/* Search for TODO before publishing this, like links. */}

- [Introduction](#introduction)
- [What is a Token-Mediating Backend?](#what-is-a-token-mediating-backend)
- [How secure is a TMB?](#how-secure-is-a-tmb)
- [When to use a TMB?](#when-to-use-a-tmb)
- [Getting technical: how the TMB flow works](#getting-technical-how-the-tmb-flow-works)
- [Code demonstration](#code-demonstration)
	- [Prerequisites](#prerequisites)
	- [Run the app](#run-the-app)
	- [How it works](#how-it-works)
- [Summary](#summary)
- [Read part 3](#read-part-3)
- [Links](#links)
- [todo](#todo)


## Introduction

This post discusses the token-mediating backend (TMB) authentication architecture for OAuth 2 apps: how secure it is, when to use it, and how to implement it.

<Aside type="tip">
This is part two of a three part series on OAuth architectures. Please read [part one](/TODO), if you haven't already, so you understand how the BFF architecture works, since TMB is a variation of BFF.
</Aside>

## What is a Token-Mediating Backend?

The TMB is identical to the BFF pattern, except for one difference: access tokens are stored in the frontend (desktop app, mobile app, or web app) instead of in the backend. (Remember that the access token is the secret that gives a client permission to call a resource server). Since the access token is now available in the browser, the browser can call a resource server directly, instead of having to call the backend and get the backend to call the resource server with the token.

TMB is described in the IETF document on [best practices for OAuth apps](https://datatracker.ietf.org/doc/html/draft-ietf-oauth-browser-based-apps#name-token-mediating-backend).

## How secure is a TMB?

TMB is massively less secure than BFF (since access tokens in the browser are vulnerable to malicious JavaScript packages and cross-site scripting (XSS)), but massively more secure than serverless web apps (browser-based OAuth clients (BBOC)), which have no secure backend at all.

You can think of the security advantages as: BFF ≫ TMB ≫ BBOC.

TMB has two of the security advantages of BFF:
- Same-site HTTP-only session cookies prevent CSRF attacks.
- Refresh tokens stay on the server, hidden from attackers.

But TMB has a significant disadvantage. First, note that the access token in the browser can't be kept in an HTTP-only cookie, because JavaScript needs to access it to send it in calls to resource servers (which have different URL domains to the authorization server domain).

Since the access token has to be stored in the browser's local storage, it's vulnerable in all the ways discussed in part 1:
- Malicious npm JavaScript packages can access the token.
- Cross-site scripts (e.g. unsanitized HTML from forum posts on your site) can access the token.

A TMB is still more secure than a BBOC because of the server-side refresh token — if you follow best practices.

You can set the expiry period of your access tokens to be very short (ten minutes), so that if an attacker does gain access to the token, they can't use it for long. The frontend can silently ask the server for a new access token generated from the server-side refresh token every ten minutes, so the user does not need to log in again. Or, for security-critical apps like banking, you can require the user to log in again every time their access token expires.

Of course, if an attacker has managed insert malicious JS into your frontend, they can steal the access tokens again and again, so timeouts won't protect you.

For a list of best practices to mitigate the danger of client-side token storage, read the recommendations by the the IETF in the [OAuth 2.1 draft](https://datatracker.ietf.org/doc/html/rfc9700/), or this [summary](https://maida.kim/oauth2-best-practices-for-developers) by a FusionAuth developer.



- Successful attacks are short-lived if you follow best practices (link to OAuth 2.1 draft and explain, with summary link to ), which include short timeouts on tokens.

## When to use a TMB?
- Only if you cannot, or may not, call a resource server through a proxy (backend) server and must call it through the frontend directly. (Can't think of an example of this, I must go find or LLM one)

The spec only says this:

> When considering a token-mediating backend architecture, it is strongly recommended to evaluate if adopting a full BFF as discussed in Section 6.1 is a viable alternative. Only when the use cases or system requirements would prevent the use of a proxying BFF should the token-mediating backend be considered over a full BFF.

Performance and latency costs could be a reason not to, such as in use cases like game or video streaming and realtime stuff (like collaboration tools like Figma).

Infrastructure can also impact this... like PaaS that are meant to deploy static sites.

But honestly, the one that would probably affect the most people is that, if you're using a third party auth server, many of them use TMB out of the box.


- Aside, FA uses BFF by default, with easy to use hosted backend; perhaps with link to first article’s section on BFF-HB benefits
- Even if your auth provider SDK doesn't provide a hosted backend it's still trivial to create a BFF in a tiny page of JS (see my article here https://fusionauth.io/blog/backend-for-frontend#how-to-create-a-bff-for-a-serverless-app and code here https://github.com/FusionAuth/fusionauth-example-hostedbackend/blob/main/nodeApp/app.js)

## Getting technical: how the TMB flow works
- This section explains the TMB oauth flow
- You can skip it and proceed to the demo in the next section if you don't need to implement or understand the details yourself
- First review the BFF flow in part 1
- Explanation the differences with an example login and resource call, include a diagram
- Potential attacks noted

## Code demonstration
- The section will allow you to run a simple but functional TMB web app and server with FA to see how it works
### Prerequisites
- Docker, Node/Bun/Deno
### Run the app
- Download, configure, run, login, usernames and passwords, screenshots
### How it works
- Briefly describe what's in each file

## Summary
- Brief repeat of the 'when to use section' because of the 'how secure' section.
- Link to FA hosted backend

## Read part 3
- Brief description of what's in that article

## Links

- niel bff article - https://github.com/FusionAuth/fusionauth-site/pull/3942
- my old article with diagrams to reuse - https://fusionauth.io/blog/backend-for-frontend
- kim talk - https://drive.google.com/file/d/1B40E5zmVHaGfE9kEMAbOWRy3YS2D2EcC/view?pli=1
- kim's 3 part brief - https://docs.google.com/document/d/1FZzTzodOd9YQOCVKhi4V46LiUPbRvnsy2XQ5dTC0mg0/edit?tab=t.0
- kim repo - https://github.com/kmaida/auth-architecture
- kim article on oauth best practices - https://maida.kim/oauth2-best-practices-for-developers/
- kim's outline feedback - https://github.com/FusionAuth/fusionauth-site/pull/3949/files
- IETF document on [best practices for OAuth apps](https://datatracker.ietf.org/doc/html/draft-ietf-oauth-browser-based-apps#name-token-mediating-backend)
- [OAuth 2.1 draft](https://datatracker.ietf.org/doc/html/rfc9700/)
- [summary](https://maida.kim/oauth2-best-practices-for-developers)


## todo
read IETF document on [best practices for OAuth apps](https://datatracker.ietf.org/doc/html/draft-ietf-oauth-browser-based-apps#name-token-mediating-backend)
fa - fusionauth
remove temp niel 1 article
rename article with -
remove unused imports
use fa widget instead of docker?