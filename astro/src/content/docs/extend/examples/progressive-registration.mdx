---
title: Progressive Registration
description: Learn how to use FusionAuth's advanced self-service registration forms.
navcategory: developer
section: extend
subcategory: examples
---

import InlineField from 'src/components/InlineField.astro';
import Breadcrumb from 'src/components/Breadcrumb.astro';
import InlineUIElement from 'src/components/InlineUIElement.astro';
import PremiumPlanBlurb from 'src/content/docs/_shared/_premium-plan-blurb.astro';




Registration is one of the most important parts of authentication. Getting as much information as possible during registration is crucial for your app, especially if you are working with critical fields or need additional data.


However, UX is essential, and bombarding potential users with multiple fields negatively affects the experience. FusionAuth provides a feature for progressive registration, where users can enter information incrementally across various pages or components. This can be configured using the FusionAuth admin dashboard or API.


In this guide, you will learn how to implement progressive registration in your application. We will explore two methods to achieve this, either through the admin dashboard or the FusionAuth API.


## Requirements

To implement progressive registration, you will need a [FusionAuth license](/docs/get-started/core-concepts/licensing) to access advanced registration features

<PremiumPlanBlurb />

This guide is based on the [ChangeBank](https://github.com/FusionAuth/fusionauth-quickstart-javascript-express-web) application, which will be extended to
include progressive registration. However, the steps apply to any application, and can be tailored to your applicationâ€™s specific requirements.


The ChangeBank application uses a kickstart configuration to set up an API key `33052c8a-c283-4e96-9d2a-eb1215c69f8f-not-for-prod` and a FusionAuth application with the name `ExampleNodeApp`.


## Implementing the Registration Flow


The registration flow in this guide will go in two steps:

- The user will be presented with a form to enter their basic information such as first name, last name, and email.
- The user will then be presented with a form to enter their password and register completely.


The challenge here is how to manage the routing to the home page, even more, when you might need the user to enter specific information, on the home page
after a successful registration. This can be, for example, entering a credit card number or being prompted to create an entity such as a project
or anything else that might be required to use the application. In this guide, we will prompt the user to enter an address and then redirect him to the Make Change page.


The next steps will cover two methods to achieve this, using the FusionAuth admin dashboard or the FusionAuth API.


## Using FusionAuth Admin UI


Using the FusionAuth admin dashboard, you can create a registration form that will be used to collect the basic information like name and email, and then a second form
that will be used to collect the password and complete the registration.

If you are following along with the ChangeBank application login to your FusionAuth admin dashboard at http://localhost:9011/admin with email `admin@example.com` and password `password`. Navigate to <Breadcrumb>Reactor</Breadcrumb> and activate your license.

Once you have activated a license for your FusionAuth instance, you can create an advanced registration form by navigating to
<Breadcrumb>Customizations -> Forms</Breadcrumb>. On this page, click on the <InlineUIElement>Add</InlineUIElement> button. On the form that appears set the <InlineField>Name</InlineField>  value to `Registration Form` (it can be arbitrary)
, for the <InlineField>Type</InlineField> select `Registration` .


<img src="/img/docs/extend/progressive-registration/form-name-type.png" alt="Form name and type"/>


Continue to add the fields you want to collect under the <Breadcrumb>Form Steps</Breadcrumb> section. Click the <InlineUIElement>+ Add Step</InlineUIElement> button to add the first step. For Step 1, add a field for the <InlineField>First name</InlineField>, a field for the <InlineField>Last name</InlineField>,
and a field for the <InlineField>Email</InlineField>. The second step will be used to collect the password and complete the registration. Click the <InlineUIElement>+ Add Step</InlineUIElement> button to add the Step 2 and on this step add a <InlineField>Password</InlineField> field. Click the <InlineUIElement>Save</InlineUIElement> button to save.


<img src="/img/docs/extend/progressive-registration/form-steps-fields.png" alt="Form fields"/>


After creating the registration form, you will need to do two things:

- First, enable self registration on your FusionAuth application by navigating to <Breadcrumb>Applications -> Your Application -> Select -> Edit -> Registration</Breadcrumb>. Under Self-service registration toggle the <InlineField>Enabled</InlineField> switch, for the <InlineField>Type</InlineField> select `Advanced` and select the registration form you just created as the form
to use for registration.


<img src="/img/docs/extend/progressive-registration/form-steps-enable-self-registration.png" alt="Enable self registration"/>


- Configure a wildcard on the Authorized redirect URLs under the <Breadcrumb>OAuth</Breadcrumb> tab. Ensure that the URL validation setting is configured to `Allow wildcards`. This wildcard will be used
to know if the user is coming from the registration page or not. Add an entry to the <InlineField>Authorized redirect URLs</InlineField> with value `http://localhost:8080/oauth-redirect?source=*` and save the changes.


<img src="/img/docs/extend/progressive-registration/form-steps-authorized-redirect-urls.png" alt="Authorized redirect URLs"/>


Once this is done, you can view the details about your application, and you will see the registration URL.


<img src="/img/docs/extend/progressive-registration/form-steps-registration-url.png" alt="Registration URL"/>


Great! You can now move on to integrating this registration form into your ChangeBank application.


### Integrating the Registration Form

Here is the current look of the home page of the ChangeBank application accessible at http://localhost:8080:

<img src="/img/docs/extend/progressive-registration/home-page.png" alt="Home page"/>

The ChangeBank application does not have a registration form, and also logic to handle registration. You will need to:

- Add a button to the navigation bar to redirect the user to the registration form.
- Add a route to handle the registration and add logic blocks to the handler of the `/oauth-redirect` route to ensure the user is redirected to the correct page after login or registration.


#### Adding a Button to the Navigation Bar


First, you will add a button to the navigation bar. This button will redirect the user to the registration form. In the `complete-application/src/template/home.html` file, add a new button next to the login button.


```html
<div style="display: flex; justify-content: space-between; width: 28%;">
   <a class="button-lg" href="/register">Register</a>
   <a class="button-lg" href="/login">Login</a>
</div>
```


Clicking on the <InlineUIElement>Register</InlineUIElement> button will redirect the user to the registration form.


<img src="/img/docs/extend/progressive-registration/register-button.png" alt="Register button"/>


The next step is to add a route to handle the registration, `/register`. This route will construct the
URL for redirection to the FusionAuth registration page. We can add this route in the `complete-application/src/index.ts` file.


```ts
app.get('/register', (req, res, next) => {
 const userSessionCookie = req.cookies[userSession];

 // Cookie was cleared, just send back (hacky way)
 if (!userSessionCookie?.stateValue || !userSessionCookie?.challenge) {
   res.redirect(302, '/');
 }

 res.redirect(302, `${fusionAuthURL}/oauth2/register?client_id=${clientId}&response_type=code&redirect_uri=http://localhost:${port}/oauth-redirect?source=register&state=${userSessionCookie?.stateValue}&code_challenge=${userSessionCookie?.challenge}&code_challenge_method=S256&source=register`)
});
```


The `fusionAuthURL` is the URL of the FusionAuth instance. The `clientId` is the Client Id of the ExampleNodeApp application set up in FusionAuth by the kickstart configuration. The `port` is the port of the Express application.


The `res.redirect` will redirect the user to the FusionAuth registration page. The `source` parameter will be used in the `oauth-redirect` route handler to know if the user is coming from the registration page or not.


When saved, you should see a registration page in two steps. The first step will be to enter the basic information.


<img src="/img/docs/extend/progressive-registration/registration-form-first-step.png" alt="Registration form first step"/>


The second step will be to enter the password and complete the registration.


<img src="/img/docs/extend/progressive-registration/registration-form-second-step.png" alt="Registration form second step"/>




#### Adding Logic Blocks to the Handler of the `/oauth-redirect` Route


In the `complete-application/src/index.ts` file, the `/oauth-redirect` route handler will be modified to handle the registration. Currently, the route handler
captures parameters from the URL, validates these parameters, attempts to retrieve a JWT token, and attempts to retrieve user information from FusionAuth using the token. 

If all these steps are successful, the user will be redirected to the home page. Now, you need to add logic blocks to this route handler to ensure the user is redirected to the correct page after a login or registration. In the case of a registration, you want to redirect the user to a page where
he will enter his address. In the case of a login, you want to redirect the user to the home page.


```ts
//tag::oauth-redirect[]
app.get('/oauth-redirect', async (req, res, next) => {
 // Capture query params
 ...

 const source = `${req.query?.source}`;


 ...


 try {
   // Exchange Auth Code and Verifier for Access Token

   ...

   if (source === 'register') {
     res.redirect(302, '/set-address');
   } else {
     res.redirect(302, '/account');
   }
 } catch (err: any) {
   console.error(err);
   res.status(err?.statusCode || 500).json(JSON.stringify({
     error: err
   }))
 }
});
//end::oauth-redirect[]
```


In the code above, you capture the `source` parameter from the URL. If the `source` is `register`, you redirect the user to the `/set-address` page. Otherwise, you redirect the user to the `/account` page.
Let's build the `/set-address` page.

### Building the Address Page

Building the `/set-address` page is very similar to the `/account` page. We will build the UI first, and then add a route to render the page and another one to handle the form submission. But before that, 
we need to ensure that we can save the user's address in the FusionAuth database.

In the dashboard at <Breadcrumb>Customizations -> Form Fields -> Add</Breadcrumb>, you can create a new field called `Address`. This will be registered under the <InlineField>user.data</InlineField> object.

<img src="/img/docs/extend/progressive-registration/registration-form-field.png" alt="Adding address field"/>

Then, you need to create the routes that will render the page and handle the form submission. In the `complete-application/src/index.ts` file, add the code for the rendering route `/set-address`.

```ts
app.get("/set-address", async (req, res) => {
  const userTokenCookie = req.cookies[userToken];
  if (!await validateUser(userTokenCookie)) {
    res.redirect(302, '/');
  } else {
    res.sendFile(path.join(__dirname, '../templates/set-address.html'));
  }
});
```

The code above checks that the user is authenticated and redirects the user to the home page if the user is not authenticated. Otherwise, it sends the `set-address.html` file to the browser.
We can now add the route for the form submission.

```ts
app.post("/set-address", async (req, res) => {
  const userTokenCookie = req.cookies[userToken];
  if (!await validateUser(userTokenCookie)) {
    res.status(403).json(JSON.stringify({
      error: 'Unauthorized'
    }))
    return;
  }

  let error;

  try {
    const address = req.body.address;
    const retrievedUserDetails = req.cookies[userDetails];
    if (!retrievedUserDetails) {
      throw new Error('No user details found in cookie');
    }
    const userId = retrievedUserDetails.id;
    if (!userId) {
      throw new Error('No user id found in cookie');
    }

    // Update the user's address
    await client.patchUser(userId, {
      user: {
        email: retrievedUserDetails.email,
        data: {
          address: address
        }
      }
    });

    res.status(200).json(JSON.stringify({
      error,
      message: 'Address updated successfully'
    }))

  } catch (ex: any) {
    console.error(ex);
    error = `There was a problem updating the address. ${ex.exeception.fieldErrors}`;
    res.json(JSON.stringify({
      error,
    }))
  }

});
```

The code above checks that the user is authenticated and then retrieve the user's details from the cookie such as the user's email and user id. You need these details to update the user's address.
Notice that the code uses the `patchUser` method to update the user's address instead of the `updateUser` method because it is only updating a single field.

You can now add the code for the address form. Create the `templates/set-address.html` file and add the following code to it. The form will collect the user's address and save it in the <InlineField>user.data</InlineField> object.

```html
<html>
<head>
  <meta charset="utf-8" />
  <title>FusionAuth Express Web</title>
  <link rel="stylesheet" href="/static/css/changebank.css">
</head>
<body>
  <div id="page-container">
    <div id="page-header">
      <div id="logo-header">
        <div class="h-row">
          <p class="header-email"></p>
          <a class="button-lg" href="/logout">Logout</a>
        </div>
      </div>

      <div id="menu-bar" class="menu-bar">
        <a class="menu-link" href="/make-change">Make Change</a>
        <a class="menu-link inactive" href="/account">Account</a>
      </div>
    </div>

    <div style="flex: 1;">
      <div class="column-container">
        <div class="app-container change-container">
          <h3>Thanks for registering! Set your address to start making money changes</h3> 
            <div class="error-message"></div>
            <div class="change-message">
            </div>

          <form onsubmit="setAddress(event)" id="set-address-form">
            <div class="h-row">
              <div class="change-label">Your Address</div>
              <input class="change-input" name="address" id="address" value="" type="text" />
              <input class="change-submit" type="submit" value="Set Address" />
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Snag cookie user data
      const user = JSON.parse(decodeURIComponent(document.cookie.split('; ').filter(c => c.includes('userDetails')).at(0).split('=').at(-1)).replace('j:', ''))
      document.querySelector('.header-email').innerHTML = user.email;

      const setAddress = async (e) => {
        e.preventDefault();

        const resp = await (await fetch('/set-address', {
          method: 'POST',
          body: new URLSearchParams(new FormData(e.currentTarget)),
          headers: {
              "Content-Type": "application/x-www-form-urlencoded",
          },
        })).json();
        const error = JSON.parse(resp).error;
        
        if (error) {
          document.querySelector('.error-message').innerHTML = result.error
        } else {
          location.replace('/make-change');
        }
      }
    </script>
</body>
</html>
```

The code above collects the address entered by a user and sends a request to update the user's information. If the request is successful, the user is redirected to an existing `/make-change` page. You can test the process by registering a user. You should be redirected to a similar page to the one below.

<img src="/img/docs/extend/progressive-registration/set-address.png" alt="Set address"/>

We have explored how to add a progressive registration form using the FusionAuth admin dashboard. However, you might want to use your own UI to collect the information. In the next section, you will explore
how to add a progressive registration form using the FusionAuth API.

## Using FusionAuth API

There might be some cases where you want to use your UI to collect the information. In this case, you should understand that implementing a progressive registration process in your application will be
more complex, even though you will have more control over the UI and the data you collect.

The FusionAuth API provides a way to register users in your application. Let's explore these routes and also their SDK implementations.

### Registering a User Using the API

To register a user using the API, you will need to send a `POST` request to the `/api/user/registration` endpoint. The request requires the following fields and headers:
- `X-FusionAuth-TenantId` (Required if multiple tenants exist): The unique tenant Id used to scope the API request.
- <InlineField>user.email</InlineField>: The unique email address for the user.
- <InlineField>registration.applicationId</InlineField> (Required): UUID of the application for which the registration is being created.
- <InlineField>user.password</InlineField> (Optional unless <InlineField>sendSetPasswordEmail</InlineField> is false): Plain text password to be hashed.

You can also send the following optional fields: <InlineField>user.firstName</InlineField>, <InlineField>user.lastName</InlineField>, <InlineField>user.middleName</InlineField>, <InlineField>user.birthDate</InlineField>, <InlineField>user.imageUrl</InlineField>, <InlineField>user.preferredLanguages</InlineField>, <InlineField>user.timezone</InlineField>, <InlineField>user.username</InlineField> and <InlineField>user.data</InlineField>.

Here is an example of a request body:

```json
{
 "registration": {
   "applicationId": "10000000-0000-0002-0000-000000000001",
   "preferredLanguages": [
     "en",
     "fr"
   ],
   "roles": [
     "user",
     "community_helper"
   ],
   "timezone": "America/Chicago",
   "username": "johnny123"
 },
 "disableDomainBlock": false,
 "sendSetPasswordEmail": false,
 "skipVerification": false,
 "user": {
   "email": "example@fusionauth.io",
   "password": "securePassword123!",
   "firstName": "John",
   "lastName": "Doe",
   "middleName": "William",
   "birthDate": "1976-05-30",
   "preferredLanguages": [
     "en",
     "fr"
   ],
   "timezone": "America/Denver",
   "username": "johnny123"
 }
}
```


The API supports more fields that can be included based on your requirements. You can find a full list of supported fields in the [FusionAuth API documentation](/docs/apis/registrations#request).


An interesting field is the <InlineField>user.data</InlineField> field. This field can be used to store any data that you want to associate with the user according to your application requirements. For example, you can use this field to store the user's address or any other data that you want to collect during the registration process.
To ensure that this field can be filled, you will need to create a custom field in the FusionAuth admin UI or use the API.


In the dashboard at <Breadcrumb>Customizations -> Form Fields -> Add</Breadcrumb>, you can create a new field.
In the form, you will need to specify the name of the field and set the field type to **Custom user data (user.data.*)**. The image below shows how you can add a new field called `address` under the `user.data` object.


<img src="/img/docs/extend/progressive-registration/registration-form-field.png" alt="Registration form field"/>


Once this field is created, you can use it in the registration form when creating a user, or when [updating a user registration](/docs/apis/registrations#update-a-user-registration) which means
that you are progressively updating the user's data.


The Typescript SDK provides methods to achieve this pretty easily.


#### Registering a User Using the Typescript SDK


To register a user using the Typescript SDK, you must create a new `Registration` object and set the required fields. You can also set the optional fields.


```ts
import FusionAuthClient from "@fusionauth/typescript-client";


const client = new FusionAuthClient(apiKey as string, fusionAuthURL);


client.register('', {
 disableDomainBlock: false,
 sendSetPasswordEmail: false,
 skipVerification: false,
 registration: {
   applicationId: "application-id-placeholder",
 },
 user: {
   email: "email-placeholder",
 }
}).then((response) => {
   console.log(response.successResponse);
 })
 .catch((error) => {
   console.error(error);
 });
```


#### Updating a User Registration Using the Typescript SDK


Once you have created a user, you can update the user profile data behind the scenes with as little friction as possible. You can use the Typescript SDK by calling the `patchRegistration`.


```ts
import FusionAuthClient from "@fusionauth/typescript-client";


const client = new FusionAuthClient(apiKey as string, fusionAuthURL);


client.patchRegistration("registration-id-placeholder", {
 user: {
   data: {
     "address": {
       "street": "123 Main St",
       "city": "Anytown",
       "state": "CA",
       "zipCode": "12345"
     }
   }
 }
})
.then((response) => {
   console.log(response.successResponse);
 })
 .catch((error) => {
   console.error(error);
 });
```


The `updateRegistration` method is also available in the Typescript SDK. However, this method sent a `PUT` request to the `/api/user/registration` endpoint which means that you can have
data inconsistencies if you are not careful. For this reason, you recommend using the `patchRegistration` method and only use the `updateRegistration` method if you are sure that you want to update the entire registration object, which might
clear out other fields that you might have set.


## When to Use the API or the Admin UI


In the previous sections, you have explored how to add a progressive registration process in an application using the FusionAuth admin UI or the FusionAuth API. Here are some considerations when deciding which approach to use.

- If you are using the FusionAuth admin UI, you can use the admin UI to create a registration form that will collect the user's information. This form can be customized with as many fields and steps as you need to fit your application's requirements.
- If you are using the FusionAuth API, you can use the API to create a registration form that will be used to collect the user's information. This is useful if you have 
a custom UI or a custom data collection process on these pages.

## Next Steps

If you want to take this guide further, here are some more resources that you can explore:

- [FusionAuth API documentation](/docs/apis/registrations)
- [FusionAuth User API documentation](/docs/apis/users)
- [FusionAuth Typescript SDK](https://github.com/FusionAuth/fusionauth-typescript-client)
