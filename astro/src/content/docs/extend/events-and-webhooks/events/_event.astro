---
import Aside from 'src/components/Aside.astro';
import EventInfo from 'src/content/docs/extend/events-and-webhooks/events/_event-info.mdx';
import InlineField from 'src/components/InlineField.astro';
import JSON from 'src/components/JSON.astro';
import semver from 'semver';

const { name, fieldName, version, description, scope, transactional, fields, jsonFile, includeTenantId } = Astro.props;

---

<h2>{name}</h2>

{ version && 
  <Aside type="version">
    This event has been available since {version}
  </Aside>
}

<p>
{description}
</p>


<span class="italic">Event type</span>
<pre>
{fieldName}
</pre>

<h3>Event Scope</h3>
{ scope === 'instance' &&
  <p>This is a system scoped event. If enabled in <strong>Settings -> Webhooks -> Your Webhook</strong>, this event will be sent.</p>
  <p>The tenant webhook enable or disable settings do not apply and will be ignored.</p>
}
{ scope === 'tenant' && semver.gte(version, '1.38.0') &&
  <p>This is a tenant scoped event.</p>
  <p>It can be sent to all tenants or to one or more specified tenants. However, those tenants will not be sent events for other tenants, but only events related to themselves.</p>
}
{ scope === 'tenant' && semver.lt(version, '1.38.0') &&
  <p>This is a tenant scoped event.</p>
  <p> Prior to version 1.37.0 this event was sent to all webhooks, and it was a webhook's responsibility to filter on the <InlineField>tenantId</InlineField> field.</p>
  <p> In version 1.37.0 and later, this event will only be sent to tenants for which webhooks for this event are enabled.</p>
}

<h3>Transaction Compatibility</h3>
{ transactional == "false" ? 
  <p>
    This event is non-transactional. The operation will succeed regardless of the webhook response status code.
  </p>
  :
  <p>
    This event is transactional. The final state of the operation which caused the webhook is not persisted to FusionAuth until after the webhook finishes; <a href="/docs/extend/events-and-webhooks/writing-a-webhook#calling-fusionauth-apis-in-webhooks">learn more</a>
  </p>
}

<h3>Event Body</h3>

<slot />
<EventInfo eventType={fieldName} includeTenantId={includeTenantId} />

<JSON title="Example Event JSON" src={`events/${jsonFile}`} />
