---
import APIField from 'src/components/api/APIField.astro';
import PremiumEditionBlurbApi from 'src/content/docs/_shared/_premium-edition-blurb-api.mdx';
import Aside from 'src/components/Aside.astro';
import InlineField from 'src/components/InlineField.astro';
import JSON from 'src/components/JSON.astro';
import semver from 'semver';

const { name, fieldName, version, description, scope, transactional, fields, jsonFile, includeTenantId } = Astro.props;

---

<h2>{name}</h2>

{ version && 
  <Aside type="version">
    This event has been available since {version}
  </Aside>
}

<p>
{description}
</p>


<span class="italic">Event type</span>
<pre>
{fieldName}
</pre>

<h3>Event Scope</h3>
{ scope === 'instance' &&
  <p>This is a system scoped event. If enabled in <strong>Settings -> Webhooks -> Your Webhook</strong>, this event will be sent.</p>
  <p>The tenant webhook enable or disable settings do not apply and will be ignored.</p>
}
{ scope === 'tenant' && semver.gte(version, '1.38.0') &&
  <p>This is a tenant scoped event.</p>
  <p>It can be sent to all tenants or to one or more specified tenants. However, those tenants will not be sent events for other tenants, but only events related to themselves.</p>
}
{ scope === 'tenant' && semver.lt(version, '1.38.0') &&
  <p>This is a tenant scoped event.</p>
  <p> Prior to version 1.37.0 this event was sent to all webhooks, and it was a webhook's responsibility to filter on the <InlineField>tenantId</InlineField> field.</p>
  <p> In version 1.37.0 and later, this event will only be sent to tenants for which webhooks for this event are enabled.</p>
}

<h3>Transaction Compatibility</h3>
{ transactional == "false" ? 
  <p>
    This event is non-transactional. The operation will succeed regardless of the webhook response status code.
  </p>
  :
  <p>
    This event is transactional. The final state of the operation which caused the webhook is not persisted to FusionAuth until after the webhook finishes; <a href="/docs/extend/events-and-webhooks/writing-a-webhook#calling-fusionauth-apis-in-webhooks">learn more</a>
  </p>
}

<h3>Event Body</h3>

<slot />

<APIField name="event.info.data" type="Object">
An object that can hold any information about the event that should be persisted.
</APIField>

<APIField name="event.info.deviceDescription" type="String">
The description of the device associated with the event.
</APIField>

<APIField name="event.info.deviceName" type="String">
The device name associated with the event.
</APIField>

<APIField name="event.info.deviceType" type="String">
The type of device associated with the event.
</APIField>

<APIField name="event.info.ipAddress" type="String">
The source IP address of the event.
</APIField>

<APIField name="event.info.location.city" type="String">
The city where the event originated.
<PremiumEditionBlurbApi feature="event info location" />
</APIField>

<APIField name="event.info.location.country" type="String">
The country where the event originated.
<PremiumEditionBlurbApi feature="event info location" />
</APIField>

<APIField name="event.info.location.latitude" type="Double">
The latitude where the event originated.
<PremiumEditionBlurbApi feature="event info location" />
</APIField>

<APIField name="event.info.location.longitude" type="Double">
The longitude where the event originated.
<PremiumEditionBlurbApi feature="event info location" />
</APIField>

<APIField name="event.info.location.region" type="String">
The geographic location where the event originated.
<PremiumEditionBlurbApi feature="event info location" />
</APIField>

<APIField name="event.info.location.zipcode" type="String">
The zip code where the event originated.
<PremiumEditionBlurbApi feature="event info location" />
</APIField>

<APIField name="event.info.os" type="String">
The operating system associated with the event.
</APIField>

<APIField name="event.info.userAgent" type="String">
The user agent associated with the event.
</APIField>

<slot name="custom-fields" />

{includeTenantId && 
<APIField name="event.tenantId" type="UUID">
The unique tenant identifier. This value may not be returned if not applicable.
</APIField>
}

<APIField name="event.type" type="String">
The event type, this value will always be <code>{fieldName}</code>.
</APIField>

<JSON title="Example Event JSON" src={`events/${jsonFile}`} />
