---
title: FusionAuth And Terraform
description: Manage FusionAuth configuration changes over time with Terraform.
navcategory: admin
section: operate
subcategory: deploy
---
import Aside from 'src/components/Aside.astro';
import {RemoteCode} from '@fusionauth/astro-components';

## Overview

In this section you'll learn more about the open source [FusionAuth Terraform Provider](https://registry.terraform.io/providers/fusionauth/fusionauth/latest/), with which you will be able to manage FusionAuth using Terraform, an open source infrastructure as code automation tool.

Since it began as a community project, it is not as complete as the client libraries, but it covers the majority of use cases. If you find yourself needing to manage an unsupported resource or configuration, please submit a PR to the [GitHub repository](https://github.com/fusionauth/terraform-provider-fusionauth). PRs are regularly reviewed and merged.

## Prerequisites

In order to get the most value from this guide, you should have a running FusionAuth instance and the Terraform CLI installed.

If you don't have this set up yet, please review the following links:

* [5 minute setup guide](/docs/v1/tech/5-minute-setup-guide) - get a FusionAuth instance up and running with a simple application.
* The [Install Terraform](https://developer.hashicorp.com/terraform/tutorials/docker-get-started/install-cli) section in the [Get Started - Docker](https://developer.hashicorp.com/terraform/tutorials/docker-get-started) guide from Terraform will walk you through installing the Terraform CLI.

## Initial Setup

In the initial setup you go through the initializing of the Terraform working directory with the FusionAuth API key.

### FusionAuth API Key

Create an unlimited super user API Key as described in [Managing API Keys](/docs/apis/authentication#managing-api-keys) by not selecting any endpoint methods to create a super user key. A super user API Key has access to all API endpoints. If you want to limit operations which can be performed by Terraform, you can limit the API Key to certain endpoints. But for this document, a super user API Key is assumed.

Copy the key before pressing the Save button.
//TODO: screenshot http://fusionauth-terraform:9011/admin/api-key/

An automated way to set up an API Key would be to use [Kickstart](/docs/get-started/download-and-install/development/kickstart) with a predefined API Key which you can add as a secret in your automated deployment.

<RemoteCode lang="json" title="Example Kickstart JSON File" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/kickstart/kickstart.json" />

### Initializing Terraform Working Directory

With the copied API Key from your FusionAuth environment you initialize the Terraform working directory. Create a new directory. Any name will do, but for consistency, it is suggested to name it after your FusionAuth instance host name.

```
mkdir auth.example.com
cd auth.example.com
```

For all the variables you're going to use, create a `variables.tf` file with the following content to declare all https://developer.hashicorp.com/terraform/language/values/variables[Input Variables] used throughout the example.

<RemoteCode lang="hcl" title="Example Variables File" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/examples/import/variables.tf" />

And for the Variable Definitions, create a `terraform.tfvars` file with the following content and changes:

* Adding the previously created key as `fusionauth_api_key` variable
* Adding the value of the FusionAuth instance you plan to manage to the `fusionauth_host` variable
* Make sure host is the full URL including protocol of your FusionAuth instance, in the docker example this may be `http://localhost:9011`
* Adding the value for `fusionauth_default_tenant_id` you can skip for now.
* Adding `fusionauth_default_application_id` is not necessary as it stays the same for all deployments and the default is defined in `variables.tf`.

<RemoteCode lang="hcl" title="Example Variable Definitions" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/examples/import/terraform.tfvars" />

<Aside type="caution">
Please note the configuration section for `fusionauth_api_key` in `variables.tf`. The configuration option `sensitive = true` is defined, this will prevent sensitive data added to the Terraform state and therefore has to be always defined.

The variable definition with `terraform.tfvars` is only one way, please follow https://developer.hashicorp.com/terraform/language/values/variables#assigning-values-to-root-module-variables[Assigning Values to Root Module Variables] for more information.
</Aside>

Next, add the [FusionAuth Terraform Provider](https://registry.terraform.io/providers/fusionauth/fusionauth/latest) configuration in the directory by:

* Opening the [FusionAuth Terraform Provider Documentation](https://registry.terraform.io/providers/fusionauth/fusionauth/latest/docs)
* Clicking the <strong>USE PROVIDER</strong> button
* Copying the Hashicorp Configuration Language (HCL) provided
* Creating a Terraform configuration file named `main.tf`
* Pasting the copied HCL into that file
* Adding the previously created variable as `var.fusionauth_api_key` to the `provider` section
* Adding the FusionAuth instance you plan to manage with the `var.fusionauth_host` variable in the `provider` section

Here's what your `main.tf` file might look like after these steps.

<RemoteCode lang="hcl" title="Example main.tf File" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/examples/import/main.tf" tags="terraformProvider" />

Finally, the following command performs several different initialization steps in order to prepare the current working directory for use with Terraform.

```shell
terraform init
```

It is always safe to run [`terraform init`](https://developer.hashicorp.com/terraform/cli/commands/init) multiple times, to bring the working directory up to date with changes in the configuration. Though subsequent runs may give errors, this command will never delete your existing configuration or state.

### Configuration Strategy

Once you initialize the Terraform working directory, you should review different initial strategies to handle the import of default FusionAuth configuration which will be discussed below.

| Strategy | Advantages | Disadvantages |
| ---- | ---- | ---- |
| import | manage existing resources | some resources don't fully support the Terraform lifecycle |
| data source  | reference existing resources without having to manage them | requires a external process to manage these resources |
| create | always create and be able to manage all resources through Terraform | bigger initial effort and default resources are out of scope |

## Terraform Import

Before you look in to creating, updating, and removing with Terraform, let's look at the [Import](https://developer.hashicorp.com/terraform/language/import) and [Data Source](https://developer.hashicorp.com/terraform/language/data-sources) functionality.

If you have existing FusionAuth configuration you want to manage via Terraform, you will need to import it.

<Aside type="tip">
The most consistent method is to create all resources through Terraform. However, in certain scenarios you must use use `Import` or `Data Source` to handle default configuration.
</Aside>

There are [configuration elements](https://fusionauth.io/docs/get-started/core-concepts/limitations#default-configuration) that are present in every FusionAuth installation. If you want to manage changes to these via Terraform, you must tell Terraform about them. 

The FusionAuth Default Tenant and default Application are two configuration elements that you will almost certainly want to modify.

## Importing The Default Tenant

The Default Tenant is created during the initial deployment of FusionAuth. To manage it through Terraform, you must import it. In addition, if you're managing the FusionAuth Application, which is the administrative user interface, it will always be in the Default Tenant.

<Aside type="tip">
You can use the Default Tenant for all your Applications. When using Terraform, it is easier to create your own Tenant and then create Applications in your Tenant rather than importing the default ones.
</Aside>

As outlined in the [Tenant Terraform Resource documentation](https://registry.terraform.io/providers/fusionauth/fusionauth/latest/docs/resources/tenant), add the following code to `main.tf`.

<RemoteCode lang="hcl" title="Default Tenant Import" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/examples/import/main.tf" tags="defaultTenantImport" />

To make things easier, you only have to update the first Id in the import section with the Default Tenant Id. You can find this Id in the FusionAuth Admin UI under `Tenants`. Replace `Replace-This-With-The-Existing-Default-Tenant-Id` with that value.

All other UUID definitions are set to `00000000-0000-0000-0000-000000000000`. You'll find the correct values for the other Ids later.

You can use this technique with any resource you want to import into Terraform.

![The dashboard of the FusionAuth Default Tenant](/docs/operate/deploy/default-tenant-id.png)

Since you provided a valid Tenant Id, you can let Terraform find the other Ids by searching the plan output for in-place updates. Then you can update `main.tf` with those values. Do this by running `terraform plan`.

```shell
terraform plan | grep \~
```

Because of the way Terraform works, this plan suggests replacing the UUID definitions for configuration with `00000000-0000-0000-0000-000000000000`. You don't want to do that, you just used that value to find the **real** UUID values. So, copy the UUIDs to `main.tf` and replace each instance of `00000000-0000-0000-0000-000000000000` with the correct value.

Here is how the output of the `grep` command might look:

```plaintext
  ~ update in-place
  ~ resource "fusionauth_tenant" "Default" {
      ~ theme_id                           = "75a068fd-e94b-451a-9aeb-3ddb9a3b5987" -> "00000000-0000-0000-0000-000000000000"
      ~ email_configuration {
      ~ jwt_configuration {
          ~ access_token_key_id                                = "a39be146-51cb-0288-7806-6eb6c066aed3" -> "00000000-0000-0000-0000-000000000000"
          ~ id_token_key_id                                    = "092dbedc-30af-4149-9c61-b578f2c72f59" -> "00000000-0000-0000-0000-000000000000"
```

Make sure you copy all those Id's from your output to the `main.tf` file. For example, modify `jwt_configuration` to look like

```hcl
jwt_configuration {
    refresh_token_time_to_live_in_minutes              = 43200
    time_to_live_in_seconds                            = 3600
    refresh_token_revocation_policy_on_login_prevented = true
    refresh_token_revocation_policy_on_password_change = true
    access_token_key_id                                = "a39be146-51cb-0288-7806-6eb6c066aed3"
    id_token_key_id                                    = "092dbedc-30af-4149-9c61-b578f2c72f59"
  }
```

Once appended run [`terraform plan`](https://developer.hashicorp.com/terraform/cli/commands/plan) to check the validity of your configuration. If there is no output, that indicates that the remote FusionAuth configuration and the `main.tf` file are in sync.

<Aside type="tip">
The example configuration above is subject to change either due to manual changes using the admin UI or version differences such as new Tenant configuration defaults. Carefully check the `terraform plan` output.
</Aside>

If the plan is valid and you're happy with the changes run [`terraform apply`](https://developer.hashicorp.com/terraform/cli/commands/apply).

```shell
terraform plan
terraform apply
```

<Aside type="caution">
Once imported, Terraform tracks the resource in your state file. You can then manage the imported resource similar to any other by updating its attributes.

You can't destroy the default FusionAuth Application. Attempting to do so will break your Terraform state. See [Prevent Destroy](#prevent-destroy) for more details.
</Aside>

Leave the import block in your configuration as a record of the default Application resource's origin. The import block records that Terraform imported the resource and didn't create it.

### Using Data Source Instead of Import

Instead of importing a resource you can use an existing FusionAuth configuration as a `Data Source`. The list of all supported data sources you can find in the [FusionAuth Terraform Provider Documentation](https://registry.terraform.io/providers/fusionauth/fusionauth/latest/docs).

Data sources are useful if you choose to manage the Default Tenant and FusionAuth Application outside Terraform manually or via a script using the [client libraries](/docs/v1/tech/client-libraries/), but still need to reference the Tenant or Application.

You might do so to:

* add Applications in to the Default Tenant
* associate a JWT signing key with the FusionAuth Application
* set up an IP ACL to limit access to the FusionAuth Application

Review the Data Source documentation for the Default Tenant and FusionAuth Application to learn more:

* [Tenant Data Source documentation](https://registry.terraform.io/providers/fusionauth/fusionauth/latest/docs/data-sources/tenant)
* [Application Data Source documentation](https://registry.terraform.io/providers/fusionauth/fusionauth/latest/docs/data-sources/application)

Here's an example of how you might add data sources to your Terraform file:

<RemoteCode lang="hcl" title="A Data Source For The Default Tenant" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/examples/data-source/main.tf" tags="defaultTenantDataSource" />

<RemoteCode lang="hcl" title="A Data Source For The FusionAuth Application" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/examples/data-source/main.tf" tags="defaultApplicationDataSource" />

<Aside type="tip">
If you manage the Default Tenant and FusionAuth Application outside of Terraform but want specific actions (scripts, API calls, etc.) integrated and triggered by your Terraform configuration, you could make the use of [Provisioners](https://developer.hashicorp.com/terraform/language/resources/provisioners/syntax).

Terraform includes the concept of provisioners as a measure of pragmatism and last resort since provisioners are non-declarative and potentially unpredictable. They exist because there are always certain behaviors that can't be directly represented in Terraform's declarative model.
</Aside>

Now that you've set up Terraform to handle default configuration, let's walk through creating, updating, and removing other resources.

## Terraform Create

To create a new resource you can go through the list of resources available to you in the [FusionAuth Terraform Provider Documentation](https://registry.terraform.io/providers/fusionauth/fusionauth/latest/docs) and pick the resource you're interested in. Each resource contains information about required and optional arguments.

In this example you create an Application called `forum` with a custom Access Token Key in a newly created `forum` Tenant with related Roles (admin and user). And as it's very common to use kickstart during automated deployments creating an Email Template too: TODO what does this mean?

* [Terraform Tenant Resource documentation](https://registry.terraform.io/providers/fusionauth/fusionauth/latest/docs/resources/tenant)

<RemoteCode lang="hcl" title="Creating A Forum Tenant" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/examples/create/main.tf" tags="createForumTenant" />

* https://registry.terraform.io/providers/fusionauth/fusionauth/latest/docs/resources/key[Terraform Key Resource documentation]

<RemoteCode lang="hcl" title="Creating A Signing Key" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/examples/create/main.tf" tags="createKey" />

* https://registry.terraform.io/providers/fusionauth/fusionauth/latest/docs/resources/email[Terraform Email Resource documentation]

<RemoteCode lang="hcl" title="Creating An Email Template" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/examples/create/main.tf" tags="createEmailTemplate" />

* https://registry.terraform.io/providers/fusionauth/fusionauth/latest/docs/resources/application[Terraform Application Resource documentation]

<RemoteCode lang="hcl" title="Creating A Forum Application In The Forum Tenant" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/examples/create/main.tf" tags="createForumApplication" />

* https://registry.terraform.io/providers/fusionauth/fusionauth/latest/docs/resources/application_role[Terraform Application Role Resource documentation]

<RemoteCode lang="hcl" title="Creating Roles In The Forum Application" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/examples/create/main.tf" tags="createForumApplicationRoles" />

This example assumes you're using a data source to reference the Default Tenant. If you imported the Default Tenant, remove the prefix `data.` to have this example work correctly. TODO is that important

<RemoteCode lang="hcl" title="Using Data Sources" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/examples/create/main.tf" tags="defaultDataSource" /> TODO is this important

Once you're happy with your configuration run `terraform plan` and if you aren't experiencing errors and are ok with the planned changes, go ahead with `terraform apply`.

<Aside type="caution">
TODO Deleting a Tenant removes all the associated Applications, Groups, and Users. If you want to make sure that the Tenant isn't destroyed, see [Prevent Destroy](#prevent-destroy) for more details.
</Aside>

## Terraform Update

Once a resource is either created or imported you can change `main.tf` according to the [Terraform Provider Documentation](https://registry.terraform.io/providers/fusionauth/fusionauth/latest/docs/).

For example by changing the time to live in seconds to half a hour in the JWT configuration.

```hcl
  jwt_configuration {
    refresh_token_time_to_live_in_minutes = 43200
    time_to_live_in_seconds               = 1800
  }
```

After you're done with your configuration changes, run `terraform plan` to check the planned changes and review potential errors. It will show you what it will change from the current value to the new value.

```plaintext
Terraform will perform the following actions:

  # fusionauth_tenant.forum will be updated in-place
  ~ resource "fusionauth_tenant" "forum" {
        id                                 = "ef1f5235-82de-4a2a-b103-4d130fa5f5f2"
        name                               = "Forum"
        # (7 unchanged attributes hidden)

      ~ jwt_configuration {
          ~ time_to_live_in_seconds                            = 3600 -> 1800
```

After that you can go ahead with `terraform apply`. And if you want to know what already has been defined by Terraform but not specified in your `.tf` files you can run `terraform show`.

The configuration can get very large and if you want to show only very specific resources you can list all resources with `terraform state list` and show the resource state with `terraform state show <resource-name>` accordingly.

### Ignore Lifecycle Changes

Every time you plan new changes you could face the challenge that information has been updated in your FusionAuth installation. You can either align your configuration with the installation or decide to [`ignore_changes`](https://developer.hashicorp.com/terraform/language/meta-arguments/lifecycle#ignore_changes) in your configuration.

There is a very common example in FusionAuth resources. Where your e.g. business application adds user driven data to the FusionAuth Application.

If you call your FusionAuth Application from outside with a curl command and update the data part of it in the following way.

<RemoteCode lang="shell" title="Example Script To Modify An Application" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/scripts/fusionauth-application-data/script.sh" /> 

<RemoteCode lang="json" title="JSON To Patch An Application" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/scripts/fusionauth-application-data/patch.json" /> 

You will see in the `terraform plan` output that it wants to revert it back to the original state.

```plaintext
Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  ~ update in-place

Terraform will perform the following actions:

  # fusionauth_application.forum will be updated in-place
  ~ resource "fusionauth_application" "forum" {
      ~ data                                       = {
          - "externalApplication" = "Acme. Customer Support Forum" -> null
          - "productOwner"        = "john@acme.com" -> null
          - "supportHotline"      = "+1-636-555-3226" -> null
        }
        id                                         = "7acaec93-edd4-49a1-82db-602fe8dda23f"
        name                                       = "forum"
        # (12 unchanged attributes hidden)

        # (5 unchanged blocks hidden)
    }

Plan: 0 to add, 1 to change, 0 to destroy.
```

To avoid Terraform from doing this, you can use the `ignore_changes` Meta-Argument to ignore parts of your configuration.

```hcl
resource "fusionauth_application" "forum" {
  tenant_id = data.fusionauth_tenant.Default.id
  name = "forum"
  lifecycle {
    ignore_changes = [
      data
    ]
  }
}
```

If you're only interested in initially creating and destroying resources you can as well ignore all changes.

```hcl
lifecycle {
  ignore_changes = all
}
```

## Terraform Remove

If you want to remove a resource, comment out or delete the lines defining the resource in `main.tf`. Run `terraform plan` to double check. Then run `terraform apply`, which will destroy the resource.

<Aside type="caution">
If you run [`terraform destroy`](https://developer.hashicorp.com/terraform/cli/commands/destroy), be aware that all Terraform managed resources will be destroyed.
</Aside>

### Prevent Destroy

If you still want to make sure that certain resources aren't destroyed, you can specify the [`prevent_destroy`](https://developer.hashicorp.com/terraform/language/meta-arguments/lifecycle#prevent_destroy lifecycle) meta-argument as a measure of safety against the accidental replacement of objects that may be costly to reproduce. However, it will make certain configuration changes impossible to apply, and will prevent the use of the `terraform destroy` command once such objects are created.

```hcl
lifecycle {
  prevent_destroy = true
}
```

A good example would be an in-use FusionAuth Tenant. Deleting a Tenant removes all the associated Applications, Groups, and Users.

<RemoteCode lang="hcl" title="Creating A Forum Tenant" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/examples/create/main.tf" tags="createForumTenant" />

The same meta-argument you can use for Terraform managed non-deletable resources like Default Tenant and FusionAuth Application as Terraform would not be able to anyway.

<RemoteCode lang="hcl" title="Default Tenant Import" url="https://raw.githubusercontent.com/fusionauth/fusionauth-example-terraform/main/examples/import/main.tf" tags="defaultApplicationImport" />

## FusionAuth And OpenTofu

The FusionAuth Terraform provider should work fine with OpenTofu as long as it remains compatible with Terraform.
