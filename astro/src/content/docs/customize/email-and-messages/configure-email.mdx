---
title: Configure the SMTP Server
description: Learn how to enable and configure the SMTP server.
section: customize
subcategory: email and messages
---
import InlineField from 'src/components/InlineField.astro';
import APIBlock from 'src/components/api/APIBlock.astro';
import APIField from 'src/components/api/APIField.astro';
import Aside from 'src/components/Aside.astro';

## Overview

Before you can use email templates and other email features, you must first enable and configure an SMTP server.

To enable and configure the SMTP server navigate to <strong>Tenants -> Email</strong>.

<img src="/img/docs/customize/email-and-messages/email-settings.png" alt="Email Settings" width="1200" role="shadowed" />

Enable email by clicking on the *Enabled* toggle, and save your settings once you have completed your configuration.

### SMTP Settings

<APIBlock>
  <APIField name="Host" optional defaults="localhost">
    The hostname of the SMTP server. This will be provided by your SMTP provider.
  </APIField>
  <APIField name="Port" optional defaults="25">
    The port of the SMTP server. This will be provided by your SMTP provider. Ports `25`, `465` and `587` are the well known ports used by SMTP, it is possible your provider will utilize a different port.

    In most cases you will be using TLS to connect to your SMTP server, and the port will generally be `587` or `465`.
  </APIField>
  <APIField name="Username" optional>
    The username used to authenticate to the SMTP server. This will be provided by your SMTP provider.
  </APIField>
  <APIField name="Change password" optional>
    When enabled, you may modify the SMTP password, when the <InlineField>Password</InlineField> field is not displayed the current password will not be modified.
  </APIField>
  <APIField name="Password" required>
    The new password to use for the outgoing SMTP mail server authentication. This field is only required when <InlineField>Change password</InlineField> is checked.
  </APIField>
  <APIField name="Security" optional>
    The security type when using an SSL connection to the SMTP server. This value should be provided by your SMTP provider.

    Generally speaking, if using port `25` you will select `None`, if using port of `465` you will select `SSL` and if using port `587` you will select `TLS`. It is possible your provider will be different, follow your providers instruction.

    * `None`
    * `SSL`
    * `TLS`
  </APIField>
  <APIField name="Default from address" optional>
    The default From Address used in sending emails when a from address is not provided for an individual email template. This is an email address (i.e. **jared@piedpiper.com**).
  </APIField>
  <APIField name="Default from name" optional>
    The default From Name used in sending emails when a from name is not provided on an individual email template. This is the display name part of the email address (i.e. **Jared Dunn**  &lt;jared@piedpiper.com>).
  </APIField>
  <APIField name="Additional headers" optional since="1.32.0">
    One or more line separated SMTP headers to be added to each outgoing email. The header name and value should be separated by an equals sign. (i.e. `X-SES-CONFIGURATION-SET=Value`).
  </APIField>
  <APIField name="Debug enabled" optional since="1.37.0">
    When enabled, SMTP and JavaMail debug information will be output to the Event Log.
  </APIField>
</APIBlock>

## SMTP best practices

As of 2024, Google [requires SMTP providers to allow users to send only from their own registered domains](https://help.brevo.com/hc/en-us/articles/14925263522578-Prepare-for-Gmail-and-Yahoo-s-new-requirements-for-email-senders). A few email providers listed in this article will allow you to send emails without domain verification, but that number will probably shrink over time.

todo - put this above providers

- general email best practices
- setting up your SPF and DKIM records
- dedicated IP vs. IP pools and IP reputation
- Anything else that people should consider when setting up SMTP

## SMTP Providers

<Aside type="note">
This information is for starting guidance only - FusionAuth connects seamlessly with many different email providers. A deep exploration of email best practices and providers is outside the scope of this section.
</Aside>

To avoid breaking the various DNS records of your application's domain, you may want to run FusionAuth locally in Docker and point its SMTP fields to a temporary domain. In the examples below, configuration is shown using a free subdomain created with [ClouDNS](https://www.cloudns.com) The examples use the domain `fusionauth.ddns.net`.

Alternatively, you can create a subdomain on your real account. For example, if your application is hosted at `myapp.com`, you can create `testemail.myapp.com`, and point the SMTP service and FusionAuth there while testing.

### Which Provider To Pick?

Some providers are easy to test, requiring nothing more than registering with an email address. Others require comprehensive company details, your verified phone number, domain verification, or communicating with support agents. Disregarding price and features, the easiest providers to configure are:
- Mailersend
- Gmail (requires phone authentication however, and is just for small tests)

The more difficult providers are (from easiest to most complicated):
- Resend — require domain verification through adding DNS records.
- AWS SES — require domain verification through adding DNS records. Allows you to email only verified addresses while in the test sandbox.
- SendGrid — automatically disable your account on sign-up and require you to manually contact to support to have it activated.
- Brevo — require phone authentication. Automatically disable your account on sign-up and require you to manually contact to support to have it activated. Requires domain authentication and email authentication in your domain. They also want you to have a fully built company website, want you to explain to them how you got your customer's email addresses, and need you to tell them before you start using their service if you need transactional or marketing emails.
  > Each new account is reviewed by our team before campaigns can be sent out. We review many factors, determined by our algorithms and a manual review. This process helps ensure new users comply with our terms of service and are in a position to be successful using Brevo.

  > Unfortunately, your account did not pass this analysis and we are unable to validate your account. We will unfortunately not be able to communicate more specifics about this decision but we invite you to review our anti-spam policy https://www.brevo.com/legal/antispampolicy/ and our terms of use https://www.brevo.com/legal/termsofuse/.

  https://help.brevo.com/hc/en-us/articles/12163873383186-Authenticate-your-domain-with-Brevo-Brevo-code-DKIM-record-DMARC-record


### AWS SES

- Create an account at https://aws.amazon.com.
- In your account dashboard, search for SES and start the account setup wizard.
  - Verify your email when AWS emails you.
  - Add the DNS records AWS SES gives you to your domain's DNS settings. If your web host uses cPanel, alter your records at <strong>Domains -> Zone Editor</strong>.
  - Be careful not to duplicate the domain name. For example, if your host is `fa.dns-dynamic.net` and the MX record value the SMTP provider wants you to add is `send.fa`, be sure set the value to `send.fa.dns-dynamic.net`. Don't use `send.fa.fa.dns-dynamic.net` by pasting the value without checking what suffix your host attaches to the field.
  - After a few minutes the SES <strong>Verify sending domain</strong> tab should change from `Verification pending` to `Verified`.
- Browse to <strong>SMTP settings</strong> in the AWS sidebar and note your SMTP settings.
- Click <InlineField>Create SMTP credentials</InlineField> and note the settings.
- In your tenant's email tab in the FusionAuth web interface, set the following values:
  - <InlineField>Host</InlineField>: `email-smtp.eu-west-1.amazonaws.com` (use your host from the SMTP settings page)
  - <InlineField>Port</InlineField>: `587`
  - <InlineField>Username</InlineField>: BKIBQSCRAQJD3X4RI5F7 (use your user name from the SMTP credentials page)
  - <InlineField>Password</InlineField>: Your SMTP password from the credentials page
  - <InlineField>Security</InlineField>: `TLS`
  - <InlineField>Default from address</InlineField>: `fa@fa.dns-dynamic.net` (use your verified domain)
- Click <InlineField>Send test email</InlineField> to test the settings work. You must send to an email address verified with SES. Use the address you gave when creating your SES account. Click the save icon at the top right.

SES is more complicated than the other SMTP services. If the troubleshooting section at the bottom of this article does not help you, please consult the SES documentation(https://docs.aws.amazon.com/ses/latest/dg/troubleshoot-verification.html).

### Brevo (Previously Send In Blue)

- Create an account at https://app.brevo.com.
- If they suspend your account for violating terms of service, contact support on [this page](https://www.brevo.com/contact) to activate it.
- Browse to https://app.brevo.com/senders/domain/list.
  - Add a domain: `fa.dns-dynamic.net` (or your domain name).
  - In your website domain manager, add the DNS records from the domain authentication page.
    - If you use cPanel, alter your records at <strong>Domains -> Zone Editor</strong>
    - Be careful not to duplicate the domain name. For example, if your host is `fa.dns-dynamic.net` and the MX record value the SMTP provider wants you to add is `send.fa`, be sure set the value to `send.fa.dns-dynamic.net`. Don't use `send.fa.fa.dns-dynamic.net` by pasting the value without checking what suffix your host attaches to the field.
    - Once you have entered the DNS records and saved, start the verification process on the Brevo page. It should take a minute.
- Browse to https://app.brevo.com/senders/list.
  - Add sender: `fa@fa.dns-dynamic.net` (or with your domain name).
  - If you are using ClouDNS to test, you need to add a [mail forward](https://www.cloudns.net/mail-forwards/) from `fa@fa.dns-dynamic.net` to your real email address to be able to receive the password from Brevo to authenticate you email.
  - In Brevo, authenticate your email address.
- Brevo also requires your domain to link to a website for them to activate your account. You can make one in a few clicks at https://sites.google.com and publish it.
  - In your DNS manager, such as ClouDNS.com, create a Web Request DNS record. Point it to your example site, such as `https://sites.google.com/view/fa-dns-dynamic-net/home`. Save it as a temporary redirect (302). You might need to wait up to 48 hours for your domain to be linked to the website.
  - In Google Sites, under settings start the custom domain process.
  - First verify your domain in ClouDNS by adding the TXT record Google Sites gives you.
  - Then add a CNAME record with value `fa` and destination `ghs.googlehosted.com.`.
- Browse to https://app.brevo.com/settings/keys/smtp and note your SMTP settings.
- In your tenant's email tab in the FusionAuth web interface, set the following values:
  - <InlineField>Host</InlineField>: `smtp-relay.brevo.com`
  - <InlineField>Port</InlineField>: `587`
  - <InlineField>Username</InlineField>: Your Brevo account email address
  - <InlineField>Password</InlineField>: Your SMTP key value from the Brevo settings
  - <InlineField>Security</InlineField>: `TLS`
  - <InlineField>Default from address</InlineField>: `fa@fa.dns-dynamic.net` (any address is allowed)
- Click <InlineField>Send test email</InlineField> to test the settings work, then click the save icon at the top right. Enter your real email address for the test email, so you can test it arrives.

### Gmail

Gmail is a commonly used SMTP service. Gmail is not recommended for production use, since it has a [number of limits](https://support.google.com/a/answer/166852). However, it can be useful to test email functionality.

For Gmail, use [application passwords](https://support.google.com/accounts/answer/185833), otherwise you may get a generic `Unable to send email via JavaMail / Prime Messaging Exception` error. The applications passwords support article says you need to enable two-factor authentication, then create an app password on the security tab. However, there is no `App password` setting on the tab. You need to browse to https://myaccount.google.com/apppasswords manually to create one.

- In your tenant's email tab in the FusionAuth web interface, set the following values:
  - <InlineField>Host</InlineField>: `smtp.gmail.com`
  - <InlineField>Port</InlineField>: `587`
  - <InlineField>Username</InlineField>: Your full Gmail address (including @gmail.com)
  - <InlineField>Password</InlineField>: Your app password (including spaces)
  - <InlineField>Security</InlineField>: `TLS`
  - <InlineField>Default from address</InlineField>: Your full Gmail address (including @gmail.com)
- Click <InlineField>Send test email</InlineField> to test the settings work, then click the save icon at the top right. Enter your real email address for the test email, so you can test it arrives.

### Mailersend

- Create an account at https://app.mailersend.com.
- Browse to [Email -> Domains](https://app.mailersend.com/domains) and click <InlineField>Manage</InlineField> on the trial domain they created for you.
- Under <strong>SMTP</strong>, click <InlineField>Generate new user</InlineField> and then click <InlineField>Manage</InlineField> for the user.
- Copy the values shown for all the fields on this screen to your tenant's email tab in the FusionAuth web interface.
- Leave <InlineField>Security</InlineField> as `TLS`.
- Use a <InlineField>Default from address</InlineField> with your Mailersend trial, such as `fa@trial-o89qngkvfrwlwr32.mlsender.net`.
- Click <InlineField>Send test email</InlineField> to test the settings work, then click the save icon at the top right. Enter your real email address for the test email, so you can test it arrives.

### Mailgun

### Mandrill

### Postmark

### Resend

Resend allows you to send emails only through a verified domain. You may not send emails through their domain or your localhost.

- Create an account at https://resend.com.
- Browse to https://resend.com/domains
- In your website domain manager, add the records from Resend at the link above.
  - If you use cPanel, alter your records at <strong>Domains -> Zone Editor</strong>
  - Be careful not to duplicate the domain name. For example, if your host is `fa.dns-dynamic.net` and the MX record value the SMTP provider wants you to add is `send.fa`, be sure set the value to `send.fa.dns-dynamic.net`. Don't use `send.fa.fa.dns-dynamic.net` by pasting the value without checking what suffix your host attaches to the field.
  - You need to set only the DKIM and SPF fields for testing. The DMARC field is optional and required only for your production server.
- Once you have entered the DNS records and saved, return to https://resend.com/domains and start the verification process. It should take a few minutes.
- Browse to https://resend.com/api-keys and create a key with sending access only.
- Browse to https://resend.com/settings/smtp and note your SMTP details.
- In your tenant's email tab in the FusionAuth web interface, set the following values:
  - <InlineField>Host</InlineField>: `smtp.resend.com`
  - <InlineField>Port</InlineField>: `587`
  - <InlineField>Username</InlineField>: `resend`
  - <InlineField>Password</InlineField>: Your API key
  - <InlineField>Security</InlineField>: `TLS`
  - <InlineField>Default from address</InlineField>: `fa@fa.dns-dynamic.net` (change this for your domain)
- Your from address domain name must match the one you registered with Resend or the emails will be rejected.
- Click <InlineField>Send test email</InlineField> to test the settings work, then click the save icon at the top right. Enter your real email address for the test email, so you can test it arrives.

For an overview of all the records Resend asks you set on your domain, please read their [documenation](https://resend.com/docs/dashboard/domains/introduction).

For more general information, read the [Resend documentation on SMTP](https://resend.com/docs/send-with-smtp).

### SendGrid

SendGrid is a commonly used SMTP provider and integrates well with FusionAuth. To setup SendGrid, [follow these instructions](https://docs.sendgrid.com/for-developers/sending-email/integrating-with-the-smtp-api).

Other resources related to SendGrid are linked below:

1. https://docs.sendgrid.com/for-developers/sending-email/getting-started-with-transactional-emails
2. https://docs.sendgrid.com/for-developers/sending-email/sender-identity
3. https://docs.sendgrid.com/ui/account-and-settings/how-to-set-up-domain-authentication

Using dedicated IP addresses for any SendGrid account will build email reputation over time (improving email deliverability). And lastly, to control spoofing, phishing, and spam, it is recommended to set up [SPF](https://docs.sendgrid.com/ui/account-and-settings/spf-records) and [DKIM](https://docs.sendgrid.com/ui/account-and-settings/dkim-records) records for the primary email domain (such as `example-company.com`). Emails should also be sent from an address such as `no-reply@example-company.com`.

## TODO

This shouldn’t actually document the exact steps for each provider (as hopefully they already have that in their own documentation), but we should go through the process for each one, set it up with Fusionauth, link out to them where needed, and make notes about any gotchas or potential problems

Shout on Slack if any don’t have a free plan so we can set up a paid test account. We already have one on AWS, so ask for credentials for that.
Resources
Current docs: https://fusionauth.io/docs/customize/email-and-messages/configure-email#smtp-providers
In GitHub https://github.com/ritza-co/fusionauth-site/blob/master/astro/src/content/docs/customize/email-and-messages/configure-email.mdx

workaddress@simplelogin.com

## Troubleshoot

Below are some common errors you might encounter when configuring SMTP and how to fix them.

### Authentication Error

```text
Unable to send email via JavaMail

Prime Messaging Exception
535 Authentication failed.
```

This error indicates that your username or password is probably incorrect. Re-enter them carefully with no excess whitespace and try again.

If the error looks like the one below, you need to set up a [Google application password](https://support.google.com/accounts/answer/185833).

```text
Prime Messaging Exception
535-5.7.8 Username and Password not accepted. For more information, go to
535 5.7.8  https://support.google.com/mail/?p=BadCredentials
```

### Account Suspended

```text
Unable to send email via JavaMail

Prime Messaging Exception
502 5.7.0 Your SMTP account is not yet activated. Please contact us at contact@sendinblue.com to request activation.
```

Some providers automatically disable your account at registration. Contact support at your provider to have it activated.

### Socket Timeout

```text
Error:

Unable to send email via JavaMail

Prime Messaging Exception
Exception reading response
Cause: SocketTimeoutException: Read timed out
```

You probably need to change the port number. Try `587`.

### Domain Not Verified

```text
Unable to send email via JavaMail

Prime Messaging Exception
450 The resend.com domain is not verified. Please, add and verify your domain on https://resend.com/domains
```

You need to verify your domain with your SMTP provider by settings DNS records on your web host.

Be aware that DNS records take time to change. If you make a change to a record that your SMTP provider needs to validate, you may have to wait an hour to a day for caches to refresh and use the new value.

### Email Address Not Verified

```text
Unable to send email via JavaMail

Prime Messaging Exception
554 Message rejected: Email address is not verified. The following identities failed the check in region EU-WEST-1: address/fa@simplelogin.com
```

You will probably get this error only with AWS, which requires both your to address to be verified when testing until your SES service leaves the testing sandbox. To fix this error, send the FusionAuth test email to the same address that you verified when creating the SES service in AWS.

### Email Doesn't Arrive

Try the following:
- Wait longer.
- Check that you entered the target email address correctly.
- Check if your SMTP provider received the request and the status is not `Bounced`.
- Check your spam folder in your email client, or other folders if you have filters enabled.
- Disable webhooks in FusionAuth, in case a failed webhook is causing complications.



<strong></strong>
<InlineField></InlineField>