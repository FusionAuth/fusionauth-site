import APIBlock from 'src/components/api/APIBlock.astro';
import APIField from 'src/components/api/APIField.astro';
import InlineField from 'src/components/InlineField.astro';
import InlineFieldValue from 'src/components/InlineFieldValue.astro';
import JSON from 'src/components/JSON.astro';
import WebauthnTransports from 'src/content/docs/apis/_webauthn-transports.mdx';

#### Response Body

The response body contains `options` to be passed to the [WebAuthn JavaScript API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API). The <InlineField>options.challenge</InlineField>, <InlineField>options.user.id</InlineField>, and <InlineField>options.excludeCredentials``[x]``.id</InlineField> fields must be converted to ``ArrayBuffer``s for the `navigator.credentials.create()` request. See [WebAuthn JavaScript API Binary Format](/docs/apis/webauthn#webauthn-javascript-api-binary-format) for details.

<APIBlock>
  <APIField name="options" type="Object">
    The WebAuthn public key credential creation options. This object is passed to the [WebAuthn JavaScript API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API) to create a new passkey.
  </APIField>
  <APIField name="options.attestation" type="String">
    The Relying Party's attestation conveyance preference. Currently supported values include:

     * `none` - The Relying Party is not interested in authenticator attestation.

  </APIField>
  <APIField name="options.authenticatorSelection.authenticatorAttachment" type="String">
    The Relying Party's authenticator attachment preference. Authenticators eligible for the current registration ceremony will be limited according to this requested attachment preference. Possible values are:

     * `platform` - The authenticator is integrated with the current device. These typically use the device's unlock mechanism for user verification (e.g. Touch ID, PIN, pattern).
     * `cross-platform` - The authenticator can be used between multiple devices such as a USB security key or Bluetooth-connected phone.
     * `null` (or omitted) - The Relying Party has no attachment preference. Any attachment will be allowed.
  </APIField>
  <APIField name="options.authenticatorSelection.userVerification" type="String">
    The Relying Party's user verification requirement. Eligible authenticators will be filtered according to this preference. Possible values are:

     * `discouraged` - The Relying Party does not want user verification to be used.
     * `preferred` - The Relying Party prefers that user verification is used if available but will not fail the ceremony if it is not provided.
     * `required` - The Relying Party requires user verification for the operation.
  </APIField>
  <APIField name="options.challenge" type="String">
    This field contains a base64url-encoded string that acts as a one-time challenge for the ceremony. This makes WebAuthn resistant to certain kinds of replay attacks.

    See [Converting base64url-encoded String to ArrayBuffer](/docs/apis/webauthn#converting-base64url-encoded-string-to-arraybuffer) for details on converting this value for the [WebAuthn JavaScript API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API) call.
  </APIField>
  <APIField name="options.excludeCredentials" type="Array">
    A list of passkeys whose generating authenticators should be excluded from the current registration ceremony. This is meant to prevent a user creating multiple passkeys for the same account on the same authenticator.
  </APIField>
  <APIField name="options.excludeCredentials[x].id" type="String">
    The credential Id generated by the authenticator as a base64url-encoded string. An available authenticator that owns any passkey with one of these Ids is excluded from the current ceremony.

    See [Converting base64url-encoded String to ArrayBuffer](/docs/apis/webauthn#converting-base64url-encoded-string-to-arraybuffer) for details on converting these values for the [WebAuthn JavaScript API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API) call.
  </APIField>
  <APIField name="options.excludeCredentials[x].transports" type="Array<String>">
    A list of transport types supported by the authenticator that generated the passkey. This value is used as a hint to help identify authenticators containing one of the <InlineField>options.excludeCredentials</InlineField>.

<WebauthnTransports />
  </APIField>
  <APIField name="options.excludeCredentials[x].type" type="String">
    The credential type the current passkey refers to. The only value supported by WebAuthn is `public-key`.
  </APIField>
  <APIField name="options.extensions.credProps" type="Boolean">
    If <InlineFieldValue>true</InlineFieldValue>, the Relying Party will request the client to report on whether the new passkey is a client-side discoverable credential.
  </APIField>
  <APIField name="options.pubKeyCredParams" type="Array">
    A list of the Relying Party's acceptable options for the type of passkey and its signing algorithm in order of preference.
  </APIField>
  <APIField name="options.pubKeyCredParams[x].alg" type="Long">
    The identifier for the signing algorithm to be used with the passkey. These values are defined by the [IANA COSE Algorithms registry](https://www.iana.org/assignments/cose/cose.xhtml). FusionAuth supports a subset of these algorithms.
  </APIField>
  <APIField name="options.pubKeyCredParams[x].type" type="String">
    The credential type the current passkey refers to. The only value supported by WebAuthn is `public-key`.
  </APIField>
  <APIField name="options.rp.id" type="String">
    The Relying Party Id for this registration ceremony. Passkeys can only be used to authenticate on sites using the same Relying Party Id they were registered with.

    If this value is `null` or omitted, the [WebAuthn JavaScript API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API) will use the browser origin as the Relying Party Id.
  </APIField>
  <APIField name="options.rp.name" type="String">
    The name of the Relying Party requesting a new passkey to be created. This value is intended for display during WebAuthn ceremonies.
  </APIField>
  <APIField name="options.timeout" type="Long">
    The number of milliseconds the Relying Party is willing to wait for the ceremony to complete. This value is treated as a hint and may be overridden by the client. This is an unsigned value.
  </APIField>
  <APIField name="options.user.displayName" type="String">
    A human-readable display name for the new passkey. This value may be displayed during the current and future WebAuthn ceremonies.
  </APIField>
  <APIField name="options.user.id" type="String">
    A user handle that can be used by the Relying Party to uniquely identify the user registering the passkey. FusionAuth uses the base64url-encoded unique Id for the user.

    See [Converting base64url-encoded String to ArrayBuffer](/docs/apis/webauthn#converting-base64url-encoded-string-to-arraybuffer) for details on converting this value for the [WebAuthn JavaScript API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API) call.
  </APIField>
  <APIField name="options.user.name" type="String">
    A human-readable name for the passkey intended for display. This value is meant to disambiguate between passkeys with a similar <InlineField>displayName</InlineField>.
  </APIField>
</APIBlock>


<JSON title="Example Response JSON" src="webauthn/register-start-response.json" />
