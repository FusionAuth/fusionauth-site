---
title: Users
description: Learn about the APIs for creating, retrieving, updating, deleting, importing, searching for and verifying users.
section: apis
---
import APIBlock from 'src/components/api/APIBlock.astro';
import APIField from 'src/components/api/APIField.astro';
import API from 'src/components/api/API.astro';
import Aside from 'src/components/Aside.astro';
import DeprecatedSince from 'src/components/api/DeprecatedSince.astro';
import GenericUpdateExplanationFragment from 'src/content/docs/apis/_generic-update-explanation-fragment.mdx';
import ImportUsersRequestBody from 'src/content/docs/apis/_import-users-request-body.mdx';
import InlineField from 'src/components/InlineField.astro';
import JSON from 'src/components/JSON.astro';
import PremiumEditionBlurbApi from 'src/content/docs/_shared/_premium-edition-blurb-api.astro';
import {RemoteCode} from '@fusionauth/astro-components';
import ScrollRef from 'src/components/ScrollRef.astro';
import SearchPreprocessingWarning from "src/content/docs/_shared/_search-preprocessing-warning.mdx";
import StandardDeleteResponseCodes from 'src/content/docs/apis/_standard-delete-response-codes.astro';
import StandardGetResponseCodes from 'src/content/docs/apis/_standard-get-response-codes.astro';
import StandardPostResponseCodes from 'src/content/docs/apis/_standard-post-response-codes.astro';
import StandardPutResponseCodes from 'src/content/docs/apis/_standard-put-response-codes.astro';
import UserBulkDeleteRequestBody from 'src/content/docs/apis/_user-bulk-delete-request-body.mdx';
import UserBulkDeleteResponseBody from 'src/content/docs/apis/_user-bulk-delete-response-body.mdx';
import UsersRefreshTokensRequestBody from 'src/content/docs/apis/_users-refresh-tokens-request-body.mdx';
import UserRequestBody from 'src/content/docs/apis/_user-request-body.mdx';
import UserResponseBody from 'src/content/docs/apis/_user-response-body.mdx';
import UserSearchRequestBodyDatabaseExamples from 'src/content/docs/apis/_user-search-request-body-database-examples.mdx';
import UserSearchRequestBodyElasticsearchExamples from 'src/content/docs/apis/_user-search-request-body-elasticsearch-examples.mdx';
import UserSearchRequestParameters from 'src/content/docs/apis/_user-search-request-parameters.mdx';
import UsersResponseBody from 'src/content/docs/apis/_users-response-body.mdx';
import XFusionauthTenantIdHeaderAmbiguousOperation from 'src/content/docs/apis/_x-fusionauth-tenant-id-header-ambiguous-operation.mdx';
import XFusionauthTenantIdHeaderCreateOperation from 'src/content/docs/apis/_x-fusionauth-tenant-id-header-create-operation.mdx';
import XFusionauthTenantIdHeaderScopedOperation from 'src/content/docs/apis/_x-fusionauth-tenant-id-header-scoped-operation.mdx';
import ChangePassResponseCodes from './_change-pass-response-codes.astro';

## Overview

This page contains all of the APIs for managing users.

## Create a User

This API is used to create a new User.

### Request

<API method="POST" uri="/api/user" authentication={["api-key"]} title="Create a User with a randomly generated Id"/>

<API method="POST" uri="/api/user/{userId}" authentication={["api-key"]} title="Create a User with the provided unique Id"/>

<XFusionauthTenantIdHeaderCreateOperation />

#### Request Parameters

<APIBlock>
  <APIField name="userId" type="UUID" optional defaults="secure random UUID">
    The Id to use for the new User. If not specified a secure random UUID will be generated.
  </APIField>
</APIBlock>

<UserRequestBody http_method="POST" />

### Response

The response for this API contains the User that was just created. The password, salt and other sensitive fields will not be returned on the API response.

<StandardPostResponseCodes webhook_event create_user />

<UserResponseBody create_user />

## Retrieve a User

This API is used to retrieve the information about a single User. You can use the User's Id, username or email address to retrieve the User. The Id is specified on the URI and the username or email are specified as URL parameters.

### Request

<API method="GET" uri="/api/user/{userId}" authentication={["api-key"]} title="Retrieve a User by Id"/>

#### Request Parameters

<APIBlock>
  <APIField name="userId" type="UUID" required>
    The unique Id of the User to retrieve.
  </APIField>
</APIBlock>

<XFusionauthTenantIdHeaderScopedOperation />

<API method="GET" uri="/api/user?loginId={loginId}" authentication={["api-key"]} title="Retrieve a User by login Id"/>

#### Request Parameters

<APIBlock>
  <APIField name="loginId" type="String" required>
    The unique Id of the User to retrieve. The loginId can be either the email or username.
  </APIField>
</APIBlock>

<XFusionauthTenantIdHeaderAmbiguousOperation />

<API method="GET" uri="/api/user?email={email}" authentication={["api-key"]} title="Retrieve a User by email"/>

#### Request Parameters

<APIBlock>
  <APIField name="email" type="String" required>
    The email of the User to retrieve.
  </APIField>
</APIBlock>

<XFusionauthTenantIdHeaderAmbiguousOperation />

<API method="GET" uri="/api/user?username={username}" authentication={["api-key"]} title="Retrieve a User by username"/>

#### Request Parameters

<APIBlock>
  <APIField name="username" type="String" required>
    The username of the User to retrieve.
  </APIField>
</APIBlock>

<XFusionauthTenantIdHeaderAmbiguousOperation />

<API method="GET" uri="/api/user?changePasswordId={changePasswordId}" authentication={["api-key"]} title="Retrieve a User by Change Password Id"/>

#### Request Parameters

<APIBlock>
  <APIField name="changePasswordId" type="String" required>
    The change password Id associated with the user when the Forgot Password workflow has been started.
  </APIField>
</APIBlock>

<XFusionauthTenantIdHeaderScopedOperation />

<API method="GET" uri="/api/user?verificationId={verificationId}" authentication={["api-key"]} title="Retrieve a User by Email Verification Id"/>

#### Request Parameters

<APIBlock>
  <APIField name="verificationId" type="String" required>
    The verification Id associated with the user when the Email verification process has been started.
  </APIField>
</APIBlock>

<XFusionauthTenantIdHeaderScopedOperation />

<API method="GET" uri="/api/user" authentication={["jwt"]} title="Retrieve a User using a JWT"/>

<DeprecatedSince since="1.50.0" />

<XFusionauthTenantIdHeaderScopedOperation />

### Response

The response for this API contains the User.

<StandardGetResponseCodes />

<UserResponseBody retrieve_user />

## Update a User

<GenericUpdateExplanationFragment capitalized_object_name="User" />

If you specify a new password for the User, it will be encrypted and stored. However, if you do not provide a new password, the User's old password will be preserved. This is the only field that is merged during an update using the `PUT` method.

### Request

<API method="PUT" uri="/api/user/{userId}" authentication={["api-key"]} showPatch={true} title="Update the User with the given Id"/>

#### Request Parameters

<APIBlock>
  <APIField name="userId" type="UUID" required>
    The Id of the User to update.
  </APIField>
</APIBlock>

<XFusionauthTenantIdHeaderScopedOperation />

<UserRequestBody http_method="PUT" />

### Response

The response for this API contains the User that was updated. The password hash and other sensitive fields are never returned on the API response.

<StandardPutResponseCodes webhook_event />

<UserResponseBody update_user />


## Delete a User

This API is used to delete a User. You must specify the Id of the User on the URI. You can also specify whether or not the User is soft or hard deleted. A soft delete deactivates the User. A hard delete permanently deletes a User's data.

Soft deleted users are marked as inactive but not deleted from FusionAuth. Deactivated users have their data retained but they are unable to authenticate. Users who have been deactivated can be reactivated; see <ScrollRef target="Reactivate a User" /> for more.

The data of a User who has been hard deleted is permanently removed from FusionAuth. The User's data cannot be restored via the FusionAuth API or the administrative user interface. If you need to restore the User's data, you must retrieve it from a database backup.

### Request

<API method="DELETE" uri="/api/user/{userId}" authentication={["api-key"]} title="Deactivate a User (Soft Delete)"/>
<API method="DELETE" uri="/api/user/{userId}?hardDelete=true" authentication={["api-key"]} title="Permanently Delete a User"/>

#### Request Parameters

<APIBlock>
  <APIField name="userId" type="UUID" required>
    The Id of the User to delete.
  </APIField>
  <APIField name="hardDelete" type="Boolean" optional defaults="false">
    To Permanently delete a user from FusionAuth set this value to `true`. Once a user has been permanently deleted, the action cannot be undone. When this value is set to `false` the user is marked as inactive and the user will be unable log into FusionAuth. This action may be undone by reactivating the user.
  </APIField>
</APIBlock>

<XFusionauthTenantIdHeaderScopedOperation />

### Response

This API does not return a JSON response body.

<StandardDeleteResponseCodes webhook_event />

## Bulk Delete Users
This API is used to deactivate or delete multiple users in a single request.

<Aside type="note">
This API has some limitations when FusionAuth is configured to use the database as the user search engine.  These limitations are noted on the impacted request parameters below.
</Aside>

### Request

<API method="DELETE" uri="/api/user/bulk?userId={userId}&userId={userId}" authentication={["api-key"]} title="Deactivate Users by User Id"/>

<API method="DELETE" uri="/api/user/bulk?queryString={queryString}&dryRun=false&limit=10000" authentication={["api-key"]} title="Deactivate Users by Search Query String"/>

<API method="DELETE" uri="/api/user/bulk?query={query}&dryRun=false&limit=10000" authentication={["api-key"]} title="Deactivate Users by Raw JSON Search Query"/>

<API method="DELETE" uri="/api/user/bulk?userId={userId}&userId={userId}&hardDelete=true" authentication={["api-key"]} title="Permanently Delete Users by User Id"/>

<API method="DELETE" uri="/api/user/bulk?queryString={queryString}&hardDelete=true&dryRun=false&limit=10000" authentication={["api-key"]} title="Permanently Delete Users by Search Query String"/>

<API method="DELETE" uri="/api/user/bulk?query={query}&hardDelete=true&dryRun=false&limit=10000" authentication={["api-key"]} title="Permanently Delete Users by Raw JSON Search Query"/>

#### Request Parameters

<APIBlock>
  <APIField name="dryRun" type="Boolean" optional defaults="false">
    To preview the user Ids to be deleted by the request without applying the requested action set this value to `true`.
  </APIField>
  <APIField name="hardDelete" type="Boolean" optional defaults="false">
    To Permanently delete a user from FusionAuth set this value to `true`. Once a user has been permanently deleted, the action cannot be undone. When this value is set to `false` the user is marked as inactive and the user will be unable log into FusionAuth. This action may be undone by reactivating the user.
  </APIField>
  <APIField name="limit" type="Integer" optional defaults="10,000" since="1.48.0">
    The maximum number of users to delete in one call.

    You may use this parameter to process deletes in batches in order to limit individual request processing time and the number of user Ids on the response.
  </APIField>
  <APIField name="query" type="String" optional since="1.13.0">
    The raw JSON Elasticsearch query that is used to search for Users. The <InlineField>userId</InlineField>, <InlineField>query</InlineField>, and <InlineField>queryString</InlineField>  parameters are mutually exclusive, they are listed here in order of precedence.

    It is necessary to use the <InlineField>query</InlineField> parameter when querying against `registrations` in order to achieve expected results, as this field is defined as a [nested datatype](https://www.elastic.co/guide/en/elasticsearch/reference/6.3/nested.html) in the Elasticsearch mapping.

    <Aside type="note" title="Database search engine">
      This parameter is not compatible with the database search engine, it may only be used when Elasticsearch is configured as the user search engine.
    </Aside>
  </APIField>
</APIBlock>

<APIField name="queryString" type="String" optional since="1.13.0">
  The Elasticsearch query string that is used to search for Users to be deleted. The <InlineField>userId</InlineField>, <InlineField>query</InlineField>, and <InlineField>queryString</InlineField>  parameters are mutually exclusive, they are listed here in order of precedence.

  <SearchPreprocessingWarning/>

  <Aside type="note" title="Database search engine">
    The Elasticsearch query string DSL is not supported for the database search engine.  Database search limits effective queries to single search terms that may match the following fields on the User:
    * `firstName`
    * `lastName`
    * `fullName`
    * `email`
    * `username`

    The following is an example bulk delete request with a `queryString` value that is compatible with the database search engine:

    <code>DELETE /api/user/bulk?queryString=jared%40fusionauth.io</code>
  </Aside>
</APIField>


<APIField name="userId" type="UUID" optional>
  The Id of the User to delete. Repeat this parameter for each user to be deleted. The <InlineField>userId</InlineField>, <InlineField>query</InlineField>, and <InlineField>queryString</InlineField>  parameters are mutually exclusive, they are listed here in order of precedence.
</APIField>

<XFusionauthTenantIdHeaderScopedOperation />

<API method="DELETE" uri="/api/user/bulk" authentication={["api-key"]} title="Bulk delete using the request body. This allows for larger requests than are possible using request parameters."/>

<XFusionauthTenantIdHeaderScopedOperation />

<UserBulkDeleteRequestBody />

### Response

The response for this API contains the information for the Users that were affected by the request.

<StandardDeleteResponseCodes success_code="200" success_message="The request was successful. The response will contain a JSON body." webhook_event />

<UserBulkDeleteResponseBody />

## Reactivate a User

This API is used to reactivate an inactive Users. You must specify the Id of the User on the URI.

### Request

<API method="PUT" uri="/api/user/{userId}?reactivate=true" authentication={["api-key"]} title="Reactivate the User"/>

#### Request Parameters

<APIBlock>
  <APIField name="userId" type="UUID" required>
    The Id of the User to reactivate.
  </APIField>
</APIBlock>

<XFusionauthTenantIdHeaderScopedOperation />

### Response

The response for this API contains the information for the User that was reactivated.

<StandardPutResponseCodes webhook_event />

<UserResponseBody />


## Import Users

This API is used to bulk import multiple Users into FusionAuth. Each User must have at least an **email** or a **username**. This request is useful for migrating data from an existing database into FusionAuth. Additionally, you can provide an Id for each User inside the JSON User object of the request body. When using this API you should import with batches of less than 10,000 users per request. After completing an import you should [reindex of the Elasticsearch database](/docs/lifecycle/manage-users/search/search#reindexing-elasticsearch) as well. 

### Request

<API method="POST" uri="/api/user/import" authentication={["api-key"]} title="Import Multiple Users"/>

<XFusionauthTenantIdHeaderCreateOperation />

<ImportUsersRequestBody />

### Response

Only a status code is available on the Import API, no JSON body will be returned.

<StandardPostResponseCodes webhook_event />

## Password Hashes

Password hashes can be imported into FusionAuth. This allows users to transparently use their old passwords while at no time exposing the plaintext password. This section contains details about importing specific password hashes.

You can also learn more about hashes in the [password hashing reference](/docs/reference/password-hashes), and you can [implement your own custom hash](/docs/extend/code/password-hashes/custom-password-hashing) as well.

### Encoding

The standard FusionAuth password hashing schemes require the password hash to be a base64 encoded string.  If your password hashes are encoded in a different format, they will need to either be converted and imported as base64, or you can create a custom plugin using an alternative encoding.  You can see an example of converting below.

It is recommended to use a base64 encoded string, but if importing hashes from a legacy system that uses base16, base32, or another encoding, import the hash in the same format the plugin produces.

<RemoteCode lang="ruby" title="Example of Converting a Base16 Password Hash Value to Base64"
            url="https://raw.githubusercontent.com/FusionAuth/fusionauth-example-scripts/master/import-helpers/convert-md5-hexadecimal-to-base64.rb" />

### Bcrypt

When importing a bcrypt hash, you may have a value such as:

`$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy`

This single string represents the bcrypt version, factor, salt and hash.

The number before the final `$` is the factor, the 22 characters after the final `$` is the salt and the last 31 characters are the hash.

For the above bcrypt hash, `10` is the factor and should be placed in the <InlineField>factor</InlineField> field.  `N9qo8uLOickgx2ZMRZoMye` is the salt and should be placed in the <InlineField>salt</InlineField> field.  `IjZAgcfl7p92ldGxad68LJZdL17lhWy` is the hash value and should be placed in the <InlineField>password</InlineField> field.

### MD5

When importing an MD5 password hash, you may not have a salt. If this is the case, use the empty string, `''`, as the salt. You may still use the salted MD5 plugin provided by FusionAuth.

MD5 is commonly stored in hexadecimal format, such as `25d55ad283aa400af464c76d713c07ad`. The FusionAuth Import Users API requires imported password hashes to be base64 encoded. Convert any hexadecimal values to base64 before importing, or the import will not work.

Here is an example ruby script to convert hexadecimal values to base64 encoded:

<RemoteCode lang="ruby" title="Convert a Hexadecimal Password Hash Value to Base64"
            url="https://raw.githubusercontent.com/FusionAuth/fusionauth-example-scripts/master/import-helpers/convert-md5-hexadecimal-to-base64.rb" />


## Import Refresh Tokens

<Aside type="version">
Available Since Version 1.19.0
</Aside>

This API is used to import refresh tokens from an external system, this would generally be done during an initial user import or as an auxiliary step during a migration strategy.

Before using this API, create the Users, Applications and User Registrations. A validation error will be returned if the user does not exist, or is not registered for the application.

### Request

<API method="POST" uri="/api/user/refresh-token/import" authentication={["api-key"]} title="Import Refresh Tokens"/>

<XFusionauthTenantIdHeaderCreateOperation />

<UsersRefreshTokensRequestBody />

### Response

The response does not contain a body, the HTTP status code will indicate the result of the request.

<StandardGetResponseCodes never_missing never_search_error success_code="200" success_message="The request was successful." />

## Search for Users

This API is used to search for Users.
This API may be called using the `GET` or `POST` HTTP methods, examples of each are provided below.
The `POST` method is provided to allow for a richer request object without worrying about exceeding the maximum length of a URL.
Calling this API with either the `GET` or `POST` HTTP method will provide the same search results given the same query parameters.

### Request

Which search query parameters are available and how they behave depends on the search engine type. Read more about [the different types of search engines](/docs/get-started/core-concepts/users#user-search).

### Database Search Engine

This is a good choice for [smaller installs, embedded scenarios, or other places where the additional capability of Elasticsearch is not required](/docs/get-started/core-concepts/users#database-search-engine).

<Aside type="version">
Available Since Version 1.16.0
</Aside>


<API method="GET" uri="/api/user/search?ids={uuid}&ids={uuid}" authentication={["api-key"]} title="Search for Users by Id"/>

<API method="GET" uri="/api/user/search?queryString={queryString}" authentication={["api-key"]} title="Search for Users by a query string"/>

<API method="GET" uri="/api/user/search?queryString={queryString}&sortFields[0].name={name}&sortFields[0].order={order}" authentication={["api-key"]} title="Search for Users by a query string and sort the response"/>

#### Request Parameters

<UserSearchRequestParameters query_string_request database_search_engine_type parameter_prefix="" />

<XFusionauthTenantIdHeaderScopedOperation />

<API method="POST" uri="/api/user/search" authentication={["api-key"]} title="Search for Users using a JSON request body. This allows for larger requests than are possible using request parameters."/>

<XFusionauthTenantIdHeaderScopedOperation />

#### Request Body

<UserSearchRequestParameters database_search_engine_type parameter_prefix="search." />

##### Request Body Examples

<UserSearchRequestBodyDatabaseExamples />

### Elasticsearch Search Engine

The Elasticsearch engine has [advanced querying capabilities and better performance](/docs/get-started/core-concepts/users#elasticsearch-search-engine). You can also review the [Elasticsearch search guide](/docs/lifecycle/manage-users/search/user-search-with-elasticsearch) for more examples.

<API method="GET" uri="/api/user/search?ids={uuid}&ids={uuid}" authentication={["api-key"]} title="Search for Users by Id"/>

<API method="GET" uri="/api/user/search?queryString={queryString}" authentication={["api-key"]} title="Search for Users by a query string"/>

<API method="GET" uri="/api/user/search?queryString={queryString}&sortFields[0].name={name}&sortFields[0].order={order}" authentication={["api-key"]} title="Search for Users by a query string and sort the response"/>

<API method="GET" uri="/api/user/search?query={query}" authentication={["api-key"]} title="Search for Users by a raw JSON query"/>

<API method="GET" uri="/api/user/search?nextResults={nextResults}" authentication={["api-key"]} title="Search for Users with a nextResults token"/>

#### Request Parameters

<UserSearchRequestParameters query_string_request elasticsearch_search_engine_type parameter_prefix='' />

<XFusionauthTenantIdHeaderScopedOperation />

<API method="POST" uri="/api/user/search" authentication={["api-key"]} title="Search for Users using a JSON request body. This allows for larger requests than are possible using request parameters."/>

<XFusionauthTenantIdHeaderScopedOperation />

#### Request Body

<UserSearchRequestParameters elasticsearch_search_engine_type parameter_prefix="search." />

##### Request Body Examples

<UserSearchRequestBodyElasticsearchExamples />

### Response

The response contains the User objects that were found as part of the lookup or search. Both the database and Elasticsearch search engines return the response in the same format.

<StandardGetResponseCodes />

<UsersResponseBody search_result />


## Flush the Search Engine

This API is used to issue a flush request to the FusionAuth Search. This will cause any cached data to be written to disk. In practice it is unlikely
 you'll find a need for this API in production unless you are performing search requests immediately following an operation that modifies the index and
  expecting to see the results immediately.

### Request

<API method="PUT" uri="/api/user/search" authentication={["api-key"]} title="Flushes the Search Engine"/>

### Response

The response does not contain a body. It only contains one of the status codes below.

<StandardPostResponseCodes />


## Retrieve Recent Logins

<Aside type="version">
Available Since Version 1.4.0
</Aside>

This API is used to retrieve recent logins.

### Request

<API method="GET" uri="/api/user/recent-login?limit={limit}&offset={offset}&userId={userId}" authentication={["api-key"]} title="Retrieve recent logins"/>

#### Request Parameters

<APIBlock>
  <APIField name="limit" type="Integer" optional defaults="10">
    This parameter indicates the maximum amount of logins to return for a single request.
  </APIField>
  <APIField name="offset" type="Integer" optional defaults="0">
    This parameter provides the offset into the result set. Generally speaking if you wish to paginate the results, you will increment this parameter on subsequent API request by the size of the `limit` parameter.
  </APIField>
  <APIField name="userId" type="UUID" optional>
    This parameter will narrow the results to only logins for a particular user. When this parameter is omitted, the most recent logins for all of FusionAuth will be returned.
  </APIField>
</APIBlock>

<XFusionauthTenantIdHeaderScopedOperation />

### Response

The response will contain recent logins containing no more than the value set by the `limit` parameter. By design, this API does not return the total number of results and only lets paginate through the results from newest to oldest.

<StandardGetResponseCodes />

#### Response Body

<APIBlock>
  <APIField name="logins" type="Array">
    A list of recent logins.
  </APIField>
  <APIField name="logins[x].applicationId" type="UUID">
    The unique Id of the application that is represented by this login record.
  </APIField>
  <APIField name="logins[x].applicationName" type="String">
    The name of the application at the time this record was created.
  </APIField>
  <APIField name="logins[x].instant" type="Long">
    The [instant](/docs/reference/data-types#instants) this login occurred.
  </APIField>
  <APIField name="logins[x].ipAddress" type="String">
    The IP address if provided during the login request.
  </APIField>
  <APIField name="logins[x].location.city" type="String" since="1.30.0">
    The city where the login request originated.

<PremiumEditionBlurbApi feature="login location" />

  </APIField>
  <APIField name="logins[x].location.country" type="String" since="1.30.0">
    The country where the login request originated.

<PremiumEditionBlurbApi feature="login location" />

  </APIField>
  <APIField name="logins[x].location.latitude" type="Double" since="1.30.0">
    The latitude where the login request originated.

<PremiumEditionBlurbApi feature="login location" />

  </APIField>
  <APIField name="logins[x].location.longitude" type="Double" since="1.30.0">
    The longitude where the login request originated.

<PremiumEditionBlurbApi feature="login location" />

  </APIField>
  <APIField name="logins[x].location.region" type="String" since="1.30.0">
    The geographic location where the login request originated.

<PremiumEditionBlurbApi feature="login location" />

  </APIField>
  <APIField name="logins[x].location.zipcode" type="String" since="1.30.0">
    The zipcode where the login request originated.

<PremiumEditionBlurbApi feature="login location" />

  </APIField>
  <APIField name="logins[x].loginId" type="String">
    The User's email address or username at the time of the login request.
  </APIField>
  <APIField name="logins[x].userId" type="UUID">
    The unique Id of the user that is represented by this login record.
  </APIField>
</APIBlock>

<JSON title="Example Response JSON" src="users/recent-logins-response.json" />

## Verify a User's Email

This API is used to mark a User's email as verified. This is usually called after the User receives the verification email after they register and they click the link in the email.

### Request

<API method="POST" uri="/api/user/verify-email" authentication={["none"]} title="Verifies the User's email address using the verificationId."/>
<API method="POST" uri="/api/user/verify-email/{verificationId}" authentication={["none"]} title="Verifies the User's email address using the verificationId."/>

#### Request Parameters

<APIBlock>
  <APIField name="verificationId" type="String" required deprecated>
    The verification Id generated by FusionAuth used to verify the User's registration is valid by ensuring they have access to the provided email address.

    <DeprecatedSince since="1.28.0" />

    This value can still be provided on the URL segment as shown in the above example, but it is recommended you send this value in the request body instead using the <InlineField>verificationId</InlineField> field. If the value is provided in the URL segment and in the request body, the value provided in the request body will be preferred.
  </APIField>
</APIBlock>

#### Request Body

<APIBlock>
  <APIField name="oneTimeCode" type="String" optional since="1.27.0">
    The short code used to verify the User's account is valid by ensuring they have access to the provided email address. This field is required when the email <InlineField>verification strategy</InlineField> on the Tenant is set to `Form field`.
  </APIField>
  <APIField name="verificationId" type="String" required since="1.27.0">
    The verification Id generated by FusionAuth used to verify the User's account is valid by ensuring they have access to the provided email address.

    When using the `Form field` strategy for Email verification, this value is used along with the `oneTimeCode` as a pair to verify the email address.

    If the <InlineField>verificationId</InlineField> is provided in the URL segment and in the request body, the value provided in the request body will be preferred.
  </APIField>
</APIBlock>

<XFusionauthTenantIdHeaderScopedOperation />

<Aside type="version">
Available since version 1.37.0
</Aside>

This API can be used to mark a user as verified without requiring the user to actually complete a verification process.

<API method="POST" uri="/api/user/verify-email" authentication={["api-key"]} title="Administratively verify the User's email address."/>

#### Request Body

<APIBlock>
  <APIField name="userId" type="String" required>
    The unique Id of the user to mark verified.
  </APIField>
</APIBlock>

### Response

The response does not contain a body. It only contains one of the status codes below.

<StandardPutResponseCodes />


## Resend Verification Email

This API is used to resend the verification email to a User. This API is useful if the User has deleted the email, or the verification Id has expired. By default, the verification Id will expire after 24 hours. You can modify this duration in the Tenant settings.

### Request

<API method="PUT" uri="/api/user/verify-email?applicationId={applicationId}&email={email}" authentication={["none"]} title="Resend the verification email"/>

#### Request Parameters

<APIBlock>
  <APIField name="applicationId" type="String" optional since="1.21.0">
    The Id of the application. If valid, the email template configured in the Application settings will be used, if present. If not present, the email template configured in the Tenant settings will be used. In either case, the corresponding Application object will be available to the template.
  </APIField>
  <APIField name="email" type="String" required>
    The email address used to uniquely identify the User.
  </APIField>
</APIBlock>

<XFusionauthTenantIdHeaderAmbiguousOperation />

<API method="PUT" uri="/api/user/verify-email?applicationId={applicationId}&email={email}&sendVerifyEmail={sendVerifyEmail}" authentication={["api-key"]} title="Resend the verification email using an API key"/>

#### Request Parameters

<APIBlock>
  <APIField name="applicationId" type="String" optional since="1.21.0">
    The Id of the application. If valid, the email template configured in the Application settings will be used, if present. If not present, the email template configured in the Tenant settings will be used. In either case, the corresponding Application object will be available to the template.
  </APIField>
  <APIField name="email" type="String" required>
    The email address used to uniquely identify the User.
  </APIField>
  <APIField name="sendVerifyEmail" type="Boolean" optional defaults="true">
    If you would only like to generate a new <InlineField>verificationId</InlineField> and return it in the JSON body without FusionAuth attempting to send the User an email
    set this optional parameter to `false`.

    This may be useful if you need to integrate the Email Verification process using a third party messaging service.
  </APIField>
</APIBlock>

<XFusionauthTenantIdHeaderAmbiguousOperation />

### Response

When authenticated using an API key a response body will be provided. If an API key was not used to authenticate the request no body is returned.

<StandardPutResponseCodes success_code="200" success_message="The request was successful. The response will contain a JSON body if an API key was used for authentication. If no API key was provided no response body will be returned." />

#### Response Body

<APIBlock>
  <APIField name="verificationId" type="String">
    The email verification Id that was generated by this API request. This identifier may be used by the <ScrollRef target="Verify a User's Email" /> API.
    This field is only returned in the JSON response body if the request was authenticated using an API key, if an API key is not used no response body is returned.
  </APIField>
  <APIField name="verificationOneTimeCode" type="String">
    Depending on your tenant configuration, this may be returned. The verification One Time Code is used with the gated Email Verification workflow. The user enters this code to verify their email.

<PremiumEditionBlurbApi feature="gated email" />


  </APIField>
</APIBlock>


<JSON title="Example Response JSON" src="users/resend-verify-email-response.json" />

## Start Forgot Password Workflow

This API is used to start the forgot password workflow for a single User.

For example, on your login form you may have a button for _Forgot your password_. This would be the API you would call to initiate the request for the user. If the email configuration is complete, the user will be sent the forgot password email containing a link containing the `changePasswordId`. The provided link should take the user to a form that allows them to change their password. This form should contain a hidden field for the `changePasswordId` generated by this API.

By default the `changePasswordId` is valid to be used with the [Change Password](#change-a-users-password) API for 10 minutes. If a `404` is returned when using this Id to change the password, the workflow
will need to be started again to generate a new identifier. This duration can be modified using the Tenant API or in the FusionAuth UI.

You may optionally authenticate this request with an API key to allow for some additional request parameters and the generated `changePasswordId` will be returned in the JSON body. This may be helpful if you wish to use your own email system or you have an alternative method to call the [Change Password](#change-a-users-password) API.

<Aside type="note">
If FusionAuth sends an email to the user, it will either use the `email` top level property on the user or it will use a custom data attribute named `email` as well (i.e. `data.email`). This allows you to have a user that has no email address for login or allow distinct users to share email addresses.
</Aside>

### Request

<API method="POST" uri="/api/user/forgot-password" authentication={["none"]} title="Start the forgot password workflow without an API Key."/>

<XFusionauthTenantIdHeaderAmbiguousOperation />

#### Request Body

<APIBlock>
  <APIField name="applicationId" type="UUID" optional since="1.21.0">
    The Id of the application. If valid, the email template configured in the Application settings will be used, if present. If not present, the email template configured in the Tenant settings will be used. In either case, the corresponding Application object will be available to the template.
  </APIField>
  <APIField name="loginId" type="String" required>
    The login identifier of the user. The login identifier can be either the `email` or the `username`. The username is not case sensitive.
  </APIField>
  <APIField name="state" type="Object" optional>
    An optional object that will be returned un-modified when you complete the forgot password request. This may be useful to return the user to particular state once they complete the password change.
  </APIField>
</APIBlock>

<JSON title="Example Request JSON" src="users/forgot-password-request.json" />

<API method="POST" uri="/api/user/forgot-password" authentication={["api-key"]} title="Start the forgot password workflow using an API key"/>

<XFusionauthTenantIdHeaderAmbiguousOperation />

#### Request Body

<APIBlock>
  <APIField name="applicationId" type="UUID" optional since="1.21.0">
    The Id of the application. If valid, the email template configured in the Application settings will be used, if present. If not present, the email template configured in the Tenant settings will be used. In either case, the corresponding Application object will be available to the template.
  </APIField>
  <APIField name="changePasswordId" type="String" optional>
    The optional change password Id to be used on the <ScrollRef target="Change a User's Password" /> API.

    It is recommended to omit this parameter and allow FusionAuth to generate the identifier. Use this parameter only if you must supply your own value for integration into existing systems.
  </APIField>
  <APIField name="loginId" type="String" required>
    The login identifier of the user. The login identifier can be either the `email` or the `username`. The username is not case sensitive.
  </APIField>
  <APIField name="sendForgotPasswordEmail" type="Boolean" optional defaults="true">
    Whether or not calling this API should attempt to send the user an email using the configured Forgot Password email template. Setting this to `false` will begin the Forgot Password workflow without sending an email and only create the `changePasswordId`, this may be useful if you want to send an email outside of FusionAuth, or complete this workflow without the use of email.

    <span class="text-green-800">Since 1.43.0</span>

    Beginning in version `1.43.0`, when setting this to `false` you will not be required to have configured the Forgot Password email template in the FusionAuth tenant. Prior to this version, even when setting this to `false` the Tenant would be required to have configured the Forgot Password email template.
  </APIField>
  <APIField name="state" type="Object" optional>
    An optional object that will be returned un-modified when you complete the forgot password request. This may be useful to return the user to particular state once they complete the password change.
  </APIField>
</APIBlock>

<JSON title="Example Request JSON" src="users/forgot-password-request-advanced.json" />

### Response

*Response Codes*
|Code |Description |
| --- | --- |
|200 |The request was successful. A JSON response body will be provided when authenticated using an API key, when the API key has been omitted from the request, no response body is provided. |
|400 |The request was invalid and/or malformed. The response will contain an [Errors](/docs/apis/errors) JSON Object with the specific errors. |
|401 |You did not supply a valid Authorization header. The header was omitted or your API key was not valid. The response will be empty. See [Authentication](/docs/apis/authentication). |
|403 |The forgot password functionality has been disabled. This is caused by an administrator setting the Forgot Password Email Template to the option _Feature Disabled. No template selected._ in the Tenant Email configuration. See <strong>Tenants -> Email -> Template settings</strong> in the FusionAuth admin UI. |
|404 |The User could not be found. |
|422 |The User does not have an email address, this request cannot be completed. Before attempting the request again add an email address to the user. |
|500 |There was an internal error. A stack trace is provided and logged in the FusionAuth log files. |
|503 |The search index is not available or encountered an exception so the request cannot be completed. The response will contain a JSON body.| |

#### Response Body

<APIBlock>
  <APIField name="changePasswordId" type="String">
    The change password Id that was generated by this API request. This identifier may be used by the <ScrollRef target="Change a User's Password" /> API. This field is only returned in the JSON response body if the request was authenticated using an API key, if an API key is not used no response body is returned.
  </APIField>
</APIBlock>

<JSON title="Example Response JSON" src="users/forgot-password-response.json" />


## Change a User's Password

This API is used to change the User's password.

This API may be used as the second part of the Forgot Password workflow. For example, after the User is sent an email that contains a link to a web form that allows them to update their password you will call this API with the `changePasswordId` and their updated password. If the `changePasswordId` is valid then the User's password will be updated.

This API may also be used separately from the Forgot Password workflow by omitting the `changePasswordId` and using the `loginId` instead.

By default the `changePasswordId` is valid for 10 minutes after it was generated. If a `404` is returned when using the change password Id, the workflow will need to be started again to generate a new identifier. This duration can be modified using the System Configuration API or in the FusionAuth UI.


<Aside type="note">
When this API successfully completes, all refresh tokens and outstanding Change Password Ids (i.e. `changePasswordId`) currently assigned to the user will be expired or revoked. This means
that if a user is using a refresh token they will be forced to re-authenticate with their new password.
</Aside>


### Request

This usage is generally intended to be part of an email workflow and does not require authentication. The `changePasswordId` used on this API request will have been previously generated by the Start Forgot Password API or by using the Forgot Password workflow on the FusionAuth login page.

<API method="POST" uri="/api/user/change-password" authentication={["none"]} title="Change a User’s password using the change password Id"/>
<API method="POST" uri="/api/user/change-password/{changePasswordId}" authentication={["none"]} title="Change a User’s password using the change password Id"/>

#### Request Parameters

<APIBlock>
  <APIField name="changePasswordId" type="String" required deprecated>
    The `changePasswordId` that is used to identity the user after the Start Forgot Password workflow has been initiated.

    If this `changePasswordId` was sent via an email to the User by FusionAuth during User create in order to set up a new password, or as part of a Forgot Password request, then successful use of this identifier to change the User's password will implicitly complete Email Verification if not already verified and the Tenant configuration has enabled implicit email verification.

    <DeprecatedSince since="1.33.0" />

    This value can still be provided on the URL segment as shown in the above example, but it is recommended you send this value in the request body instead using the <InlineField>changePasswordId</InlineField> field. If the value is provided in the URL segment and in the request body, the value provided in the request body will be preferred.
  </APIField>
</APIBlock>

<XFusionauthTenantIdHeaderScopedOperation />

#### Request Body

<APIBlock>
  <APIField name="changePasswordId" type="String" required since="1.33.0">
    The `changePasswordId` that is used to identity the user after the Start Forgot Password workflow has been initiated.

    If this `changePasswordId` was sent via an email to the User by FusionAuth during User create in order to set up a new password, or as part of a Forgot Password request, then successful use of this identifier to change the User's password will implicitly complete Email Verification if not already verified and the Tenant configuration has enabled implicit email verification.

    If the <InlineField>changePasswordId</InlineField> is provided in the URL segment and in the request body, the value provided in the request body will be preferred.
  </APIField>
  <APIField name="currentPassword" type="String" optional>
    The User's current password. When this parameter is provided the current password will be verified to be correct.
  </APIField>
  <APIField name="password" type="String" required>
    The User's new password.
  </APIField>
  <APIField name="trustChallenge" type="String" optional since="1.33.0">
    This field is marked optional because it is only required when the user has enabled two-factor authentication, and a `trustChallenge` was provided on the Two-Factor Start API request. When a user has enabled two-factor authentication this field becomes required if a `trustChallenge` was provided on the Two-Factor Start API request. When required, this value must be equal to the value provided to the Two-Factor Start API.
  </APIField>
  <APIField name="trustToken" type="String" optional since="1.33.0">
    This field is marked optional, because it is only required when the user has enabled two-factor authentication. When a user has enabled two-factor authentication this field becomes required when attempting to change a password using the `changePasswordId`.
  </APIField>
</APIBlock>

<JSON title="Example JSON Request" src="users/change-password-request.json" />

This usage requires and API key and allows you to change any user's password if you have a unique email or username.

<API method="POST" uri="/api/user/change-password" authentication={["api-key"]} title="Changes a User's password using an email address or username."/>

<XFusionauthTenantIdHeaderAmbiguousOperation />

#### Request Body

<APIBlock>
  <APIField name="applicationId" type="UUID" optional since="1.30.0">
    An optional Application Id. When this value is provided, it will be used to resolve an application specific email template if you have configured transactional emails such as setup password, email verification and others.

    If not provided, only the tenant configuration will be used when resolving email templates.
  </APIField>
  <APIField name="currentPassword" type="String" optional>
    The User's current password. When this parameter is provided the current password will be verified to be correct.
  </APIField>
  <APIField name="loginId" type="String" required>
    The login identifier of the user. The login identifier can be either the `email` or the `username`. The username is not case sensitive.

    When this value is provided it should be in place of the `changePasswordId` request parameter. If both the `changePasswordId` and `loginId` are provided on the request, the `changePasswordId` will take precedence.
  </APIField>
  <APIField name="password" type="String" required>
    The User's new password.
  </APIField>
  <APIField name="trustChallenge" type="String" optional since="1.33.0">
    This field is marked optional because it is only required when the user has enabled two-factor authentication, and a `trustChallenge` was provided on the Two-Factor Start API request. When a user has enabled two-factor authentication this field becomes required if a `trustChallenge` was provided on the Two-Factor Start API request. When required, this value must be equal to the value provided to the Two-Factor Start API.
  </APIField>
  <APIField name="trustToken" type="String" optional since="1.33.0">
    This field is marked optional, because it is only required when the user has enabled two-factor authentication. When a user has enabled two-factor authentication this field becomes required when attempting to change a password using the `changePasswordId`.
  </APIField>
</APIBlock>

<JSON title="Example JSON Request" src="users/change-password-request-api-key.json" />

<Aside type="version">
Available Since Version 1.5.0
</Aside>

This API will use a JWT as authentication. See [JWT Authentication](/docs/apis/authentication#jwt-authentication) for examples of how you can send the JWT to FusionAuth.

A common use case for using this API with a JWT will be if you want to allow the user to change their own password. Specifically if you are attempting to perform this request in a frontend  browser that cannot store an API key.

Because changing a User's password will revoke all existing refresh tokens if you allow the user to change their password they will need to re-authenticate to stay logged into your application if you are utilizing JWTs and Refresh Tokens.

For this reason, this API will return a `oneTimePassword` that is intended to be used programatically after a Change Password request completes to keep the user logged in and provide a better user experience. A successful login will return you a new access token (JWT) and a refresh token. This will allow you to make the change password workflow seamless to the user.

<API method="POST" uri="/api/user/change-password" authentication={["jwt"]} title="Change a User's password using a JWT"/>

<XFusionauthTenantIdHeaderScopedOperation />

#### Request Body

<APIBlock>
  <APIField name="currentPassword" type="String" required>
    The User's current password. This is required when using a JWT to change your password.
  </APIField>
  <APIField name="password" type="String" required>
    The User's new password.
  </APIField>
  <APIField name="refreshToken" type="String" optional>
    The user's existing refresh token. If you have access to your current refresh token, it can be provided in the request body using this parameter. If the `refresh_token` cookie also exists and is present on the request it will take precedence over this parameter.

    This parameter is used to determine if the `oneTimePassword` that is returned from this API will be eligible to request a refresh token when used by the Login API. If this parameter is not provided and no cookie is found on the request, a refresh token will not be provided on the Login response when using the returned `oneTimePassword`.
  </APIField>
  <APIField name="trustChallenge" type="String" optional since="1.33.0">
    This field is marked optional because it is only required when the user has enabled two-factor authentication, and a `trustChallenge` was provided on the Two-Factor Start API request. When a user has enabled two-factor authentication this field becomes required if a `trustChallenge` was provided on the Two-Factor Start API request. When required, this value must be equal to the value provided to the Two-Factor Start API.
  </APIField>
  <APIField name="trustToken" type="String" optional since="1.33.0">
    This field is marked optional, because it is only required when the user has enabled two-factor authentication. When a user has enabled two-factor authentication this field becomes required when attempting to change a password using the `changePasswordId`.
  </APIField>
</APIBlock>

<JSON title="Example JSON Request" src="users/change-password-request.json" />

### Response

*Response Codes*

<ChangePassResponseCodes />

#### Response Body

<APIBlock>
  <APIField name="oneTimePassword" type="String" since="1.5.0">
    A one time password that can be used as a substitute for your `loginId` and `password` on the Login API.

    This JSON response body will only be returned when using a `changePasswordId` or JWT to change the password. When calling this API with an API key no response body will be returned.
  </APIField>
</APIBlock>

<JSON title="Example Response JSON" src="users/change-password-response.json" />

