import APIBlock from 'src/components/api/APIBlock.astro';
import APIField from 'src/components/api/APIField.astro';
import InlineField from 'src/components/InlineField.astro';
import InlineFieldValue from 'src/components/InlineFieldValue.astro';
import JSON from 'src/components/JSON.astro';
import WebauthnTransports from 'src/content/docs/apis/_webauthn-transports.mdx';

#### Request Body

The <InlineField>credential</InlineField> in the request body contains data returned by the [WebAuthn JavaScript API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API) call. The <InlineField>credential.response.attestationObject</InlineField> and <InlineField>credential.response.clientDataJSON</InlineField> fields must be converted to base64url-encoded strings for the FusionAuth API request. See [WebAuthn JavaScript API Binary Format](/docs/apis/webauthn#webauthn-javascript-api-binary-format) for details.

<APIBlock>
  <APIField name="credential.clientExtensionResults.credProps.rk" type="Boolean" optional>
    If <InlineFieldValue>true</InlineFieldValue>, the new passkey is "client-side discoverable," meaning that it can be used in authentication ceremonies without first identifying the user (e.g. by requiring the user to complete a form field). If <InlineFieldValue>false</InlineFieldValue>, or the <InlineField>credential.clientExtensionResults.credProps</InlineField> field is omitted, the passkey should be treated as if it were _not_ client-side discoverable. FusionAuth does not currently support discoverable credentials (sometimes referred to as "resident keys").
  </APIField>
  <APIField name="credential.id" type="String" required>
    A base64url-encoded version of the credential Id generated by the authenticator for this passkey.
  </APIField>
  <APIField name="credential.rpId" type="String" optional>
    If the tenant configuration overrides the Relying Party Id, this parameter should match <InlineField>tenant.webAuthnConfiguration.relyingPartyId</InlineField>, otherwise the value should be omitted from the request object.
  </APIField>
  <APIField name="credential.response.attestationObject" type="String" required>
    The base64url-encoded attestation data from the [WebAuthn JavaScript API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API) response, which includes information on the new passkey and other data important for validation. See [Converting ArrayBuffer to base64url-encoded String](/docs/apis/webauthn#converting-arraybuffer-to-base64url-encoded-string) for details on converting this value for the FusionAuth API request.
  </APIField>
  <APIField name="credential.response.clientDataJSON" type="String" required>
    The base64url-encoded client data from the [WebAuthn JavaScript API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API) response. This contains important information for the WebAuthn registration validation process, including the one-time challenge generated when the registration ceremony began. See [Converting ArrayBuffer to base64url-encoded String](/docs/apis/webauthn#converting-arraybuffer-to-base64url-encoded-string) for details on converting this value for the FusionAuth API request.
  </APIField>
  <APIField name="credential.transports" type="Array<String>" optional>
    A list of transport types supported by the authenticator that generated the passkey. This value is used as a hint to help identify eligible authenticators during a WebAuthn ceremony.

<WebauthnTransports />
  </APIField>
  <APIField name="credential.type" type="String" required>
    The credential type of the new passkey. The only value supported by WebAuthn is `public-key`.
  </APIField>
  <APIField name="origin" type="String" required>
    The browser request origin during the registration ceremony.
  </APIField>
  <APIField name="rpId" type="String" required>
    If the tenant configuration overrides the Relying Party Id, this parameter should match <InlineField>tenant.webAuthnConfiguration.relyingPartyId</InlineField>, otherwise the value should be the browser request origin's effective domain during the ceremony.
  </APIField>
  <APIField name="userId" type="UUID" required>
    The unique Id of the user registering this new passkey.
  </APIField>
</APIBlock>

<JSON title="Example Request JSON" src="webauthn/register-complete-request.json" />
