import APIBlock from 'src/components/api/APIBlock.astro';
import APIField from 'src/components/api/APIField.astro';
import Aside from 'src/components/Aside.astro';
import InlineField from 'src/components/InlineField.astro';
import JSON from 'src/components/JSON.astro';
import WebauthnSupportedAlgorithms from 'src/content/docs/reference/_webauthn-supported-algorithms.mdx';
import WebauthnTransports from 'src/content/docs/apis/_webauthn-transports.mdx';

#### Request Body

<APIBlock>

  <APIField name="credentials" type="Array" required>
    The list of passkeys to import.
  </APIField>

  <APIField name="credentials[x].algorithm" type="Long" required>
    The identifier for the signing algorithm used with the passkey. These values are defined by the [IANA COSE Algorithms registry](https://www.iana.org/assignments/cose/cose.xhtml). FusionAuth supports a subset of these algorithms.

    <WebauthnSupportedAlgorithms />
  </APIField>

  <APIField name="credentials[x].attestationType" type="String" optional defaults="none">
    The attestation type provided when the passkey was registered. FusionAuth doesn't validate the attestation on import. Supported values are:

     * `anonymization-ca`
     * `attestation-ca`
     * `basic`
     * `none`
     * `self`

    Passkeys registered in FusionAuth currently only support the `none` option, but another value can be supplied during passkey import.
  </APIField>

  <APIField name="credentials[x].authenticatorSupportsUserVerification" type="Boolean" optional defaults="false">
    Indicates whether this authenticator supports user verification. User verification ensures that the user is authorized to use the authenticator.
  </APIField>

  <APIField name="credentials[x].credentialId" type="String" required>
    The credential Id generated by the authenticator is stored as a base64url-encoded string. This value is used by authenticators to look up a passkey during an authentication ceremony.
  </APIField>

  <APIField name="credentials[x].data" type="Object" optional>
    An object that can hold any information about the passkey that should be persisted.
  </APIField>

  <APIField name="credentials[x].discoverable" type="Boolean" optional defaults="false">
    Indicates whether the passkey is "client-side discoverable." Discoverable passkeys can be used in authentication ceremonies without first identifying the user (e.g. by requiring the user to provide their username).
  </APIField>

  <APIField name="credentials[x].displayName" type="String" required>
    The display name for the passkey.
  </APIField>

  <APIField name="credentials[x].id" type="UUID" optional defaults="secure random UUID">
    The Id of the passkey. If not specified a secure random UUID will be generated.
  </APIField>

  <APIField name="credentials[x].insertInstant" type="Long" optional defaults="now">
    The [instant](/docs/reference/data-types#instants) when the passkey was created.
  </APIField>

  <APIField name="credentials[x].lastUseInstant" type="Long" optional defaults="now">
    The [instant](/docs/reference/data-types#instants) when the passkey was last used.
  </APIField>

  <APIField name="credentials[x].name" type="String" required>
    A unique name meant to disambiguate passkeys with the same <InlineField>credential.displayName</InlineField>.

    Prior to version `1.42.0` this field was optional.
  </APIField>

  <APIField name="credentials[x].publicKey" type="String" required>
    The passkey's public key, encoded in PEM format.
  </APIField>

  <APIField name="credentials[x].relyingPartyId" type="String" required>
    The Relying Party Id used at the time the passkey was registered.

    <Aside type="caution">
    This value **must** match the `rpId` value when the passkey was created, _and_ the browser origin during WebAuthn authentication in FusionAuth must be compatible with that Relying Party Id.
    ####
    </Aside>
  </APIField>

  <APIField name="credentials[x].signCount" type="Integer" optional defaults="0">
    The last known signature count for the passkey.
  </APIField>

  <APIField name="credentials[x].transports" type="Array<String>" optional>
    A list of transport types supported by the authenticator that generated the passkey. This value is used as a hint during the WebAuthn authentication ceremony to help identify eligible authenticators.

    <WebauthnTransports />

    The default value is the empty set, which means that no hints are provided. This does not negatively impact the authentication ceremony.
  </APIField>

  <APIField name="credentials[x].userAgent" type="String" optional>
    The user agent at the time the passkey was registered. This can be useful for troubleshooting WebAuthn passkey issues.
  </APIField>

  <APIField name="credentials[x].userId" type="UUID" required>
    The Id of the user to which this passkey belongs.
  </APIField>

  <APIField name="validateDbConstraints" type="Boolean" optional defaults="false">
    Set this value to `true` in order to perform additional validation of the request.

    The import request is intended to be used to migrate existing users' passkeys from one system to another, this means FusionAuth expects all user Ids from the request to exist for the provided tenant. If a non-existent user Id is encountered a `500` will be returned unless this field is set to `true`.

    In order to get additional details about database constraint violations on import, set this value to `true` and a `400` response will be returned with a JSON body indicating the missing values encountered.

    Setting this value to `true` will dramatically decrease the performance of this request. If importing large numbers of passkeys in a single request you may need to increase request timeouts to ensure this request does not timeout before it has completed.
  </APIField>

</APIBlock>

<JSON title="Example Request JSON" src="webauthn/import-request.json" />
