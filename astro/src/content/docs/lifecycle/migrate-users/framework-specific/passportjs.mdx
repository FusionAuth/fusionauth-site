---
title: Migrate from Node.js/Express/Passport.js
description: Learn how to migrate your users to FusionAuth from Node.js applications using Passport.js.
section: lifecycle
subcategory: migrate users
tertcategory: framework specific
technology: Node.js/Passport.js
technologyLower: node.js/passport.js
---

import AdditionalSupport from 'src/content/docs/lifecycle/migrate-users/provider-specific/_additional-support.mdx';
import Aside from 'src/components/Aside.astro';
import Breadcrumb from 'src/components/Breadcrumb.astro';
import CreateApiKeySocial from 'src/content/docs/lifecycle/migrate-users/provider-specific/_create-api-key-social.mdx';
import CreateTestApplication from 'src/content/docs/lifecycle/migrate-users/provider-specific/_create-test-application.mdx';
import CreateTestTenant from 'src/content/docs/lifecycle/migrate-users/provider-specific/_create-test-tenant.mdx';
import FinalDestination from 'src/content/docs/lifecycle/migrate-users/provider-specific/_final-destination.mdx';
import Identifiers from 'src/content/docs/lifecycle/migrate-users/provider-specific/_identifiers.mdx';
import InlineField from 'src/components/InlineField.astro';
import SetUpFusionauth from 'src/content/docs/lifecycle/migrate-users/provider-specific/_set-up-fusionauth.mdx';
import SocialLoginMigration from 'src/content/docs/lifecycle/migrate-users/provider-specific/_social-login-migration.mdx';
import SocialLoginNote from 'src/content/docs/lifecycle/migrate-users/provider-specific/_social-login-note.mdx';
import VerifyImport from 'src/content/docs/lifecycle/migrate-users/provider-specific/_verify-import.mdx';
import WhatNext from 'src/content/docs/lifecycle/migrate-users/provider-specific/_what-next.mdx';
import PasswordHashSection from 'src/content/docs/lifecycle/migrate-users/provider-specific/_password-hashes-section.mdx';
import {RemoteCode} from '@fusionauth/astro-components';
import InlineUIElement from 'src/components/InlineUIElement.astro';
import PremiumPlanBlurb from 'src/content/docs/_shared/_premium-plan-blurb.astro';
import SlowMigrationTimeline from 'src/content/docs/lifecycle/migrate-users/provider-specific/_slow-migration-timeline.mdx';
import SetUpUserRoles from 'src/content/docs/lifecycle/migrate-users/provider-specific/_set-up-user-roles.mdx';

export const migration_source_name = 'passport';
export const migration_source_dir = 'passportjs';
export const migration_source_social_name = 'Passport.js ';
export const script_supports_social_logins = true;
export const add_tenant_image_role = 'bottom-cropped';
export const social_integration_method = 'various strategy packages such as passport-google-oauth20, passport-github2, and passport-facebook';
export const migration_sources_tools = 'Node.js/Passport.js applications';
export const hashing_algorithm = 'bcrypt';

## Overview

This document will help you migrate your users from a Node.js application using [Passport.js](https://www.passportjs.org/) to FusionAuth.

This guide assumes you have installed FusionAuth. If you have not, please [view our installation guides](/docs/get-started/download-and-install) and install FusionAuth before you begin. For more general migration information, please view the [FusionAuth migration guide](/docs/lifecycle/migrate-users/genericmigration).  The screenshots, scripts and code snippets in this guide are from this example [Node.js application](https://github.com/ritza-co/fusionauth-migrating-node-express-passportjs-example).

The example project uses Passport.js to implement authentication through two common approaches:

* **passport-local** – Username/password authentication using credentials stored in your application's database.
* **OAuth strategies** – Social login through external providers like Google, GitHub, and Facebook using strategies such as `passport-google-oauth20`, `passport-github2`, and `passport-facebook`. The example application implements `passport-google-oauth20` for Google login.

Each approach requires different user data to be migrated. Passport.js itself doesn't manage user data: it only handles authentication. Your application defines the user model, database schema, and data storage approach.

This guide provides export scripts and migration strategies tailored to each data pattern, focusing on preserving user passwords, account states, and social login connections.

## Prerequisites

To follow this tutorial, you need:

- [Node.js](https://nodejs.org/en/download) to run migration scripts.
- [FusionAuth](/docs/get-started/download-and-install), the easiest way to run FusionAuth locally is to use [Docker](https://docs.docker.com/get-docker/) with the configuration file provided later in this tutorial.
- [ngrok](https://ngrok.com/) (optional) to expose your local {frontmatter.technology} application for testing purposes.

## Planning Considerations

Before beginning your migration, you'll need to plan several key aspects:

* Understanding what user data you're migrating.
* Identifying your password hashing schemes.
* Choosing your migration strategy (bulk vs gradual).
* Determining how to handle social login connections.

### Obtaining User Data

To migrate users from your {frontmatter.technology} application, you'll need to export user data from your database. Since Passport.js doesn't manage user data directly, the export process depends on your database and user schema.

#### Username/password (passport-local) Strategy

Applications using `passport-local` store user credentials in your database. Common user data includes:

* `email` or `username` – Primary user identifier.
* `password` – The hashed password, usually bcrypt.
* `emailVerified` or `confirmed` – Email verification status.
* Profile fields like `firstName`, `lastName`, `displayName`.
* Security fields like `loginAttempts`, `blocked`, `lastLogin`.

All of this data can be exported directly from your database and preserved during migration to FusionAuth.

#### OAuth Strategies

Applications using OAuth strategies store minimal local user data since authentication happens through external providers. Your export will focus on:

* Profile fields such as `email`, `name`, `username` and `avatar`.
* Provider connection data like the provider ID (`googleId`, `githubId` and `facebookId`).

The critical piece for OAuth migrations is the provider ID, which allows FusionAuth to link the migrated user account to the appropriate external identity provider.

### Mapping User Attributes

The attributes of the User object in FusionAuth are [well documented](/docs/apis/users).

If there is an attribute in your {frontmatter.technology} application user which cannot be directly mapped to a FusionAuth attribute, you can place it in the `user.data` field. This field can store arbitrary JSON values and will be indexed and searchable.

If you need users to access [applications](/docs/get-started/core-concepts/applications), you must set the `user.registrations` field with the data required to register a user to an application. However, this process is simplified when using the import script. See [Use the Script](#use-the-script) for more details.

### Social Logins

<SocialLoginNote migration_source_name={migration_source_social_name} script_supports_social_logins={script_supports_social_logins} social_integration_method={social_integration_method} />

<SocialLoginMigration />

### Other Entities

There are often other important entities, such as roles, that need to be migrated. There are usually fewer of these, so an automated migration may not make sense, but plan to move this configuration somehow.

Be aware that functionality may not be the same between {frontmatter.technology}-based authentication tools and FusionAuth. This is different from user data; as long as you can somehow migrate a login identifier (a username or email) and a password hash, a user will be authenticated and successfully migrated. You can [download FusionAuth](/download/) before you begin a migration and build a proof of concept to learn more about the differences.

#### Identifiers

<Identifiers migration_source_name={migration_sources_tools} />

## Exporting Users

Exporting users from your {frontmatter.technology} application is a two-step process: first export the raw user data from your database, then convert it to a format required by FusionAuth.

Before running any scripts, update the `applicationId` values to match your FusionAuth application IDs.

### Step 1: Export Raw User Data

The following script exports raw user data from your Passport.js application database:

<RemoteCode url="https://github.com/ritza-co/fusionauth-migrating-node-express-passportjs-example/raw/refs/heads/main/scripts/4_exportUsers.mjs" lang="js" />

The script exports a user file that looks similar to the example below. This creates a `users.json` file with your raw database data.

```json
[
  {
    "id": 5,
    "email": "sarah.johnson@techcorp.com",
    "password": "$2b$10$TlFbuG62ZB29BQCRA2R6IeU544NuZb4GX8bXIMds5jR6tXReLnQhK",
    "name": "Sarah Johnson",
    "google_id": null,
    "avatar": null,
    "provider": "local",
    "verified": 1,
    "active": 1,
    "last_login_at": null,
    "created_at": "2025-07-25 04:24:58",
    "updated_at": "2025-07-25 04:24:58"
  }
]
```

### Step 2: Convert The User Objects To A Format Supported By FusionAuth

The conversion script transforms the raw data into FusionAuth's required format:

<RemoteCode url="https://github.com/ritza-co/fusionauth-migrating-node-express-passportjs-example/raw/refs/heads/main/scripts/5_convertUserToFaUser.mjs" lang="js" />

The conversion script generates `faUsers.json` ready for import into FusionAuth.

<PasswordHashSection hashing_algorithm={hashing_algorithm} />

## Configuring FusionAuth

Next up, setup FusionAuth to import the user data. Here are the steps you need to take:

### Set Up FusionAuth

<SetUpFusionauth />

#### Create A Test Tenant

<CreateTestTenant migration_source_dir={migration_source_dir} migration_source_name={migration_source_name} add_tenant_image_role={add_tenant_image_role} />

#### Create A Test Application

<CreateTestApplication migration_source_dir={migration_source_dir} migration_source_name={migration_source_name} />

#### Set Up User Roles

<SetUpUserRoles migration_source_dir={migration_source_dir} migration_source_name={migration_source_social_name}  />

#### Add An API Key

<CreateApiKeySocial migration_source_dir={migration_source_dir} />

#### Add An Identity Provider

Set up an identity provider by navigating to <Breadcrumb>Settings -> Identity Providers</Breadcrumb>. On the dropdown choose <InlineUIElement>Add Google</InlineUIElement> and then enter the <InlineField>Client Id</InlineField> and <InlineField>Client secret</InlineField> retrievable from Google Cloud console. Save the identity provider.

![Create an Identity Provider in FusionAuth](/img/docs/lifecycle/migrate-users/provider-specific/passportjs/idp.png)

## Bulk Migration

### Get the Scripts

FusionAuth provides JavaScript import script under a permissive open source license.

```shell title="Getting the import scripts"
git clone https://github.com/FusionAuth/fusionauth-import-scripts
```

Navigate to the `passportjs` directory:

```shell title="Navigating to the import scripts directory"
cd fusionauth-import-scripts/passportjs
```

### Install Necessary Packages

You will need to add the following packages to your Node.js project:

```shell title="Installing required packages"
npm install sqlite3 stream-json uuid @fusionauth/typescript-client
```

<Aside type="note">
  If you are using a different database other than SQLite, you may need to install the appropriate database driver package.
</Aside>

### Use the Scripts

Using the scripts for importing will mostly go as follows:

1. Bulk import the users into FusionAuth.

```shell title="Importing users"
node scripts/6_importUsersBulk.mjs
```

2. Link users with social logins.

```shell title="Importing social logins"
node scripts/7_importSocialUsers.mjs
```

Make sure the `users.json` and `faUsers.json` files are in the same directory as the scripts.

#### Enhancing the Script

You may also want to migrate additional data. Currently, the following attributes are migrated:

* `email`
* `username`
* `fullName` (when available)
* `verified`
* `active`
* `password`
* `registrations`
* `data` - Custom metadata including source system and original user Id

If you have additional user attributes to migrate, review and modify the script's user mapping logic.

You may also want to assign Roles, or associate users with Groups, by creating the appropriate JSON data structures in the import call. These are documented in the [Import User API docs](/docs/apis/users#import-users).

### Verify The Import

<VerifyImport migration_source_dir={migration_source_dir} />

### The Final Destination Of Imported Users

<FinalDestination migration_source_dir={migration_source_dir} />

## Slow Migration

This step of the tutorial is optional. In this section, you'll learn how to create a Connector for FusionAuth to import your users' data individually as each user logs in.

<PremiumPlanBlurb />

If you don't need to do this, please skip to the [What To Do Next](#what-to-do-next) section below.

### Create A User With A Password

To test the slow migration, you need a user with a password you know. The {frontmatter.technology} project includes a setup script `models/users.js` that creates test user accounts.

You can also register new users by accessing the {frontmatter.technology} example in your browser at `http://localhost:3000`.

### Configure A Connector Between FusionAuth And Your {frontmatter.technology} Application

<PremiumPlanBlurb />

If you haven't done so already, activate your FusionAuth license by navigating to <Breadcrumb>Reactor</Breadcrumb> on the sidebar of the admin UI.

Now configure a FusionAuth Connector to point to an intermediary web service between FusionAuth and your {frontmatter.technology} application. The web service will expose an API endpoint that FusionAuth can call to retrieve user details for migration.

<Aside type="note">
  For a general overview of Connectors, please see this [video](https://www.youtube.com/watch?v=ks-ppMH6WXw).
</Aside>

Before proceeding, note that if you're running FusionAuth in Docker and your {frontmatter.technology} application locally, you'll need to ensure FusionAuth can reach your Express application.

You have two main options:

* **Use ngrok** - Use a tool like [ngrok](https://ngrok.com/) to expose your local {frontmatter.technology} application to the internet
* **Use your host machine's IP address** - Run the Express application on `0.0.0.0` and find your host machine's IP address:

```bash
ifconfig | grep "inet " | grep -v 127.0.0.1 | awk '{print $2}' | head -1
```

Then construct the connector URL as `http://<IP_ADDRESS>:PORT/fusionauth/connector`.

In your [FusionAuth admin UI](http://localhost:9011), browse to <Breadcrumb>Settings -> Connectors</Breadcrumb>.

Click the dropdown button on the top right and select <InlineUIElement>Add Generic connector</InlineUIElement>.

![Create a Connector in FusionAuth](/img/docs/lifecycle/migrate-users/provider-specific/passportjs/create-connector.png)

Enter the field values below.

* Set <InlineField>Name</InlineField> to `My App Connector` or anything you like.
* Set <InlineField>Authentication URL</InlineField> to `http://<IP_ADDRESS_OR_DOMAIN>:PORT/fusionauth/connector`, replacing `IP_ADDRESS_OR_DOMAIN` with the IP address or domain name of your host machine and `PORT` with the port number of your Express application.
* Increase timeout values (for example, to `5000`) to accommodate network latency when the API requests are being made.
* Enable <InlineUIElement>Debug enabled</InlineUIElement>
* Save the connector.

![Connector details in FusionAuth](/img/docs/lifecycle/migrate-users/provider-specific/passportjs/connector.png)

<Aside type="caution">
  In production, you will want to add some authentication to the web service. You can add basic authentication using the <Breadcrumb>Security</Breadcrumb> tab in the Connector details page.
</Aside>

Now browse to <Breadcrumb>Tenants</Breadcrumb> and do the following.

* Select <InlineUIElement>Edit</InlineUIElement> on the default tenant.
* Navigate to the <Breadcrumb>Connectors</Breadcrumb> tab.
* Click <InlineUIElement>Add policy</InlineUIElement>.
* Select `My App Connector`.
* Leave <InlineField>Domains</InlineField> with the value `*` to apply this Connector to every user.
* Enable <InlineUIElement>Migrate user</InlineUIElement> so that FusionAuth will no longer use your {frontmatter.technology} backend for subsequent logins of the same user.
* Click <InlineUIElement>Submit</InlineUIElement>.

![Connector policy details in FusionAuth](/img/docs/lifecycle/migrate-users/provider-specific/passportjs/connector-policy.png)

Move the `My App Connector` policy to the top of the list. Use the arrow buttons to move the policy if necessary. With this configuration, all users are checked against this Connector the first time they are seen. If they log in, they'll be migrated to the FusionAuth user database.

After configuration, the Connector entry form should look similar to this:

![Connector policy list in FusionAuth](/img/docs/lifecycle/migrate-users/provider-specific/passportjs/connector-added.png)

Save the changes by clicking the save icon at the top right.

### Add An Authentication Intermediary Endpoint

The next step is to write an API endpoint that will accept the user's login Id and password and returns the user details that will be saved to FusionAuth if the login is successful.

<Aside type="note">
  Documentation on the inputs and outputs a Connector expects is [here](/docs/lifecycle/migrate-users/connectors/generic-connector).
</Aside>

The Connector makes a POST request to the URL you specify, and expects a JSON object containing a user in return.

An example controller is in `passportjs/connectorSnippet.mjs`.

The controller will take the user's login Id and password, and return the user details to be imported into FusionAuth, after running the `authenticateConnectorUser(user, password)` function for Express built-in authentication.

### Log In With A Test User

In the FusionAuth admin interface, browse to <Breadcrumb>Applications</Breadcrumb> and click the <InlineUIElement>Select</InlineUIElement> dropdown next to the "Example App" application, then select <InlineUIElement>View</InlineUIElement>. Copy the <InlineField>OAuth IdP login URL</InlineField> and open it in an incognito window in your browser. (If you don't use an incognito window, you need to log out of the FusionAuth admin session to prevent the active session from interfering with the test.) This URL is a login page for the "Example App" application, so that you can test the web service and Connector.

For this tutorial, the login URL should be http://localhost:9011/oauth2/authorize?client\_id=e9fdb985-9173-4e01-9d73-ac2d60d1dc8e\&response\_type=code\&redirect\_uri=http%3A%2F%2Flocalhost%3A8080%2Foauth-redirect.

![Test application login URL](/img/docs/lifecycle/migrate-users/provider-specific/passportjs/login-url.png)

Log in with the username and password for a sample user as defined in the `models/user.js` file of the example application, such as `sarah.johnson@techcorp.com` and `SecurePass2024!`. Your Connector service should show `request received` in the terminal and the login request succeeding.

<Aside type="note">
  After a successful test login, the user will be redirected to a URL like `https://example.com/?code=2aUqU0ZhQCjtz0fnrFL_i7wxhIAh7cTfxAXEIpJE-5w&locale=en&userState=AuthenticatedNotRegistered`.

  This occurs because you haven't set up a web application to handle the authorization code redirect yet. This is an important next step, but it's beyond the scope of this document. Consult the [5-minute setup guide](/docs/quickstarts/5-minute-setup-guide) for an example of how to do this.
</Aside>

If you log out and log in again with the same user, you'll notice that `request received` will not show in the web service console. This is because FusionAuth is now using its own authentication service, as the original user password has been hashed and saved in the FusionAuth database.

The user has been successfully migrated, and {frontmatter.technology} authentication system is no longer needed.

#### Debug The Connector Service

If you encounter errors in this process, try the following:

* View the <Breadcrumb>System Event Logs</Breadcrumb> in the bottom left of the FusionAuth web interface.
* Adjust the timeout values of the Connector to higher values to accommodate network latency between API calls.

### Estimate The Slow Migration Timeline

When using a slow migration, you can estimate how many accounts will be migrated in a given period.

<SlowMigrationTimeline />

After this period, you may want to bulk migrate the rest of the users, or treat them as inactive and not migrate them. Plan to disable the Connector and remove the tenant's Connector policy after the slow migration is complete.

Learn more about [general slow migration considerations](/docs/lifecycle/migrate-users/general-migration#slow-migration-implementation).

## What To Do Next

<WhatNext />

## Additional Support

<AdditionalSupport />
