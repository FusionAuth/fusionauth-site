---
title: Migrate From Rails
description: Learn how to migrate your users to FusionAuth from Ruby on Rails.
section: lifecycle
subcategory: migrate users
tertcategory: framework specific
technology: Rails
technologyLower: rails
---
import AdditionalSupport from 'src/content/docs/lifecycle/migrate-users/provider-specific/_additional-support.mdx';
import Aside from 'src/components/Aside.astro';
import Breadcrumb from 'src/components/Breadcrumb.astro';
import CreateApiKeySocial from 'src/content/docs/lifecycle/migrate-users/provider-specific/_create-api-key-social.mdx';
import CreateTestApplication from 'src/content/docs/lifecycle/migrate-users/provider-specific/_create-test-application.mdx';
import CreateTestTenant from 'src/content/docs/lifecycle/migrate-users/provider-specific/_create-test-tenant.mdx';
import FinalDestination from 'src/content/docs/lifecycle/migrate-users/provider-specific/_final-destination.mdx';
import GetScript from 'src/content/docs/lifecycle/migrate-users/provider-specific/_get-script.mdx';
import Identifiers from 'src/content/docs/lifecycle/migrate-users/provider-specific/_identifiers.mdx';
import InlineField from 'src/components/InlineField.astro';
import MappingUserAttributes from 'src/content/docs/lifecycle/migrate-users/provider-specific/_mapping-user-attributes.mdx';
import OtherEntitiesFrameworkIntro from 'src/content/docs/lifecycle/migrate-users/provider-specific/_other-entities-framework-intro.mdx';
import PasswordHashNote from 'src/content/docs/lifecycle/migrate-users/provider-specific/_password-hash-note.mdx';
import SetUpFusionauth from 'src/content/docs/lifecycle/migrate-users/provider-specific/_set-up-fusionauth.mdx';
import SocialLoginMigration from 'src/content/docs/lifecycle/migrate-users/provider-specific/_social-login-migration.mdx';
import SocialLoginNote from 'src/content/docs/lifecycle/migrate-users/provider-specific/_social-login-note.mdx';
import VerifyImport from 'src/content/docs/lifecycle/migrate-users/provider-specific/_verify-import.mdx';
import WhatNext from 'src/content/docs/lifecycle/migrate-users/provider-specific/_what-next.mdx';
import BulkMigration from 'src/content/docs/lifecycle/migrate-users/_bulk-migration.mdx';
import PasswordHashSection from 'src/content/docs/lifecycle/migrate-users/provider-specific/_password-hashes-section.mdx';
import GradualMigration from 'src/content/docs/lifecycle/migrate-users/_gradual-migration.mdx';
import {RemoteCode} from '@fusionauth/astro-components';
import InlineUIElement from 'src/components/InlineUIElement.astro';
import PremiumPlanBlurb from 'src/content/docs/_shared/_premium-plan-blurb.astro';
import SlowMigrationTimeline from 'src/content/docs/lifecycle/migrate-users/provider-specific/_slow-migration-timeline.mdx';
import SetUpUserRoles from 'src/content/docs/lifecycle/migrate-users/provider-specific/_set-up-user-roles.mdx';


export const migration_source_name = 'rails';
export const migration_source_dir = 'rails';
export const migration_source_social_name = 'OmniAuth';
export const migration_sources_tools = "Devise, OmniAuth, Rails built-in authentication";
export const hashing_algorithm = 'bcrypt';
export const script_supports_social_logins = true;
export const add_tenant_image_role = 'bottom-cropped';

## Overview

This document will help you migrate your users from a Ruby on Rails application to FusionAuth.

This guide assumes you have installed FusionAuth. If you have not, please [view our installation guides](/docs/get-started/download-and-install) and install FusionAuth before you begin. For more general migration information, please view the [FusionAuth migration guide](/docs/lifecycle/migrate-users/general-migration).

Rails applications can implement authentication in several different ways, and this guide covers the three most common approaches:

- **Devise** – The most popular Rails authentication gem, providing an authentication solution with email/password, confirmations, and account locking.
- **OmniAuth** – A flexible authentication system focused on external providers like Google, Facebook, and GitHub.
* **Rails built-in authentication** – Rails native authentication feature using `has_secure_password` with bcrypt for email/password authentication.

Each approach stores user data differently and requires specific migration considerations. This guide provides export scripts and migration strategies tailored to each authentication method, focusing on preserving user passwords, account states, and any social login connections.

The migration process will preserve your users existing passwords (where applicable) so they can continue logging in with their current credentials after the migration to FusionAuth.

## Planning Considerations

Before beginning your migration, you'll need to plan several key aspects:

- Understanding what user data you're migrating
- Identifying your password hashing schemes  
- Choosing your migration strategy (bulk vs gradual)
- Determining how to handle social login connections

### Obtaining User Data

Each Rails authentication approach stores different types of user data in your database. The following sections describe the specific data fields you should look for when exporting users from Devise, OmniAuth, and Rails built-in authentication.

#### Devise

Devise applications store comprehensive user authentication data in your database. The standard Devise User model includes valuable migration data such as:

- `encrypted_password` – The bcrypt-hashed password that can be migrated directly to FusionAuth.
- `email` and `username` – Primary user identifiers.
- `confirmed_at` – Email confirmation status for user verification.
- `sign_in_count`, `current_sign_in_at`, `last_sign_in_at`
- `current_sign_in_ip`, `last_sign_in_ip`
- `locked_at` – Account lockout status for security features.

All of this data can be exported directly from your database and preserved during migration to FusionAuth.

#### OmniAuth

OmniAuth applications typically store minimal local user data since authentication happens through external providers. Your export will focus on:

- Basic profile information (`email`, `name`, `username`).
- Provider connection data (`provider`, `uid`) – This maps to the external service's user identifier.
- Any locally stored profile images or additional user metadata.

The critical piece for OmniAuth migrations is the provider/uid combination, which allows FusionAuth to link the migrated user account to the appropriate external identity provider.

#### Rails Built-in Authentication

Applications using Rails' `has_secure_password` feature store user data similarly to Devise but with a simpler structure:

- `password_digest` - The bcrypt-hashed password.
- `email` - Primary identifier.
- Any custom user profile fields your application has added.

This approach typically requires the least complex migration since the data structure is straightforward.

### Migration Approaches

FusionAuth supports two primary migration approaches: Bulk Migration and Slow Migration.

#### Bulk Migration

<BulkMigration />

#### Slow Migration

<GradualMigration />

### Mapping User Attributes

The attributes of the User object in FusionAuth are [well documented](/docs/apis/users).

If there is an attribute for your Rails user which cannot be directly mapped to a FusionAuth attribute, you can place it in the `user.data` field. This field can store arbitrary JSON values and will be indexed and searchable.

For example, Rails-specific fields like `sign_in_count` from Devise or `has_secure_password` indicators can be saved in the `user.data` field.

If you need users to access applications, you can also set the `user.registrations` field with the data required to register a user to an application. However, this process is simplified when using the import script. See [Use the Script](#use-the-script) for more details.

### Social Logins

<SocialLoginNote migration_source_name={migration_source_social_name} script_supports_social_logins={script_supports_social_logins} />

<SocialLoginMigration />

### Other Entities

<OtherEntitiesFrameworkIntro migration_source_name={migration_sources_tools} other_migrated_entities="roles" />

#### Identifiers

<Identifiers />

## Exporting Users

To export users from a Rails application, you'll need a script that queries your database and formats the data for import into FusionAuth. The following export scripts are tailored for each Rails authentication system discussed in this guide.

Before running any export script, update the `applicationId` values to match your FusionAuth application Ids.

### Devise

Most Rails applications using Devise can use this straightforward export script:

<RemoteCode url="https://github.com/ritza-co/fusionauth-import-scripts/raw/6d727b139b84ed99203e1cb41875c06787da2bf7/rails/export-scripts/devise/export_users_for_fusionauth.rb" lang="ruby"  />

The script handles bcrypt password hashes directly. Since bcrypt includes the salt in the hash, the `salt` field is not needed.

### OmniAuth

For OmniAuth users, passwords are not stored locally, so the export focuses on profile data and provider information:

<RemoteCode url="https://github.com/ritza-co/fusionauth-import-scripts/raw/6d727b139b84ed99203e1cb41875c06787da2bf7/rails/export-scripts/omniauth/export_users_for_fusionauth.rb" lang="ruby"  />

The `oauth_provider` and `oauth_uid` data will be used later to link user accounts to FusionAuth identity providers.

### Rails Built-in Authentication

For Rails applications using `has_secure_password`, the export is similar to Devise:

<RemoteCode url="https://github.com/ritza-co/fusionauth-import-scripts/raw/6d727b139b84ed99203e1cb41875c06787da2bf7/rails/export-scripts/built-in-auth/export_users_for_fusionauth.rb" lang="ruby"  />

All scripts generate JSON files ready for import into FusionAuth. Update the `applicationId` values and modify the User model field references to match your application's schema before running.

<PasswordHashSection hashing_algorithm={hashing_algorithm} />

## Configuring FusionAuth

Next up, setup FusionAuth to import the user data. Here are the steps you need to take:

### Set Up FusionAuth

<SetUpFusionauth />

#### Create a Test Tenant

<CreateTestTenant migration_source_dir={migration_source_dir} migration_source_name={migration_source_name} add_tenant_image_role={add_tenant_image_role} />

#### Create a Test Application

<CreateTestApplication migration_source_dir={migration_source_dir} migration_source_name={migration_source_name} />

#### Set Up User Roles

<SetUpUserRoles />

#### Add an API Key

<CreateApiKeySocial migration_source_dir={migration_source_dir} />

## Bulk Migration

### Get the Script

<GetScript migration_source_dir={migration_source_dir} />

### Install Needed Gems

The following gems must be available to the import script:

* `date`
* `json`
* `optargs`
* `securerandom`
* `fusionauth_client`

Most likely all of these will be on your system already, except the `fusionauth_client` gem.

If you have `bundler` installed, run `bundle install` in the `rails` project directory. Otherwise install the needed gems in some other way.

### Use the Script

You can see the output of the script by running it with the `-h` option:

```sh title="Running the import script with the help command line switch"
./import.rb -h
```

The output will be similar to this:

```sh title="The help output of the import.rb script"
Usage: import.rb [options]
    -u, --users-file USERS_FILE      The exported JSON user data file from Rails. Defaults to users.json.
    -f FUSIONAUTH_URL,               The location of the FusionAuth instance. Defaults to http://localhost:9011.
        --fusionauth-url
    -k, --fusionauth-api-key API_KEY The FusionAuth API key.
    -t TENANT_ID,                    The FusionAuth tenant id. Required if more than one tenant exists.
        --fusionauth-tenant-id
    -r APPLICATION_IDS,              A comma separated list of existing application Ids. All users will be registered for these applications.
        --register-users
    -l, --link-social-accounts       Link social accounts for OmniAuth users after import.
    -v, --verbose                    Enable verbose logging.
    -h, --help                       Prints this help.
```

For this script to work correctly, set the following switches, unless the defaults work for you:

* `-u` should point to the location of the user export file you obtained, unless the default works.
* `-f` must point to your FusionAuth instance. If you are testing locally, it will probably be `http://localhost:9011`.
* `-k` needs to be set to the value of the API key created above.
* `-t` should be set to the Id of the testing tenant created above.

The `-l` switch will attempt to create links for any OmniAuth social users found in the users data file. If you are loading OmniAuth users, you must create the social providers in FusionAuth beforehand, or the links will fail.

When you run the script, you'll see output like:

```title="Import script output"
$ ./import.rb -k rEWq7js-JBeWfNMFveXp0nN8CaArBt1xfuhUn4Jn617tGl2zLiGZnCwG -u users_export_20250721_042512.json
FusionAuth Importer : Rails Authentication Systems
 > User file: users_export_20250721_042512.json
 > FusionAuth URL: http://localhost:9011
 > Tenant ID: default

 > Detected source system: rails_auth

 > Processing 12 valid users
 > Importing 12 users to FusionAuth...
 > Import successful!

 > Successfully imported 12 users

Import completed successfully!
 > Total users imported: 12
 > Duplicates skipped: 0
```

#### Enhancing the Script

You may also want to migrate additional data. Currently, the following attributes are migrated:

* `email`
* `username` 
* `fullName` (when available)
* `verified`
* `active`
* `password` (for Devise and Rails built-in authentication)
* `registrations`
* `data` - Custom metadata including source system and original user Id

If you have additional user attributes to migrate, review and modify the script's user mapping logic.

You may also want to assign Roles, or associate users with Groups, by creating the appropriate JSON data structures in the import call. These are documented in the [Import User API docs](/docs/apis/users#import-users). This will require modifying the `import.rb` code.

### Verify the Import

<VerifyImport migration_source_dir={migration_source_dir} />

### The Final Destination of Imported Users

<FinalDestination migration_source_dir={migration_source_dir} />

## Slow Migration 

This step of the tutorial is optional. In this section, you'll learn how to create a Connector for FusionAuth to import your users' data individually as each user logs in.

<PremiumPlanBlurb />

If you don't need to do this, please skip to the [What To Do Next](#what-to-do-next) section below.

### Create A User With A Password

To test the slow migration, you need a user with a password you know. Each Rails example project includes a setup script that creates test user accounts. 

You can also register new users by accessing the Rails examples in your browser:
- Devise example: `http://localhost:3000`
- Rails built-in authentication example: `http://localhost:3002`

If you're using the test data created during setup, use these credentials:

* Username: `sarah.johnson@techcorp.com`
* Password: `SecurePass123!`

### Configure A Connector Between FusionAuth And your Rails Application

<PremiumPlanBlurb />

If you haven't done so already, activate your FusionAuth license by navigating to <Breadcrumb>Reactor</Breadcrumb> on the sidebar of the admin UI.

Now configure a FusionAuth Connector to point to an intermediary web service between FusionAuth and your Rails application. The web service will expose an API endpoint that FusionAuth can call to retrieve user details for migration.

<Aside type="note">
For a general overview of Connectors, please see this [video](https://www.youtube.com/watch?v=ks-ppMH6WXw).
</Aside>

Before proceeding, note that if you're running FusionAuth in Docker and your Rails application locally, you'll need to ensure FusionAuth can reach your Rails application.

You have two main options:

- **Use ngrok** - Use a tool like [ngrok](https://ngrok.com/) to expose your local Rails application to the internet
- **Use your host machine's IP address** - Run the Rails application on `0.0.0.0` and find your host machine's IP address:
 ```bash
 ifconfig | grep "inet " | grep -v 127.0.0.1 | awk '{print $2}' | head -1
 ```
Then construct the connector URL as `http://<IP_ADDRESS>:PORT/fusionauth/connector`.

In your [FusionAuth admin UI](http://localhost:9011), browse to <Breadcrumb>Settings -> Connectors</Breadcrumb>.

Click the dropdown button on the top right and select <InlineUIElement>Add Generic connector</InlineUIElement>.

![Create a Connector in FusionAuth](/img/docs/lifecycle/migrate-users/provider-specific/rails/create-connector.png)

Enter the field values below.

- Set <InlineField>Name</InlineField> to `MyApp Connector` or anything you like.
- Set <InlineField>Authentication URL</InlineField> to `http://<IP_ADDRESS_OR_DOMAIN>:PORT/fusionauth/connector`, replacing `IP_ADDRESS_OR_DOMAIN` with the IP address or domain name of your host machine and `PORT` with the port number of your Rails application.
- Increase timeout values (for example, to `5000`) to accommodate network latency when the API requests are being made.
- Enable <InlineUIElement>Debug enabled</InlineUIElement>

![Connector details in FusionAuth](/img/docs/lifecycle/migrate-users/provider-specific/rails/connector.png)

<Aside type="caution">
  In production, you will want to add some authentication to the web service. You can add basic authentication using the <Breadcrumb>Security</Breadcrumb> tab in the Connector details page.
</Aside>

Now browse to <Breadcrumb>Tenants</Breadcrumb> and do the following.

- Select <InlineUIElement>Edit</InlineUIElement> on the default tenant.
- Navigate to the <Breadcrumb>Connectors</Breadcrumb> tab.
- Click <InlineUIElement>Add policy</InlineUIElement>.
- Select `My App Connector`.
- Leave <InlineField>Domains</InlineField> with the value `*` to apply this Connector to every user.
- Enable <InlineUIElement>Migrate user</InlineUIElement> so that FusionAuth will no longer use your Rails backend for subsequent logins of the same user.
- Click <InlineUIElement>Submit</InlineUIElement>.

![Connector policy details in FusionAuth](/img/docs/lifecycle/migrate-users/provider-specific/rails/connector-policy.png)


Move the `My App Connector` policy to the top of the list. Use the arrow buttons to move the policy if necessary. With this configuration, all users are checked against this Connector the first time they are seen. If they log in, they'll be migrated to the FusionAuth user database.

After configuration, the Connector entry form should look similar to this:

![Connector policy list in FusionAuth](/img/docs/lifecycle/migrate-users/provider-specific/rails/connector-added.png)

Save the changes by clicking the save icon at the top right.

### Add An Authentication Intermediary Endpoint

The next step is to write an API endpoint that will accept the user's login Id and password and returns the user details that will be saved to FusionAuth if the login is successful.

<Aside type='note'>
 Documentation on the inputs and outputs a Connector expects is [here](/docs/lifecycle/migrate-users/connectors/generic-connector).
</Aside>

The Connector makes a POST request to the URL you specify, and expects a JSON object containing a user in return.

An example controller is in `rails/fusionauth_connector_controller.rb`.

The controller will take the user's login Id and password, and return the user details to be imported into FusionAuth, after running the `user&.authenticate(password)` function for Rails built-in authentication and `User.find_by(email: login_id)` for Devise.

### Log In With A Test User

In the FusionAuth admin interface, browse to <Breadcrumb>Applications</Breadcrumb> and click the <InlineUIElement>Select</InlineUIElement> dropdown next to the "Example App" application, then select <InlineUIElement>View</InlineUIElement>. Copy the <InlineField>OAuth IdP login URL</InlineField> and open it in an incognito window in your browser. (If you don't use an incognito window, you need to log out of the FusionAuth admin session to prevent the active session from interfering with the test.) This URL is a login page for the "Example App" application, so that you can test the web service and Connector.

For this tutorial, the login URL should be http://localhost:9011/oauth2/authorize?client_id=e9fdb985-9173-4e01-9d73-ac2d60d1dc8e&response_type=code&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Foauth-redirect.

![Test application login URL](/img/docs/lifecycle/migrate-users/provider-specific/rails/login-url.png)

Log in with the username and password for the user you created earlier, such as `sarah.johnson@techcorp.com` and `SecurePass123!`. Your Connector service should show `Request received` in the terminal and the login request succeeding.

<Aside type="note">
  After a successful test login, the user will be redirected to a URL like `https://example.com/?code=2aUqU0ZhQCjtz0fnrFL_i7wxhIAh7cTfxAXEIpJE-5w&locale=en&userState=AuthenticatedNotRegistered`.

  This occurs because you haven't set up a web application to handle the authorization code redirect yet. This is an important next step, but it's beyond the scope of this document. Consult the [5-minute setup guide](/docs/quickstarts/5-minute-setup-guide) for an example of how to do this.
</Aside>

If you log out and log in again with the same user, you'll notice that `Request received` will not show in the web service console. This is because FusionAuth is now using its own authentication service, as the original user password has been hashed and saved in the FusionAuth database.

The user has been successfully migrated, and {frontmatter.technology} authentication system is no longer needed.

#### Debug The Connector Service

If you encounter errors in this process, try the following:

- View the <Breadcrumb>System Event Logs</Breadcrumb> in the bottom left of the FusionAuth web interface.
- Add `puts` statements to the `fusionauth_connector_controller.rb` file to see where any errors are occurring.
- Adjust the timeout values of the Connector to higher values to accommodate network latency between API calls.

### Estimate The Slow Migration Timeline

When using a slow migration, you can estimate how many accounts will be migrated in a given period.

<SlowMigrationTimeline />

After this period, you may want to bulk migrate the rest of the users, or treat them as inactive and not migrate them. Plan to disable the Connector and remove the tenant's Connector policy after the slow migration is complete.

Learn more about [general slow migration considerations](/docs/lifecycle/migrate-users/general-migration#slow-migration-implementation).

## What to Do Next

<WhatNext />

## Additional Support

<AdditionalSupport />
