---
title: Gate Users Until They Verify Their Phone Number
description: Learn how to gate users' phone numbers until they have been verified.
navcategory: developer
section: lifecycle
subcategory: manage users
tertcategory: verification
---
import PremiumPlanBlurb from 'src/content/docs/_shared/_premium-plan-blurb.astro';
import Aside from 'src/components/Aside.astro';
import Breadcrumb from 'src/components/Breadcrumb.astro';
import InlineField from 'src/components/InlineField.astro';
import InlineUIElement from 'src/components/InlineUIElement.astro';
import JSON from 'src/components/JSON.astro';
import CommonQuestionsGating from 'src/content/docs/lifecycle/manage-users/verification/_common-questions-gating.mdx';

## Overview

As of version 1.99.9, FusionAuth can be configured to gate users' accounts until their phone number has been verified. While users successfully authenticate, they won't be able to proceed further until they have verified possession of the phone number they registered with.

To enable phone verification gating, do the following:

* Configure a messenger.
* Configure the tenant with your messenger.
* Configure the tenant to enable phone gating.
* Optionally customize the verification message template.
* Enable self-service registration.
* Configure your application with a redirect URL.

Let's step through each of these, but first, there are some required prerequisites.

## Prerequisites

<PremiumPlanBlurb />

This tutorial assumes you are running FusionAuth version 1.99.9 or greater. If you aren't, head on over to the [installation guide](/docs/get-started/download-and-install) or the [upgrade guide](/docs/operate/deploy/upgrade) to update to a version with support for this feature.

This tutorial also assumes you have a paid plan and valid license. If you need to buy a plan, please visit the [pricing page](/pricing). If you need to activate your instance, please visit the [Reactor page](/docs/get-started/core-concepts/licensing).

Although you do not have to use Twilio to send messages, this tutorial assumes you will use Twilio as your SMS messenger. If you want to use a different messenger, you can do so by creating a generic messenger instead of a Twilio messenger.

### Gating vs Verification

<Aside type="note">
Phone Verification is not a premium feature, however, gating is. Gating stops the user from receiving a JWT or essentially authenticating any further. FusionAuth is enforcing a "gate" around a user until they verify their phone number.
</Aside>

FusionAuth ships with phone verification flows. These verification flows update the `verified` and `verifiedReason` attributes on a user identity. As a developer, you have the option to gate the user (or prevent from "continuing" auth) based on these attributes when writing your application and integration code.

However, with paid plans of FusionAuth, you can elect to have _FusionAuth_ "gate" your users based on these verification attributes. Gating in this sense, would prevent the user from authenticating further or obtaining a JWT and _would be enforced by the FusionAuth User Interface_.

## Configure the Messenger

Log in to the FusionAuth administrative user interface. You could do all of this configuration with the API or kickstart, but for this tutorial you'll use the UI.

Navigate to <Breadcrumb>Settings -> Messengers</Breadcrumb> and then click <InlineUIElement>Add Twilio messenger</InlineUIElement> and enter your Twilio account information.

## Configure the Tenant with the Messenger

Navigate to <Breadcrumb>Tenants -> Your Tenant</Breadcrumb> and then select the <Breadcrumb>Identities</Breadcrumb> tab. Scroll to the <InlineUIElement>Messenger settings</InlineUIElement> section. Configure this with the messenger you just created.

<img src="/img/docs/lifecycle/manage-users/verification/tenant-identities-settings.png" alt="Tenant Identities settings" width="1200" role="bottom-cropped" />

## Enable Phone Verification Gating

* Under Phone, enable <InlineField>Verify identity</InlineField>.
* Choose your message template. The default template is `Phone Verification`, and that will work fine for this tutorial.
* <InlineField>Verification strategy</InlineField>. For this tutorial, keep the default value of `FormField`. For future reference, this can be either `ClickableLink` or `FormField`. `ClickableLink` sends an SMS with a link to verify the user's phone number. `FormField` sends a code which the user will provide to FusionAuth.
* Ensure that the <InlineField>Unverified behavior</InlineField> value is `Gated`.

After these steps, you should end up with a configuration screen that looks like this:

<img src="/img/docs/lifecycle/manage-users/verification/tenant-phone-verification-settings.png" alt="Tenant phone verification settings" width="1200" role="bottom-cropped" />

Make sure you save the configuration.

## Customize the Phone Verification Template

Navigate to <Breadcrumb>Customizations -> Message Templates</Breadcrumb>. Edit the `Phone Verification` template by selecting the <InlineUIElement>Edit</InlineUIElement> item from the action menu.

Modify the text template as desired and then save. You can also localize the messages.

<img src="/img/docs/lifecycle/manage-users/verification/phone-template-customization.png" alt="Customizing the phone verification message template" width="1200" />

## Configure the Application

Navigate to <Breadcrumb>Applications</Breadcrumb>. Edit your application by clicking on the blue <InlineUIElement>Edit</InlineUIElement> button.

Enable self service registration by selecting the <Breadcrumb>Registration</Breadcrumb> tab, and then scrolling to the <InlineUIElement>Self service registration</InlineUIElement> section.

<Aside type="note">
You can create a user with an unverified phone number in other ways than self service registration. However, self service registration is the simplest way to create a user without a verified phone number.
</Aside>

Enable self service registration and configure the displayed and required fields as desired (in particular, choose `Phone` for the `Login type`).

<img src="/img/docs/lifecycle/manage-users/verification/application-enable-self-registration-phone.png" alt="Enabling application self registration" width="1200"  role="top-cropped bottom-cropped" />

Next, navigate to the <Breadcrumb>OAuth</Breadcrumb> tab. Enable the `Authorization Code` grant.

In addition, ensure you have entered a valid URL in the <InlineField>Authorized redirect URLs</InlineField> field. (The value of this redirect URL doesn't really matter for this tutorial. But for production use, ensure the code at that endpoint can exchange an authorization code for a token.)

Save the application configuration. You'll be returned to the list of applications.

Click on the green <InlineUIElement>View</InlineUIElement> button of your application to see the details of your application.

<img src="/img/docs/lifecycle/manage-users/verification/view-application-details.png" alt="View application details to see the relevant URLs" width="1200" />

Look for the <InlineField>Registration URL</InlineField>. It'll be something like `https://local.fusionauth.io/oauth2/register?client_id=85a03867-dccf-4882-adde-1a79aeec50df&response_type=code&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Foauth-redirect`. Copy that value as you'll use it below.

At the same time, find the <InlineField>OAuth IdP login URL</InlineField>, and copy that as well.

## Test It Out

Now, test out the functionality. Register a new account. Make sure to use a different browser or incognito mode so that the admin account you logged in with while configuring FusionAuth doesn't interfere with new user registration.

Visit the registration URL copied above. You'll be prompted to register. Fill out the form with a valid phone number. After registration is complete, you'll receive a message prompting you to verify the phone number.

Here is the message in the iOS interface:

<img src="/img/docs/lifecycle/manage-users/verification/verification-sms-message-ios.png" alt="Verification message in iOS" width="1200" role="bottom-cropped" />

This user account will be gated and unable to completely log in if you have registered but not yet verified the phone number. In your browser where you registered, you'll see a page similar to below:

<img src="/img/docs/lifecycle/manage-users/verification/phone-verification-gate-screen-form-field.png" alt="Form field default phone verification gate screen" role="bottom-cropped" />

To test the gating, open a different browser (not a window, but an entirely different browser) and visit the login URL copied above. Enter the phone number and password for the user you just registered.

You'll be sent to the same phone verification gate page.

No matter which API or hosted login page you use, no JWT will be issued until the user has been verified. The user will continue to see the verification prompt when they log in until then.

If an API is being used to authenticate the user, the API will return a status code indicating phone verification has not yet occurred. Please see the [Login API](/docs/apis/login) for more details.

If you view the user in the administrative user interface, you'll see a question mark next to their phone number. This indicates that their phone number has not yet been verified.

<img src="/img/docs/lifecycle/manage-users/verification/unverified-phonenumber-user-details-screen.png" alt="Unverified user details screen" width="1200" role="bottom-cropped" />

Once you have verified the phone number by entering the code from the message, you can now log in and will be sent to the configured redirect URL.

## The User Object

The user object changes before, during, and after the phone verification occurs. Let's look at the JSON.

If a user is created and phone verification is disabled, the verified attribute of the identity object will be `false` with a reason of `Disabled`.

<JSON title="User Object With Phone Verification Turned Off Initially JSON" src="registration-gate/user-phone-verification-turned-off-initially.json" />

If a user is created while phone verification is enabled, the verified attribute of the identity object will be `false` with a reason of `Pending`

<JSON title="User Object With Phone Verification Turned On Initially JSON" src="registration-gate/user-phone-verification-turned-on-initially.json" />

Naturally, the user's phone number identity will change to `verified: true` with `verifiedReason: "Completed"` once the user verifies their phone number.

<Aside type="note">
Users imported through the Import API will have whatever attributes are initially imported regardless of verification or gate settings.
</Aside>

## Common Questions

<CommonQuestionsGating />

## Troubleshooting Phone Verification

### Links Sent to Users Don't Function As Expected


Users cannot verify their phone number. The link or code does not work (it is expired or there is some other error).

#### Check External Identifier Timeouts

Ensure your external identifier timeouts are appropriate. Reasonable defaults are set, but they can be adjusted (<Breadcrumb>Tenants -> Advanced Tab -> External identifier durations</Breadcrumb>), with particular attention paid to `Phone Verification` duration.

<img src="/img/docs/lifecycle/manage-users/verification/tenant-timeouts-phone.png" alt="Tenant Phone Timeouts Screenshot" width="1200" />

## Next Steps

Now that you've successfully set up gated phone verification, take the next steps to integrate this functionality into your application:

* Discover how to [modify your theme](/docs/customize/look-and-feel/) to make the phone verification gate pages look like your application.
* Learn more about [message templates](/docs/customize/email-and-messages/) and how to customize them.
