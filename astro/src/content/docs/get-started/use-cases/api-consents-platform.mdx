---
title: API Consents Platform
description: Integrate with third party platforms, using FusionAuth to safely store refresh tokens.
section: get started
subcategory: use cases
navOrder: 80
---
import Aside from 'src/components/Aside.astro';
import StoreRefreshTokensDiagram from 'src/diagrams/docs/get-started/use-cases/authorization-hub/store-refresh-token.astro';
import RetrieveAccessTokenDiagram from 'src/diagrams/docs/get-started/use-cases/authorization-hub/retrieve-access-token.astro';
import APIConsentsPlatformDescription from 'src/content/docs/get-started/use-cases/_api-consents-platform-description.mdx';

## Overview

<APIConsentsPlatformDescription />

## Problem 

You have valuable data, robust APIs and a substantial user base and want to foster an ecosystem of applications or services on top of your data and APIs.

With the API consents platform, you can let internal or external developers build on top of your platform, letting FusionAuth manage the authentication, consent gathering, and scopes management.

This is the inverse of the authorization hub use case](/docs/get-started/use-cases/authorization-hub). Here, you are issuing tokens after the user offers consent.

## Solution

Use FusionAuth to manage these applications and the scopes needed for your APIs to properly respond to a request from a client.

With this use case, you can use FusionAuth to:

* centrally manage all your scopes for your APIs
* store information about third-party applications built on top of your platform
* to allow users to offer or revoke consent to applications

This is an example of [the First-Party Service Authorization Mode](/docs/lifecycle/authenticate-users/oauth/modes#first-party-service-authorization).

## Prerequisites

You have configured your application or applications to [delegate authentication to FusionAuth](/docs/get-started/use-cases/auth-service) via the Authorization Code grant and the hosted login pages, such that you have your user data in FusionAuth.

You have APIs you want to expose.

You have a paid license installed on your FusionAuth instance. The functionality in this use case requires the Essentials plan or higher. [Learn more about pricing](/pricing).

## Example Scenario

Suppose you are a financial services platform offering payment processing, investment management and more. You want to allow developers to build on top of your platform. You aren't quite sure what applications the developers will build, but you hope that they will build:

* analytics tools
* budget tracking
* investment management and optimization
* loan comparison tool

You have APIs for each of these operations already, and are ready to publish them publicly.

You'll need to manage each of these applications built on top of your platform. Every user who installs one will need to give permission to each application to access their data.

To make the scenario even more specific, let's say you are onboarding a analytics tool, which will help your users understand their spending habits over time, but won't be making any modifications to their accounts.

## Actors/Components

* developers building on your platform
* your users
* your APIs
* FusionAuth

## Implementation Steps

This is a TODO phase implementation. Here's the high level plan.

* Define your scopes
* Modify your APIs to accept access tokens, including scope verification
* Onboard developers and add a new third-party application in FusionAuth with these scopes
* Have developers add authorize URL and store refresh token
* Add a screen to show users which applications they have allowed access

### Define Your Scopes

Think about the type of operations you want your third-party developers to be able to perform. Group these into similar areas. Scopes: 

* should be coarse grained (not map one to one with your API endpoints)
* can be hierarchical (you could have `account:read` and `account_details:read` where the latter is a subset of the former)
* should be designed around business concepts not technical ones
* must use terms intelligible to the end user
* can contain any visible ASCII character except `"` and `\`; the `:` and `.` characters are often used as delimiters

Whatever you choose, these will be long lived once released, so consider a beta test with a small set of external and internal developers to test your assumptions about the right list of scopes. It's also better to start with a smaller set of scopes and add more later.

In the example scenario, let's use the following scopes as a starting point:

* `accounts.read`: Basic account information and balances
* `profile.read`: User profile and contact information
* `transactions.read`: Transaction history and details
* `transfers.write`: Initiate money transfers between accounts
* `payments.write`: Make bill payments
* `investments.read`: Investment portfolio information
* `investments.trade`: Execute investment trades
* `creditScore.read`: Access credit score information

### Modify Your APIs To Check Scopes

You'll want to modify your APIs to accept an access token if they don't already.

You'll need to validate the access token signature, and the claims associated with the access token. In particular, you'll need to associate every API with one or more scopes. If a request comes in with an invalid scope or no scope, fail it in the same way you would if the signature was invalid.

TODO code

You can also check required claims and signatures at your API gateway rather than in your code, but the process is the same.

### Build Onboarding Process

Once you've decided on scopes and implemented scope checks through your APIs, you'll need to build out an application approval and onboarding process.

This will include:

* capturing prospective application information, including how the user's data will be used and desired scopes, both optional and required
* evaluating the application, including which scopes are appropriate
* configuring FusionAuth if the application is approved
* getting required information to the developer
* promoting the developers application to your users

These are all important. However, the business processes around onboarding a new application will be specific to your organization, so let's focus on the FusionAuth configuration.

As part of your evaluation, you asked what data this new application needs from your users and platform, by asking the subset of scopes needed. You can then create a new Application in FusionAuth. 

Remember, you are onboarding an analytics platform, so of the scopes listed above, you need to provide only the `read` ones. In addition, after discussion with the developers, you decide that the following scopes will be required:

* `accounts.read`: Basic account information and balances
* `profile.read`: User profile and contact information
* `transactions.read`: Transaction history and details

And these scopes will be optional:

* `investments.read`: Investment portfolio information
* `creditScore.read`: Access credit score information

So you create an application configuration that looks like this:

TODO show application creation

While this was done manually, you can also do this with [our SDKs](/docs/sdks). Here's sample code to do so:

```javascript
TODO
```

You need to allow self-service registration for this application, since you want your users to be able to access it 

## Expected Outcome

After implementing this use 

## Edge Cases

TODO can you see what scopes have been granted? I don't think so, maybe in refresh token?

## Other Example Scenarios

These include:

In each of these cases there's a platform and API which is used to provide app functionality to third-party applications.

## Additional Documentation

* [The First-Party Service Authorization Mode](/docs/lifecycle/authenticate-users/oauth/modes#first-party-service-authorization)
* [The authorization hub use case](/docs/get-started/use-cases/authorization-hub)
* [List of SDKs](/docs/sdks)
* [Oauth scopes documentation](/docs/lifecycle/authenticate-users/oauth/scopes)
* [The Authorization endpoint](/docs/lifecycle/authenticate-users/oauth/endpoints#authorize)
* [API gateways integration documentation](/docs/extend/examples/api-gateways/)
* [Custom OAuth scopes blog post](/blog/custom-scopes-in-third-party-applications)

TODO

rate limitinig
, monetization beyond scope haha
mcp
oauth scope design

steps
- create a template with appropriate scopes mark as a third party application
- set up an application for each developer/custom application
- register users for that application
- have users log into that application with scopes requested, give consent
- get an access token with scopes included
- present access token to API
- list applications that they've offered consent to? ?

can localize scope values
theming of login page for the application?
