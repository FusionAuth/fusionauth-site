---
title: Express
description: Quickstart integration of an Express web application with FusionAuth
navcategory: getting-started
prerequisites: npm, node
section: web
technology: Express
language: JavaScript
icon: /img/icons/javascript.svg
faIcon: fa-x
color: fuchsia
coderoot: https://raw.githubusercontent.com/FusionAuth/fusionauth-quickstart-javascript-express-web/main
cta: EmailListCTA
---
import Aside from '/src/components/Aside.astro';
import LoginAfter from '../../diagrams/quickstarts/login-after.astro';
import LoginBefore from '../../diagrams/quickstarts/login-before.astro';
import RemoteCode from '/src/components/RemoteCode.astro';


In this quickstart you are going to build an application with Express and integrate it with FusionAuth.
You'll be building it for [ChangeBank](https://www.youtube.com/watch?v=CXDxNCzUspM), a global leader in converting dollars into coins.
It'll have areas reserved for users who have logged in as well as public facing sections.

The docker compose file and source code for a complete application are available at
[https://github.com/FusionAuth/fusionauth-quickstart-javascript-express-web](https://github.com/FusionAuth/fusionauth-quickstart-javascript-express-web).

## Prerequisites
* [Node LTS](https://nodejs.org/en/download)
* [Docker](https://www.docker.com): The quickest way to stand up FusionAuth. (There are [other ways](/docs/v1/tech/installation-guide/)).
* [git](https://git-scm.com/downloads/): Not required but recommended if you want to track your changes.
* [express 4.16+](https://expressjs.com/): Web Framework for Node.js 

## General architecture

While this sample application doesn't have login functionality without FusionAuth, a more typical integration will replace an existing login system with FusionAuth.

In that case, the system might look like this before FusionAuth is introduced.

<LoginBefore alt={"Request flow during login before FusionAuth"}/>

The login flow will look like this after FusionAuth is introduced.

<LoginAfter alt={"Request flow during login after FusionAuth"}/>

In general, you are introducing FusionAuth in order to normalize and consolidate user data. This helps make sure it is consistent and up-to-date as well as offloading your login security and functionality to FusionAuth.

## Getting Started
In this section, you'll get FusionAuth up and running, and configured with the ChangeBank application.

### Clone the Code
First off, grab the code from the repository and change into that directory.

```
git clone https://github.com/FusionAuth/fusionauth-quickstart-javascript-express-web.git
cd fusionauth-quickstart-javascript-express-web
```

### Run FusionAuth via Docker

In the root directory of the repo you'll find a Docker compose file (docker-compose.yml) and an environment
variables configuration file (.env). Assuming you have Docker installed on your machine, you can stand up
FusionAuth up on your machine with:

```
docker compose up -d
```

This will start three containers, once each for FusionAuth, Postgres, and Elastic.

Here you are using a bootstrapping feature of FusionAuth, called [Kickstart](/docs/v1/tech/installation-guide/kickstart).
When FusionAuth comes up for the first time, it will look at the `kickstart/kickstart.json` file and
configure FusionAuth to a certain initial state.

<Aside type="note">
If you ever want to reset the FusionAuth system, delete the volumes created by Docker Compose by
executing `docker compose down -v`, then re-run `docker compose up -d`.
</Aside>

FusionAuth will be configured with these settings:
* Your client Id is `e9fdb985-9173-4e01-9d73-ac2d60d1dc8e`.
* Your client secret is `2HYT86lWSAntc-mvtHLX5XXEpk9ThcqZb4YEh65CLjA-not-for-prod`.
* Your example username is `richard@example.com` and the password is `password`.
* Your admin username is `admin@example.com` and the password is `password`.
* The base URL of FusionAuth `http://localhost:9011/`.

You can log into the [FusionAuth admin UI](http://localhost:9011/admin) and look around if you want, but with Docker/Kickstart you don’t need to.

### Setup Application

In this section, you'll set up a basic Express application with a single page.

Create a new directory to hold your application, and go into it.

```shell
mkdir changebank
cd changebank
```

Create a file called `package.json` with the below dependencies and scripts. Feel free to update the `author` or other attributes as needed. 

The `@fusionauth/typescript-client` will be used to exchange the OAuth Code for Access Token using PKCE, and also to retrieve the User using JWT.

`package.json`
<RemoteCode url={frontmatter.coderoot + "/complete-application/package.json"}
  lang="json" />

Install dependencies using npm.

```shell
npm install
```

Create a new directory to hold your source code, and go into it.

```shell
mkdir src
cd src
```

## Authentication

Make sure once again that you are in the directory `change-bank/src`.
Create a file called `index.ts` and start by setting up your imports and constants. These constants have already been created by running the kickstart when running FusionAuth.

<RemoteCode url={frontmatter.coderoot + "/complete-application/src/index.ts"}
  lang="ts"
  tags="top"/>

<Aside type="note">
If you want to see where the FusionAuth values came from, they can be found in the 
FusionAuth app (http://localhost:9011/admin). The tenant ID is found on the Tenants
page. To see the Client Id and Client Secret, go to the Applications page and 
click the `View` icon under the actions for the ChangeBank application. You'll 
find the Client Id and Client Secret values in the `OAuth configuration` section.
</Aside>

### Static files

You need a way to serve your static files, luckily Express makes this easy with `express.static`. These files will include all of the CSS and images that are required for the UI of the ChangeBank application. 

Make sure that you are in the directory `change-bank` when running these commands to create new directories and copy the css and images required from `complete-application`.

```shell
mkdir static && mkdir static/css && mkdir static/img && 
cp ../complete-application/static/css/changebank.css static/css/changebank.css && cp ../complete-application/static/img/money.jpg static/img/money.jpg
```

In your `index.ts` file include the below code to serve any assets in the static directory.

<RemoteCode url={frontmatter.coderoot + "/complete-application/src/index.ts"}
  lang="ts"
  tags="static"/>

### Homepage

In order to show off your homepage you need to create a route with the base URL `/`. In this route check to see if `userDetails` cookie has any user values and correctly respond with either the `home.html` or `account.html` template. Also if there is no user you can generate the PKCE challenge pair and store them into `userSession` cookie (this is an `HTTPOnly` cookie, inaccessible to JavaScript).

<Aside type="note">
In this file you will use the [pkce-challenge](https://www.npmjs.com/package/pkce-challenge) package to generate a Proof Key for Code Exchange (PKCE) challenge pair. Read more about [PKCE](/articles/oauth/modern-guide-to-oauth).
</Aside>

Include the below code into `index.ts`, so that the homepage can be displayed when a user is not logged in. If a user is logged in this route will redirect to the `/account` route.

<RemoteCode url={frontmatter.coderoot + "/complete-application/src/index.ts"}
  lang="ts"
  tags="homepage"/>

### Login Route

In the ChangeBank application there is a `Login` button which will open the `/login` route when clicked. This route redirect them to a login page managed by FusionAuth.

<RemoteCode url={frontmatter.coderoot + "/complete-application/src/index.ts"}
  lang="ts"
  tags="login"/>

- `client_id`: Your `applicationId`
- `response_type`: `code` since you are using the Authorization Code grant
- `redirect_uri`: Where your FusionAuth will redirect back to during the OAuth grant. In this example, this is our route `oauth-redirect`, which you'll build next.
- `state`: A random string created in your homepage route and stored in the cookie as `stateValue`
- `code_challenge`: Created in the homepage route using `pkce-challenge` and stored in a cookie as `challenge`, this is one half of the PKCE 

### OAuth Redirect

When FusionAuth redirects back to your Express application, it will return to your `/oauth-redirect` route. In this response it will have two query parameters that you need to further examine: `code` and `state`. 

You'll need to do the following:

1. Check that the `stateValue` stored in the cookie matches the `state` query parameter.
1. Make a request to the FusionAuth token endpoint to exchange the authorization `code` received after the user authenticates at FusionAuth and a `verifier` from our `userSession` cookie for an access token.
1. Retrieve the user by passing the access token to FusionAuth.
1. Store access token details in the `userToken` cookie.
1. Store retrieved user in `userDetails` cookie.
1. Redirect to `/account` route.

<RemoteCode url={frontmatter.coderoot + "/complete-application/src/index.ts"}
  lang="ts"
  tags="oauth-redirect"/>

### Account Route

The `/account` page represents what a user sees when they’re logged into their ChangeBank account. A user that isn’t logged in who tries to access this page should just be taken to the home page.

<Aside type="note">
In a production application, you would validate the token signature, make sure it wasn't expired, and attempt to refresh it if it were expired.
</Aside>

<RemoteCode url={frontmatter.coderoot + "/complete-application/src/index.ts"}
  lang="ts"
  tags="account"/>

### Make Change

Two functions are needed to accept both GET and POST requests on the `/make-change` route. The `GET` verifies that the user is logged in, then servers the HTML file required for the page. The `POST` takes the amount form value as a body parameter and uses the it to calculate how many quarters, dimes, nickels and pennies to return. If `total` is not a valid dollar value or cannot be converted an `error` message is returned. The return string `message` is received by asyncronously and updates the `change-message` or `error-message` div accordingly.

Add the code below to `index.ts`.

<RemoteCode url={frontmatter.coderoot + "/complete-application/src/index.ts"}
  lang="ts"
  tags="make-change"/>

### Logout Route

<Aside type="tip">
Click the `Logout` button and watch the browser first go to FusionAuth to log out the user, then return to your home page.
</Aside>

The last step is to implement logout. When you log a user out of an application, you'll take them to 
FusionAuth's `/oauth2/logout` endpoint. FusionAuth calls the logout endpoint (killing the express session), then kills the FusionAuth session, then redirects to the logout endpoint. This endpoint deletes any cookies that your application created, clearing the user's session.

<RemoteCode url={frontmatter.coderoot + "/complete-application/src/index.ts"}
  lang="ts"
  tags="logout"/>

In the below code, you check if the current user session has any information about the user and redirect to the FusionAuth server to initiate the logout on the server. When this returns, the user session cookie will now be empty and you can therefore forward back to your homepage. If you didn't add this check, you would be stuck in an infinite loop between your Express server and FusionAuth.

```ts
if (userSession) {
    res.redirect(302, `${fusionAuthURL}/oauth2/logout?client_id=${clientId}`);
} else {
    res.redirect(302, '/')
}
```

## Next Steps
This quickstart is a great way to get a proof of concept up and running quickly, but to run your application in production, there are some things you're going to want to do.

### FusionAuth Customization
FusionAuth gives you the ability to customize just about everything with the user's experience and your application's integration. This includes
* [Hosted pages](/docs/v1/tech/themes/) such as login, registration, email verification, and many more
* [Email templates](/docs/v1/tech/email-templates/email-templates)
* [User data and custom claims in access token JWTs](/articles/tokens/jwt-components-explained)
### Security
* You may want to customize the [token expiration times and policies](/docs/v1/tech/oauth/#configure-application-oauth-settings) in FusionAuth
* Choose [password rules](/docs/v1/tech/core-concepts/tenants#password) and a [hashing algorithm](/docs/v1/tech/reference/password-hashes) that meet your security needs
### Tenant and Application Management
* Model your application topology using [Applications](/docs/v1/tech/core-concepts/applications), [Roles](/docs/v1/tech/core-concepts/roles), [Groups](/docs/v1/tech/core-concepts/groups), [Entities](/docs/v1/tech/core-concepts/groups), and more
* Set up [MFA](/docs/v1/tech/guides/multi-factor-authentication), [Social login](/docs/v1/tech/identity-providers/), and/or [SAML](/docs/v1/tech/identity-providers/samlv2/) integrations
* Integrate with external systems using [Webhooks](/docs/v1/tech/events-webhooks/), [SCIM](/docs/v1/tech/core-concepts/scim), and [Lambdas](/docs/v1/tech/lambdas/)
