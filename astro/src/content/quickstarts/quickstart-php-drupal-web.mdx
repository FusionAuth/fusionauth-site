---
title: Drupal
description: Quickstart integration of Drupal web application with FusionAuth
navcategory: getting-started
prerequisites: Drupal, Docker, Composer, Drush
section: web
technology: Drupal
language: PHP
icon: /img/icons/drupal.svg
faIcon: fa-gem
color: rose
cta: EmailListCTA
---
import Aside from '../../components/Aside.astro';
import LoginAfter from '../../diagrams/quickstarts/login-after.astro';
import LoginBefore from '../../diagrams/quickstarts/login-before.astro';
import RemoteCode from '../../components/RemoteCode.astro';
import RemoteValue from '../../components/RemoteValue/RemoteValue.astro';

You will create a Drupal application and integrate it with FusionAuth in this quickstart.
You'll be creating it for [ChangeBank](https://www.youtube.com/watch?v=CXDxNCzUspM), a leader in the world of coin-to-dollar conversion. Both public facing sections and areas designated for logged-in users will be present.

The docker compose file and source code for a complete application are available at
https://github.com/FusionAuth/fusionauth-php-quickstart-drupal-web

## Prerequisites

- [Composer](https://getcomposer.org/): This will be used to install a copy of Drupal and all required packages.
- [Drupal](https://www.drupal.org/): We'll be grabbing the latest copy of Drupal 10.
- [Drush](https://www.drupal.org/): This is used to control, manipulate and manage the Drupal application from the command line.
- [Docker](https://www.docker.com): The quickest way to stand up FusionAuth. (There are [other ways](/docs/v1/tech/installation-guide/)).

This app has been tested with Drupal 10.1.5. This example should work with other compatible versions of Drupal 10.

<Aside type="note">
Drupal 10 requires PHP 8.1.0 or higher and MariaDB 10.3.7+ or MySQL/Percona 5.7.8+ in order to run.
</Aside>

## General Architecture

Drupal has, by default, a built-in login and authentication system.

As such, the application will resemble the following before FusionAuth is introduced.

<LoginBefore alt={"Request flow during login before FusionAuth"}/>

The login flow will look like this after FusionAuth is introduced.

<LoginAfter alt={"Request flow during login after FusionAuth"}/>

In general, you are introducing FusionAuth in order to normalize and consolidate user data. This helps make sure it is consistent and up-to-date as well as offloading your login security and functionality to FusionAuth.

## Getting Started

In this section, you'll get FusionAuth up and running and use Composer to create a new Drupal application.

### Clone the Code

First off, grab the code from the repository and change into that directory.

```
git clone https://github.com/FusionAuth/fusionauth-quickstart-php-drupal-web.git
cd fusionauth-quickstart-drupal-web
```

### Run FusionAuth via Docker

In the root directory of the repo you'll find a Docker compose file (docker-compose.yml) and an environment variables configuration file (.env). Assuming you have Docker installed on your machine, you can stand up FusionAuth up on your machine with:

```
docker compose up -d
```

Here you are using a bootstrapping feature of FusionAuth, called [Kickstart](/docs/v1/tech/installation-guide/kickstart). When FusionAuth comes up for the first time, it will look at the `kickstart/kickstart.json` file and configure FusionAuth to a certain initial state.

<Aside type="note">
If you ever want to reset the FusionAuth system, delete the volumes created by docker-compose by executing `docker compose down -v`, then re-run `docker compose up -d`.
</Aside>

FusionAuth will be initially configured with these settings:

* Your client Id is <code><RemoteValue url="https://raw.githubusercontent.com/FusionAuth/fusionauth-quickstart-php-drupal-web/main/kickstart/kickstart.json" selector="$.variables.applicationId" /></code>.
* Your client secret is <code><RemoteValue url="https://raw.githubusercontent.com/FusionAuth/fusionauth-quickstart-php-drupal-web/main/kickstart/kickstart.json" selector="$.requests.[?(@.url === '/api/application/#{applicationId}')].body.application.oauthConfiguration.clientSecret" /></code>.
* Your example username is <code><RemoteValue url="https://raw.githubusercontent.com/FusionAuth/fusionauth-quickstart-php-drupal-web/main/kickstart/kickstart.json" selector="$.variables.userEmail" /></code> and the password is <code><RemoteValue url="https://raw.githubusercontent.com/FusionAuth/fusionauth-quickstart-drupal-web/main/kickstart/kickstart.json" selector="$.variables.userPassword" /></code>.
* Your admin username is <code><RemoteValue url="https://raw.githubusercontent.com/FusionAuth/fusionauth-quickstart-php-drupal-web/main/kickstart/kickstart.json" selector="$.variables.adminEmail" /></code> and the password is <code><RemoteValue url="https://raw.githubusercontent.com/FusionAuth/fusionauth-quickstart-php-drupal-web/main/kickstart/kickstart.json" selector="$.variables.adminPassword" /></code>.
* The base URL of FusionAuth `http://localhost:9011/`.

You can log into the [FusionAuth admin UI](http://localhost:9011/admin) and look around if you want, but with Docker/Kickstart you don't need to.

### Create your Drupal Application

Now you are going to create a Drupal application. In your terminal, run the following command to pull the latest version of Drupal 10:

```bash
composer create-project drupal/recommended-project:10.1.5 "changebank" && cd changebank
```

Navigate to your browser and enter the path to your drupal installation.

Run through the installation wizard and fill in all required fields.

Once you've successfully completed the installation wizard you should land up on the welcome page.

Now that your Drupal application is installed, we're going to install a contributed module called OpenID Connect that will handle the authentication with FusionAuth and another module called Admin Toolbar which adds a bit of quality of life when navigating Drupal's administration menu.

Flip back to your terminal and run the following command:

```bash
composer require 'drupal/openid_connect:3.x-dev@dev' 'drupal/admin_toolbar:^3.4'
```

To enable the modules, you can do so by visiting the extensions page of your Drupal application at /admin/modules or by running the following command:

```bash
drush pm-enable openid_connect admin_toolbar
```

## Authentication

To setup the authentication between Drupal and FusionAuth, head to /admin/config/people/openid-connect on your Drupal site or hover over Configuration > People and click on OpenID Connect.

Add a new client by clicking on + Generic OAuth 2.0 and then filling in the details as follows:

- Name:
- Client ID:
- Client secret:
- Authorization endpoint:
- Token endpoint:

## App Customization

In this section, you'll turn your application into a trivial banking application with some styling.

We're going to create a module called Changebank that will handle the logic for making change from whole dollars and also add a couple of blocks to the application.

### Generate Module

At your terminal, make sure you are inside the Drupal project directory and run the following command:

```bash
drush generate module
```
You will be presented with the module wizard. Fill it out as follows:

```
Welcome to module generator!

Module name [Web]:
Changebank

Module machine name [changebank]:
changebank

Module description [Provides additional functionality for the site.]:
Provides a way to make change from whole dollars.

Package name name [Custom]:
Custom

Dependencies (comma separated):

Would you like to create a module file [No]:
Yes

Would you like to create a install file [No]:
No

Would you like to create a libraries file [No]:
No

Would you like to create a permissions file [No]:
No

Would you like to create event subscriber [No]:
No

Would you like to create block plugin [No]:
Yes

Would you like to create a controller [No]:
Yes

Would you like to create a settings form [No]:
No

The following directories and files have been created or updated:

- /var/www/html/web/modules/custom/changebank/changebank.info.yml
- /var/www/html/web/modules/custom/changebank/changebank.module
- /var/www/html/web/modules/custom/changebank/changebank.routing.yml
- /var/www/html/web/modules/custom/changebank/src/Controller/ChangebankController.php
- /var/www/html/web/modules/custom/changebank/src/Plugin/Block/ExampleBlock.info.yml
```



The first block that was created when we generatd the module has a filename of `ExampleBlock.php` which is far too generic.

Navigate to /web/modules/custom/changebank/src/Plugin/Block/ and rename it to `UserLoginLogoutBlock.php` which is more descriptive of its intended purpose.

We're also going to generate an additional block and a form which we will do now.

To generate the block, run the following command and complete the wizard:

```bash
drush generate block
```

You will be presented with the block wizard. Fill it out as follows:

```
Welcome to block generator!

Module machine name [web]:
changebank

Block admin label [Example]:
User Email Block

Plugin ID [changebank_useremailblock]:
useremailblock

Plugin class [UserEmailBlockBlock]:
UserEmailBlock

Block category [Custom]:
Custom

Make the block configurable? [No]:
No

Would you like to inject dependencies? [No]:
No

Create access callback? [No]:
No

The following directories and files have been created or updated:

- /var/www/html/web/modules/custom/changebank/src/Plugin/Block/UserEmailBlock.php
```

To generate the form, run the following command:

```bash
drush generate form
```

You will be presented with the form wizard. Fill it out as follows:

```
Welcome to form generator!

Module machine name [web]:
changebank

Class [ExampleForm]:
ChangebankForm

Would you like to create a route for this form? [Yes]:
No

The following directories and files have been created or updated:

- /var/www/html/web/modules/custom/changebank/src/Form/ChangebankForm.php
```


### Customizing the Module

Next, we are going to customize the module by making changes to the following files:

- `ChangebankForm.php`
- `ChangebankController.php`
- `changebank.routing.yml`
- `UserEmailBlock.php`
- `UserLoginLogoutBlock.php`
- `changebank.module`

#### Customizing the Changebank Form

Select the form `ChangebankForm.php` located at /web/modules/custom/changebank/src/Form/ in your text editor, clear the existing boilerplate contents and add the following in:

```php
<?php

namespace Drupal\changebank\Form;

use Drupal\Core\Form\FormBase;
use Drupal\Core\Form\FormStateInterface;

/**
 * Provides a form for creating change from an amount in US dollars.
 */
class ChangebankForm extends FormBase {

  /**
   * {@inheritdoc}
   */
  public function getFormId() {
    return 'changebank_form';
  }

  /**
   * {@inheritdoc}
   */
  public function buildForm(array $form, FormStateInterface $form_state) {
    $result = $form_state->get('result');

    $form['result_wrapper'] = [
      '#type' => 'container',
      '#attributes' => [
        'class' => ['changebank-result-wrapper'],
      ],
    ];

    if ($form_state->get('result')) {
      $form['result_wrapper']['result'] = [
        '#markup' => $result,
      ];
    }

    $form['amount'] = [
      '#type' => 'number',
      '#title' => $this->t('Amount in USD: $'),
      '#required' => TRUE,
      '#min' => 1,
      '#step' => 1.0,
    ];
    $form['submit'] = [
      '#type' => 'submit',
      '#value' => $this->t('Make Change'),
    ];

    return $form;
  }

  /**
   * {@inheritdoc}
   */
  public function submitForm(array &$form, FormStateInterface $form_state) {
    $amount = $form_state->getValue('amount');
    $quarters = 0;
    $dimes = 0;
    $nickels = 0;
    $pennies = 0;

    // Calculate the number of quarters, dimes, nickels, and pennies for every 100 cents (1 dollar).
    $quarters_per_dollar = 2;
    $dimes_per_dollar = 3;
    $nickels_per_dollar = 3;
    $pennies_per_dollar = 5;

    $quarters += floor($amount) * $quarters_per_dollar;
    $dimes += floor($amount) * $dimes_per_dollar;
    $nickels += floor($amount) * $nickels_per_dollar;
    $pennies += floor($amount) * $pennies_per_dollar;

    $amount_in_cents = $amount * 100;
    $amount_in_cents %= 100;

    $quarters += floor($amount_in_cents / 25);
    $amount_in_cents %= 25;
    $dimes += floor($amount_in_cents / 10);
    $amount_in_cents %= 10;
    $nickels += floor($amount_in_cents / 5);
    $amount_in_cents %= 5;
    $pennies += $amount_in_cents;

    $result = $this->t('We can make change for $@dollars with @dimes dimes, @nickels nickels and @pennies pennies!', [
      '@dollars' => $amount,
      '@quarters' => $quarters,
      '@dimes' => $dimes,
      '@nickels' => $nickels,
      '@pennies' => $pennies,
    ]);

    $form_state->setRebuild(TRUE);
    $form_state->set('result', $result);

    \Drupal::state()->set('changebank_form_value', $result);
  }

}
```

#### Customizing the Controller

Select the `ChangebankController.php` file located at /web/modules/custom/changebank/src/Controller/ in your text editor and make the following changes:

```php
<?php

namespace Drupal\changebank\Controller;

use Drupal\Core\Controller\ControllerBase;

/**
 * Returns responses for changebank routes.
 */
class ChangebankController extends ControllerBase {

  /**
   * Builds the response.
   */
  public function build() {
    $build = [];
    $form = $this->formBuilder()->getForm('\Drupal\changebank\Form\ChangebankForm');
    $build['form'] = $form;
    return $build;
  }

  /**
   * Displays the form submission value on the account page.
   */
  public function accountBalance() {
    $value = \Drupal::state()->get('changebank_form_value');
    $arguments = $value->getArguments();
    $dollars = $arguments['@dollars'];
    return [
      '#markup' => '<span class="account-balance">$' . $dollars . '',
      '#cache' => [
        'contexts' => [
          'session',
        ],
        'max-age' => 0,
      ],
    ];
  }

}
```

#### Customizing the Routing

Next we're going to setup two routes, one for the form and one for the account page. Select the `changebank.routing.yml` file located at /web/modules/custom/changebank/ and make the following changes:

```yaml
changebank.makechange:
  path: '/makechange'
  defaults:
    _title: 'We Make Change'
    _controller: '\Drupal\changebank\Controller\ChangebankController::build'
    _form: 'Drupal\changebank\Form\ChangebankForm'
  requirements:
    _user_is_logged_in: 'TRUE'

changebank.account:
  path: '/account'
  defaults:
    _title: 'Your Balance'
    _controller: '\Drupal\changebank\Controller\ChangebankController::accountBalance'
  requirements:
    _user_is_logged_in: 'TRUE'
```

#### Customizing User Email Block

We want to display the current user's email address in a block and we're going to use the User Email Block to do so. Select the `UserEmailBlock.php` file located at /web/modules/custom/changebank/src/Plugin/Block/ and make the following changes:

```php
<?php

namespace Drupal\changebank\Plugin\Block;

use Drupal\Core\Block\BlockBase;
use Drupal\Core\Session\AccountInterface;
use Drupal\Core\Plugin\ContainerFactoryPluginInterface;
use Symfony\Component\DependencyInjection\ContainerInterface;

/**
 * Provides a block that displays the current user's email address.
 *
 * @Block(
 *   id = "user_email_block",
 *   admin_label = @Translation("User Email Block")
 * )
 */
class UserEmailBlock extends BlockBase implements ContainerFactoryPluginInterface {

  /**
   * The current user.
   *
   * @var \Drupal\Core\Session\AccountInterface
   */
  protected $currentUser;

  /**
   * Constructs a new UserEmailBlock object.
   *
   * @param array $configuration
   *   The block configuration.
   * @param string $plugin_id
   *   The block plugin ID.
   * @param mixed $plugin_definition
   *   The block plugin definition.
   * @param \Drupal\Core\Session\AccountInterface $current_user
   *   The current user.
   */
  public function __construct(array $configuration, $plugin_id, $plugin_definition, AccountInterface $current_user) {
    parent::__construct($configuration, $plugin_id, $plugin_definition);
    $this->currentUser = $current_user;
  }

  /**
   * {@inheritdoc}
   */
  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {
    return new static(
      $configuration,
      $plugin_id,
      $plugin_definition,
      $container->get('current_user')
    );
  }

  /**
   * {@inheritdoc}
   */
  public function build() {
    $email = $this->currentUser->getEmail();
    return [
      '#markup' => $this->t('@email', ['@email' => $email]),
    ];
  }

}
```

#### Customizing User Login Logout Block

We're going to create a block that will display a login button for anonymous users and a logout button for authenticated users. Select the `UserLoginLogoutBlock.php` file located at /web/modules/custom/changebank/src/Plugin/Block/ and make the following changes:

```php
<?php

namespace Drupal\changebank\Plugin\Block;

use Drupal\Core\Block\BlockBase;
use Drupal\Core\Session\AccountInterface;
use Drupal\Core\Plugin\ContainerFactoryPluginInterface;
use Symfony\Component\DependencyInjection\ContainerInterface;

/**
 * Provides a block that displays linked text for anonymous users.
 *
 * @Block(
 *   id = "user_login_logout_block",
 *   admin_label = @Translation("User Login Logout Block")
 * )
 */
class UserLoginLogoutBlock extends BlockBase implements ContainerFactoryPluginInterface {

  /**
   * The current user.
   *
   * @var \Drupal\Core\Session\AccountInterface
   */
  protected $currentUser;

  /**
   * Constructs a new UserLoginLogoutBlock object.
   *
   * @param array $configuration
   *   The block configuration.
   * @param string $plugin_id
   *   The block plugin ID.
   * @param mixed $plugin_definition
   *   The block plugin definition.
   * @param \Drupal\Core\Session\AccountInterface $current_user
   *   The current user.
   */
  public function __construct(array $configuration, $plugin_id, $plugin_definition, AccountInterface $current_user) {
    parent::__construct($configuration, $plugin_id, $plugin_definition);
    $this->currentUser = $current_user;
  }

  /**
   * {@inheritdoc}
   */
  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {
    return new static(
      $configuration,
      $plugin_id,
      $plugin_definition,
      $container->get('current_user')
    );
  }

  /**
   * {@inheritdoc}
   */
  public function build() {
    $roles = $this->currentUser->getRoles();
    if (in_array('anonymous', $roles)) {
      return [
        '#markup' => $this->t('<button class="btn btn-primary"><a href="/user/login">Log in</a></button>'),
      ];
    }
    else {
        return [
            '#markup' => $this->t('<button class="btn btn-primary"><a href="/user/logout">Logout</a></button>'),
        ];
    }
  }

}
```

#### Customizing the .Module File

In order to make the blocks available to the application, we need to make some changes to the `changebank.module` file located at /web/modules/custom/changebank/ and add the following:

```php
<?php

/**
 * @file
 * Primary module hooks for changebank module.
 */

/**
 * Implements hook_block_info().
 */
function changebank_block_info() {
    $blocks = [];

    $blocks['user_email_block'] = [
      'info' => t('User Email Block'),
      'cache' => DRUPAL_CACHE_PER_ROLE,
    ];

    $blocks['user_login_logout_block'] = [
      'info' => t('User Login Logout Block'),
      'cache' => DRUPAL_CACHE_PER_ROLE,
    ];

    return $blocks;
}
```

### Add Styling

#### Download Theme

At this point we have a working application that can make change from whole dollars.

But... it's not very pretty.

We're going to grab a theme called Barrio Bootstrap 5 which will give us a nice starting point for styling the application.

Run the following command to download the theme:

```bash
composer require 'drupal/bootstrap_barrio:^5.5'
```

#### Enable Theme

Now, we're going to enable the theme.

Select the `Appearance` link in the administration menu and click on the `Install` button for both Bootstrap Barrio 5.5.14 and Bootstrap Barrio Subtheme 5.5.14.

Click on the `Set as default` button for Bootstrap Barrio Subtheme 5.5.14.

While we are here, let's add the Changebank logo to our application.

Click on `Settings` on Bootstrap Barrio Subtheme 5.5.14, scroll down and click on `Logo image`.

Uncheck the `Use the logo supplied by the theme` checkbox and upload the Changebank logo from https://github.com/SergioMSH/fusionauth-quickstart-php-drupal-web/blob/main/complete-application/web/sites/default/files/changebank-logo.png.

#### Add Templates

In the subtheme directory of our application, we're going to add a couple of templates that will override the default templates provided by the Bootstrap Barrio theme. This will allow us to customize the markup of the application.

Navigate to /web/themes/custom/subtheme/templates/. If the templates directory is not there then you may hae to create it.

Inside the templates directory we are going to create the following files:

- `page--front.html.twig`
- `block--system-branding-block.html.twig`
- `region--secondary-menu.html.twig`

Inside the page template for the front page, denoted by the `page--front.html.twig` filename, add the following:

```twig
{% extends "@bootstrap_barrio/layout/page.html.twig" %}

{#
/**
 * @file
 * Bootstrap Barrio's theme implementation to display a single page.
 *
 * The doctype, html, head and body tags are not in this template. Instead they
 * can be found in the html.html.twig template normally located in the
 * core/modules/system directory.
 *
 * Available variables:
 *
 * General utility variables:
 * - base_path: The base URL path of the Drupal installation. Will usually be
 *   "/" unless you have installed Drupal in a sub-directory.
 * - is_front: A flag indicating if the current page is the front page.
 * - logged_in: A flag indicating if the user is registered and signed in.
 * - is_admin: A flag indicating if the user has permission to access
 *   administration pages.
 *
 * Site identity:
 * - front_page: The URL of the front page. Use this instead of base_path when
 *   linking to the front page. This includes the language domain or prefix.
 * - logo: The url of the logo image, as defined in theme settings.
 * - site_name: The name of the site. This is empty when displaying the site
 *   name has been disabled in the theme settings.
 * - site_slogan: The slogan of the site. This is empty when displaying the site
 *   slogan has been disabled in theme settings.

 * Page content (in order of occurrence in the default page.html.twig):
 * - node: Fully loaded node, if there is an automatically-loaded node
 *   associated with the page and the node ID is the second argument in the
 *   page's path (e.g. node/12345 and node/12345/revisions, but not
 *   comment/reply/12345).
 *
 * Regions:
 * - page.top_header: Items for the top header region.
 * - page.top_header_form: Items for the top header form region.
 * - page.header: Items for the header region.
 * - page.header_form: Items for the header form region.
 * - page.highlighted: Items for the highlighted region.
 * - page.primary_menu: Items for the primary menu region.
 * - page.secondary_menu: Items for the secondary menu region.
 * - page.featured_top: Items for the featured top region.
 * - page.content: The main content of the current page.
 * - page.sidebar_first: Items for the first sidebar.
 * - page.sidebar_second: Items for the second sidebar.
 * - page.featured_bottom_first: Items for the first featured bottom region.
 * - page.featured_bottom_second: Items for the second featured bottom region.
 * - page.featured_bottom_third: Items for the third featured bottom region.
 * - page.footer_first: Items for the first footer column.
 * - page.footer_second: Items for the second footer column.
 * - page.footer_third: Items for the third footer column.
 * - page.footer_fourth: Items for the fourth footer column.
 * - page.footer_fifth: Items for the fifth footer column.
 * - page.breadcrumb: Items for the breadcrumb region.
 *
 * Theme variables:
 * - navbar_top_attributes: Items for the header region.
 * - navbar_attributes: Items for the header region.
 * - content_attributes: Items for the header region.
 * - sidebar_first_attributes: Items for the highlighted region.
 * - sidebar_second_attributes: Items for the primary menu region.
 *
 * @see template_preprocess_page()
 * @see bootstrap_barrio_preprocess_page()
 * @see html.html.twig
 */
#}
{# see https://www.drupal.org/project/drupal/issues/953034#comment-14192130 #}
{% set sidebar_first_exists = page.sidebar_first|render|striptags('<img><video><audio><drupal-render-placeholder>')|trim is not empty %}
{% set sidebar_second_exists = page.sidebar_second|render|striptags('<img><video><audio><drupal-render-placeholder>')|trim is not empty %}

{% block head %}
        {% if page.secondary_menu or page.top_header or page.top_header_form %}
          <nav{{ navbar_top_attributes }}>
          {% if container_navbar %}
          <div class="container">
          {% endif %}
              {{ page.secondary_menu }}
              {{ page.top_header }}
              {% if page.top_header_form %}
                <div class="form-inline navbar-form float-right">
                  {{ page.top_header_form }}
                </div>
              {% endif %}
          {% if container_navbar %}
          </div>
          {% endif %}
          </nav>
        {% endif %}
        <nav{{ navbar_attributes }}>
          {% if container_navbar %}
          <div class="container">
          {% endif %}
            {{ page.header }}
            {% if page.primary_menu or page.header_form %}
              <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#CollapsingNavbar" aria-controls="CollapsingNavbar" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
              <div class="collapse navbar-collapse" id="CollapsingNavbar">
                {{ page.primary_menu }}
                {% if page.header_form %}
                  <div class="form-inline navbar-form float-right">
                    {{ page.header_form }}
                  </div>
                {% endif %}
	          </div>
            {% endif %}
            {% if sidebar_collapse %}
              <button class="navbar-toggler navbar-toggler-left collapsed" type="button" data-toggle="collapse" data-target="#CollapsingLeft" aria-controls="CollapsingLeft" aria-expanded="false" aria-label="Toggle navigation"></button>
            {% endif %}
          {% if container_navbar %}
          </div>
          {% endif %}
        </nav>
{% endblock %}

{% block content %}
        <div id="main" class="container-fluid">
          {{ page.breadcrumb }}
          <div class="row row-offcanvas row-offcanvas-left clearfix">
              <main{{ content_attributes }}>
                <section class="section">
                  <a href="#main-content" id="main-content" tabindex="-1"></a>
                  <div class="row">
                    <div class="col col-sm-3 welcome">
                      <div class="sidebar" style="text-align: center;">
                        <h1 style="color: #096324; font-weight: 700;">Welcome to Changebank</h1>
                        <p><strong>To get started, <a href="/user/login" style="color: #096324;">log in</a> or<br/> <a href="/user/login" style="color: #096324;">create a new account</a>.</strong></p>
                      </div>
                    </div>
                    <div class="col col-sm-9" style="height: calc(100vh - 148px); overflow: hidden;">
                      <img src="/sites/default/files/money-new.jpg" alt="Image" width="100%" height="auto">
                    </div>
                  </div>
                  {# {{ page.content }} #}
                </section>
              </main>
            {% if sidebar_first_exists %}
              <div{{ sidebar_first_attributes }}>
                <aside class="section" role="complementary">
                  {{ page.sidebar_first }}
                </aside>
              </div>
            {% endif %}
            {% if sidebar_second_exists %}
              <div{{ sidebar_second_attributes }}>
                <aside class="section" role="complementary">
                  {{ page.sidebar_second }}
                </aside>
              </div>
            {% endif %}
          </div>
        </div>
{% endblock %}
```

Next, we're going to add markup to create a custom layout for our site logo, the user email block, and the user login logout block.

Add the following to the `region--secondary-menu.html.twig` template:

```twig
{#
/**
 * @file
 * Theme override to display a region.
 *
 * Available variables:
 * - content: The content for this region, typically blocks.
 * - attributes: HTML attributes for the region div.
 * - region: The name of the region variable as defined in the theme's
 *   .info.yml file.
 *
 * @see template_preprocess_region()
 */
#}
{%
  set classes = [
    'region',
    'region-' ~ region|clean_class,
  ]
%}
{% if content %}
  <section{{ attributes.addClass(classes) }}>
    <div class="row">
      <div class="col col-xs-9">
        {{ drupal_block('system_branding_block') }}
      </div>
      <div class="col col-xs-3 d-flex justify-content-end login-container">
        <div class="email-container">
          {{ drupal_block('user_email_block') }}
        </div>
        <div class="button-container">
          {{ drupal_block('user_login_logout_block') }}
        </div>
      </div>
    </div>
    {# {{ content }} #}
  </section>
{% endif %}
```

If the user email and the user login logout blocks are not displaying, or appear broken, make sure that the `Twig Tweak` module is enabled as that provides the naming convention to embed the blocks in the above template.

Finally, since we added the System Branding Block to the secondary menu region template, we need to manually hide the site name.

Add the following to the `block--system-branding-block.html.twig` template:

```twig
{#
/**
 * @file
 * Bootstrap Barrio's theme implementation for a branding block.
 *
 * Each branding element variable (logo, name, slogan) is only available if
 * enabled in the block configuration.
 *
 * Available variables:
 * - site_logo: Logo for site as defined in Appearance or theme settings.
 * - site_name: Name for site as defined in Site information settings.
 * - site_slogan: Slogan for site as defined in Site information settings.
 */
#}
{% set attributes = attributes.addClass('site-branding') %}
  {% if site_logo or site_name %}
    <a href="{{ path('<front>') }}" title="{{ 'Home'|t }}" rel="home" class="navbar-brand">
      {% if site_logo %}
        <img src="{{ site_logo }}" alt="{{ 'Home'|t }}" class="img-fluid d-inline-block align-top" />
      {% endif %}
      {# {{ site_name }} #}
    </a>
  {% endif %}
  {% if site_slogan %}
    <div class="d-inline-block align-top site-name-slogan">
      {{ site_slogan }}
    </div>
  {% endif %}
```
In the above we simply hid the {{ site_name }} variable by commenting it out, but you can delete it if you want.

#### Customizing the Stylesheet

Next, we're going to add some styling to the application to make it look a little nicer. Select the `styles.css` file located at /web/themes/custom/changebank/css/ and add the following:

```css
#navbar-top {
    background-color: #fff!important;
}

#navbar-main {
    background-color: #096324!important;
}

.sidebar h2 {
    margin: 0 0 0.5em;
    padding-bottom: 5px;
    text-shadow: 0 1px 0 #fff;
    font-size: 2.071em;
}

.sidebar .block {
    border-style: solid;
    border-width: 1px;
    padding: 15px 15px;
    margin: 0 0 20px;
    background-color: #fff!important;
    border-color: #fff!important;
}

.main-content.col {
    padding-right: 0px;
}

.welcome {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 320px;
}

body {
    overflow-x: hidden;
}

.site-footer {
    display: none;
}

#main-wrapper {
    height: calc(100vh - 148px);
}

.navbar {
    display: block;
}

.email-container {
    display: inline-block;
    vertical-align: middle;
    margin-right: 20px;
}

.button-container {
    display: inline-block;
    vertical-align: middle;
}

.login-container {
    align-items: center;
}

button,
.btn,
.btn-primary {
    background-color: #096324!important;
}

button a {
    color: #fff;
    font-weight: 700;
    text-decoration: none;
    padding-left: 30px;
    padding-right: 30px;
}

button a:hover {
    color: #fff;
    text-decoration: underline;
}

.block-user-email-block {
    color: #096324;
    font-weight: 400;
}

.navbar-brand img {
    padding: 5px 0px 5px 10px;
    height: 70px;
}

#block-bootstrap-barrio-subtheme-page-title {
    margin-top: 70px;
}

h1, h2, h3, h4, h5, h6 {
    color: #096324;
}

.nav-link {
    font-weight: 500;
    font-size: 20px;
}

.nav-item .active {
    text-decoration: underline;
}

.nav {
    margin-right: 7px;
}

.account-balance {
    font-size: 32px;
    font-weight: 700;
}
```

### Add Menu

Since we created the routes for the form and account page, we're going to add a menu to the application to make it easier to navigate between the two pages.

Hover over `Structure` > `Menus` in the administration menu and click on `Add menu`.

Enter `Changebank Menu` for the `Title` and click on `Save`.

#### Add Menu Links

Hover over `Structure` > `Menus` in the administration menu and click on `Changebank Menu`.

Click on `Add link` and enter the following:

- `Menu link title`: Account
- `Link`: /account

Click on `Save`.

Click on `Add link` again and enter the following:

- `Menu link title`: Make Change
- `Link`: /makechange

Click on `Save`.

### Enable Blocks

Now that we have the User Email, User Login Logout, and the Changebank Menu Blocks, we need to enable them.

Hover over `Structure` in the administration menu and click on `Block layout`.

#### Enable Changebank Menu Block

Scroll down to the `Primary Menu` region and click on `Place block`. Type `Changebank Menu` in the filter field and click on `Place block` to place the block into the region.

Uncheck the `Display title` checkbox since we don't want the title to be displayed.

Click on the `Roles` tab under Visibility and select the `Authenticated user` role.

Click on `Save block`.

<Aside type="note">
Although we set the access restriction to the account and makechange routes to authenticated (logged in) users in our custom module, we also want to make sure that the menu itself is only visible to authenticated users as well.
</Aside>

#### Enable User Email Block

Similar to the Changebank Menu Block, we're going to scroll down to the `Secondary Menu` region and click on `Place block`.

Type `User Email Block` in the filter field and click on `Place block` to place the block into the region.

Uncheck the `Display title` checkbox and click on the `Roles` tab under Visibility and select the `Authenticated user` role.

Click on `Save block`.

#### Enable User Login Logout Block

As with the User Email Block, we're going to scroll down to the `Secondary Menu` region and click on `Place block`.

Type `User Login Logout Block` in the filter field and click on `Place block` to place the block into the region.

Uncheck the `Display title` checkbox.

Since we are controlling the visibility of login and logout links in our custom module, we're going to leave the `Roles` tab under Visibility as `Any role`.

Click on `Save block`.

#### Default Blocks

By default, Drupal will have a `Site branding` block, a `Main navigation` block, and a `User account` block.

We're going to remove the `User account` block since we already have custom login/logout links. Click on the dropdown arrow next to the User account block and click on the `Remove` option.

We're not using the `Main navigation` for authenticated users so we're going to set that to only be visible to anonymous users. Click on the `Configure` link next to the Main navigation block and click on the `Roles` tab under Visibility and select the `Anonymous user` role. Click on `Save block` when you are done.

We want to move the `Site branding` block to the `Secondary Menu` region. You can achieve this by simple dragging and dropping the block into the region. Make sure to position it above the other two blocks and scroll down and click on `Save blocks`.

Finally, we only want to display the logo, so configure the `Site branding` block and uncheck the `Display site name` and `Display site slogan` checkboxes. Click on `Save block`.

## Next Steps
This quickstart is a great way to get a proof of concept up and running quickly, but to run your application in production, there are some things you're going to want to do.

### FusionAuth Customization
FusionAuth gives you the ability to customize just about everything with the user's experience and your application's integration. This includes
* [Hosted pages](/docs/v1/tech/themes/) such as login, registration, email verification, and many more
* [Email templates](/docs/v1/tech/email-templates/email-templates)
* [User data and custom claims in access token JWTs](/articles/tokens/jwt-components-explained)

### Drupal Customization
Drupal is a very powerful CMS and there are many ways to customize it. Here are a few things you may want to do:
* Increase the functionality of the make change form, such as adding a field for the amount of change to make or specifying the type of change to make (quarters, dimes, nickels, pennies)
* Add additional functionality to the application, such as a way to deposit and withdraw money from the account and keep track of all transactions on the account page.
* Customize the FusionAuth login button.

## Troubleshooting

* I get `This site can’t be reached  localhost refused to connect.` when I click the Login button

Ensure FusionAuth is running in the Docker container.  You should be able to login as the admin user, <code><RemoteValue url="https://raw.githubusercontent.com/FusionAuth/fusionauth-quickstart-php-drupal-web/main/kickstart/kickstart.json" selector="$.variables.adminEmail" /></code> with a password of <code><RemoteValue url="https://raw.githubusercontent.com/FusionAuth/fusionauth-php-quickstart-drupal-web/main/kickstart/kickstart.json" selector="$.variables.adminPassword" /></code> at [http://localhost:9011/admin](http://localhost:9011/admin).

* I get an error page when I click on the Login button with message of `"error_reason" : "invalid_client_id"`

Ensure the value for `config.x.fusionauth.client_id` in the file `config/environments/development.rb` matches client Id configured in FusionAuth for the Example App Application at [http://localhost:9011/admin/application/](http://localhost:9011/admin/application/).