---
layout: doc
title: Integrate Your Ruby on Rails API With FusionAuth
description: Integrate your Ruby on Rails API with FusionAuth
navcategory: getting-started
prerequisites: Ruby, bundler and Rails
technology: Ruby on Rails
language: Ruby
---

## Integrate Your {{page.technology}} API With FusionAuth

{% include docs/integration/_intro-api.md %}

## Prerequisites

{% include docs/integration/_prerequisites.md %}

## Download and Install FusionAuth

{% include docs/integration/_install-fusionauth.md %}

## Create a User and an API Key

{% include docs/integration/_add-user.md %}

## Configure FusionAuth

Next, you need to set up FusionAuth. This can be done in different ways, but weâ€™re going to use the [{{page.language}} client library](/docs/v1/tech/client-libraries/ruby). You can use the client library with an IDE of your preference as well.

First, make a directory:

```shell
mkdir setup-fusionauth && cd setup-fusionauth
```

Then, create the required files:

```shell
touch Gemfile
```

Now, copy and paste the following file into `Gemfile`.

```ruby
{% remote_include https://raw.githubusercontent.com/FusionAuth/fusionauth-example-client-libraries/main/ruby/Gemfile %}
```

Install the gems.

```shell
bundle install
```

Create a file called `setup.rb`. Then copy and paste the following code into it.

```ruby
{% remote_include https://raw.githubusercontent.com/FusionAuth/fusionauth-example-client-libraries/main/ruby/setup-api.rb %}
```

Then, you can run the setup script.

{% include _callout-note.liquid content="The setup script is designed to run on a newly installed FusionAuth instance with only one user and no tenants other than `Default`. To follow this guide on a FusionAuth instance that does not meet these criteria, you may need to modify the above script. <br><br> Refer to the [Ruby client library](/docs/v1/tech/client-libraries/ruby) documentation for more information." %}

This will create the FusionAuth configuration for your {{page.technology}} API.

```shell
fusionauth_api_key=YOUR_API_KEY_FROM_ABOVE ruby setup.rb
```

If you are using PowerShell, you will need to set the environment variable in a separate command before executing the script.

```shell
$env:fusionauth_api_key='YOUR_API_KEY_FROM_ABOVE'
ruby setup.rb
```

If you want, you can http://localhost:9011[login to your instance] and examine the new API configuration the script created for you. You'd navigate to the <span class="breadcrumb">Applications</span> tab to do so.

## Create Your {{page.technology}} API

Now you are going to create a {{page.technology}} API. While this section builds a simple {{page.technology}} API, you can use the same configuration to build a more complex {{page.technology}} API.

First, create the skeleton of the {{page.technology}} API. Rails has a nice generator to build this out.

```shell
rails new myapi --api && cd myapi
```

Now, update your `Gemfile` to look like this:

```text
{% remote_include https://raw.githubusercontent.com/FusionAuth/fusionauth-example-rails-api-guide/main/Gemfile %}
```

You may need to modify the version of ruby specified in the Gemfile. As long as Rails 7 is supported, you will be fine.

Then, install these new gems.

```shell
bundle install
```

Next, create a file called `.env.development` and insert the following into it.

```ini
{% remote_include https://raw.githubusercontent.com/FusionAuth/fusionauth-example-rails-api-guide/main/.env.development %}
```

You can now start writing the code for your Rails API. First, let's create a controller which gives back a JSON message. Create a new file called `app/controllers/messages_controller.rb`, then add the following code:

```ruby
{% remote_include https://raw.githubusercontent.com/FusionAuth/fusionauth-example-rails-api-guide/main/app/controllers/messages_controller.rb %}
```

This controller returns a JSON array with messages.

Next, update the `config/routes.rb` file to look like this:

```ruby
{% remote_include https://raw.githubusercontent.com/FusionAuth/fusionauth-example-rails-api-guide/main/config/routes.rb %}
```

This tells {{page.technology}} to return the content generated by the `messages_controller.rb` file when the `/messages` path is set up.

You can now start up your server. You should do it in a new terminal window so that you can continue to edit the {{page.technology}} code.

```shell
bundle e rails s -p 4001
```

And visit [http://localhost:4001/messages](http://localhost:4001/messages) and view the JSON.

Next, let's configure the token protection for this API. Go back to your previous terminal window and create a `config/initializers/jwt_rack.rb` file, and update it to look like this:

```ruby
{% remote_include https://raw.githubusercontent.com/FusionAuth/fusionauth-example-rails-api-guide/main/config/initializers/jwt_rack.rb %}
```

This tells {{page.technology}} to check for various attributes of the token, including the `iss` and the `aud`. Read the [`rack_jwt` gem documentation](https://github.com/FusionAuth/rack-jwt/) for more.

You can also access the JWT in the controller. Below, the messages controller adds a special message if the user has a certain role.

```ruby
{% remote_include https://raw.githubusercontent.com/FusionAuth/fusionauth-example-rails-api-guide/main/app/controllers/messages_controller.rb %}
```

Now, back to the terminal where your server is running. Stop it (using `control-C`) and restart it.

```shell
bundle e rails s -p 4001
```

Visit [http://localhost:4001/messages](http://localhost:4001/messages), you'll get an error:

```json
{"error":"Missing token cookie and Authorization header"}
```

Your API is protected. Now, let's get an access token so authorized clients can get the API results.

## Testing the API Flow

There are a number of ways to get an access token, as mentioned, but for clarity, let's use the login API to mimic a client. 

Run this command in a terminal:

```shell
curl -H 'Authorization: YOUR_API_KEY_FROM_ABOVE' \
     -H 'Content-type: application/json' \
     -d '{"loginId": "YOUR_EMAIL", "password":"YOUR_PASSWORD","applicationId": "e9fdb985-9173-4e01-9d73-ac2d60d1dc8e"} \
    http://localhost:9011/api/login 
```

Replace `YOUR_EMAIL` and `YOUR_PASSWORD` with the username and password you set up previously.

This request will return something like this:

```json
{% remote_include https://raw.githubusercontent.com/FusionAuth/fusionauth-site/master/site/docs/src/json/users/login-response.json %}
```

Grab the `token` field (which begins with `ey`). Replace YOUR_TOKEN below with that value, and run this command:

```shell
curl --cookie 'app.at=YOUR_TOKEN' http://localhost:4001/messages
```

Here you are placing the token in a cookie named `app.at`. This is for compatibility with the FusionAuth best practices and [the hosted backend](/docs/v1/tech/apis/hosted-backend).

If you want to store it in a different cookie or send it in the header, make sure you modify the `rack_jwt` initializer and restart the {{page.technology}} API.

This will result in the JSON below.

```json
{"messages":["Hello"]}
```


