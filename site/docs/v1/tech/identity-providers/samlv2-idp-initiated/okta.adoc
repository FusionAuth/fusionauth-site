---
layout: doc
title: SAML v2 IdP Initiated With Okta
description: Configure SAML v2 IdP Initiated SSO With Okta
navcategory: login-methods
---

include::docs/v1/tech/shared/_premium-edition-blurb.adoc[]

== Configure SAML v2 IdP Initiated SSO With Okta

This page will guide you in configuring a SAMLv2 IdP Initiated Identity Provider with Okta as the initiating IdP. You will be able to visit an Okta provided link, authenticate, and then be logged in to FusionAuth.

This document assumes you have an admin account with Okta and a valid FusionAuth paid edition license.

* <<Configure SAML v2 IdP Initiated SSO With Okta>>
* <<Create and Partially Configure the Okta SSO Application>>
* <<Add the Okta Public Certificate to FusionAuth>>
* <<Add the SAMLv2 IdP Initiated Identity Provider>>
* <<View the Identity Provider in FusionAuth>>
* <<CORS Settings>>
* <<Configure the FusionAuth Application Redirect URL>>
* <<Complete SSO Configuration in Okta>>
* <<Test It Out>>

== Create and Partially Configure the Okta SSO Application

[NOTE]
====
You will want to set up this application as an admin. Okta allows users with various permissions. Later, create a user that can log into our newly created application, `Pied Piper`.
====

Navigate to the Okta admin screen. Using the left "hamburger" menu, click on `Applications Header > Applications`. From here, click `Create App Integration`. Select the SAML option and hit next.

image::identity-providers/idp-initiated/okta-add-saml-service-provider-initial-screen.png[Setting up a SAMLv2 application in Okta,width=1200]

Add an [field]#App name# describing the application. Configure any other "General Settings" as needed (including adding your award winning logo).

image::identity-providers/idp-initiated/okta-general-settings.png[General settings tab when creating a SAMLv2 application in Okta,width=1200,role=bottom-cropped]

Click "Next". You will arrive at the "Configure SAML" section.

image::identity-providers/idp-initiated/configure-saml.png[Settings tab when creating a SAMLv2 application in Okta,width=1200]

Please complete the [field]#Single sign on URL# and [field]#Audience URI (SP Entity ID)# with placeholder data. We will return to these fields in a moment (with real data from FusionAuth). Click next to proceed.

The final screen is related to marketing/support. This screen may or may not be present. Click the Finish button.

image::identity-providers/idp-initiated/feedback-marketing-step.png[Feedback Marketing Step,width=1200]

Now, under the Sign On tab, scroll down until you see a button called "View SAML setup instructions".  This will open a new window/tab. You will need the values displayed to complete the rest of this tutorial.

image::identity-providers/idp-initiated/view-saml-setup-instructions[View SAML Setup Instructions,width=1200]

Record the [field]#Identity Provider Single Sign-On URL# and [field]#Identity Provider Issuer# values. The latter is a string such as `http://www.okta.com/exkq14ymac31Bx7895d6`.

Download the "Identity Provider Certificate" too, then close the instructions tab.

image::identity-providers/idp-initiated/detail-saml-setup-instructions[Details around certificate and SSO URL and issuer,width=1200]

== Add the Okta Public Certificate to FusionAuth

Log in to the FusionAuth administrative user interface and navigate to [breadcrumb]#Settings -> Key Master#.

Import the Okta provided certificate you just downloaded.

image::identity-providers/idp-initiated/add-okta-public-certificate-to-keymaster.png[Adding the Okta certificate to Key Master,width=1200]

== Add the SAMLv2 IdP Initiated Identity Provider

Navigate to [breadcrumb]#Settings -> Identity Providers#. Add a SAMLv2 IdP Initiated Provider.

* Configure the [field]#Name# with a descriptive value.
* Set the [field]#Issuer# value to the [field]#Identity Provider Issuer# value from Okta.
* Set the [field]#Verification key# to the public certificate you just imported.

Enable this Identity Provider for any FusionAuth applications. For this example, `Pied Piper` allows the use of this Identity Provider.

Any users who authenticate with Okta will be registered for this application because of the [field]#Create registrations# setting.

All other options may be left with default values. Save the configuration.

image::identity-providers/idp-initiated/fusionauth-add-okta-identity-provider.png[Adding the IdP Initiated SSO Identity Provider,width=1200]

== View the Identity Provider in FusionAuth

View the created Identity Provider and navigate to the [field]#SAML v2 Integration details# section.

Record the values of the [field]#Callback URL (ACS)# and [field]#Issuer# fields. Those will be used later.

image::identity-providers/idp-initiated/fusionauth-view-identity-provider.png[View the IdP Initiated SSO Identity Provider,width=1200]

== CORS Settings

Navigate to [breadcrumb]#Settings -> System -> CORS#.

Determine the hostname and scheme of the Okta Identity Provider Single Sign-On URL. If the URL is `https://trial-6089629.okta.com/app/trial-6089629_test_1/exk1mn2r8kVgtAv6q697/sso/saml` then the hostname and scheme are `https://example.okta.com`. Additionally, you might have to add another entry with a trailing backslash `https://example.okta.com/`.

[NOTE]
====
If you run into CORS configuration challenges, the best solution is to review the `System > Event Log`. This will tell you exactly what hostname and schemes require a whitelist.
====

Add this value to the CORS [field]#Allowed origins# field. Ensure that the `POST` method is checked in the [field]#Allowed methods# field. Save the configuration

image::identity-providers/idp-initiated/fusionauth-cors-settings.png[Configure CORS,width=1200]

== Configure the FusionAuth Application Redirect URL

Navigate to [breadcrumb]#Applications -> Your Application -> OAuth#. Update the [field]#Authorized redirect URLs# field to include `https://local.fusionauth.io/?client_id=CLIENTID` where CLIENTID is the value from the [field]#Client id# field.

[NOTE]
====
This URL is where a user will end up after authentication and may be any value URL.
====

Ensure the Authorization Code grant is enabled.

image::identity-providers/idp-initiated/fusionauth-set-up-application.png[Configure the FusionAuth Pied Piper application,width=1200]

== Complete SSO Configuration in Okta

Return to the Configure SAML Tab.  This can be found by navigating as follows from the App homepage: [breadcrumb]#General > SAML Settings > Edit Button > General Settings > Next Button > Configure SAML# tab in the Okta Admin screen.

* Set the value of the [field]#Assertion Consumer Service URL# to the value of the [field]#Callback URL (ACS)# from the FusionAuth Identity Provider recorded above.
* Set the value of the [field]#Service Provider Entity Id# to the value of the [field]#Issuer# recorded above.
* Set the [field]#Application username format# to be `Email`.

image::identity-providers/idp-initiated/okta-sign-on-advanced-settings.png[Configure Okta with the FusionAuth SP information,width=1200]

Save the Okta application by clicking "Next" until complete.

Navigate to the [breadcrumb]#General# tab and scroll to the [breadcrumb]#App Embed Link# section and note the [field]#Embed Link# value. This is the link a user needs to visit to begin the IdP initiated SSO, so you could place it in your application's navigation, launchpad, or elsewhere.

Finally, click on the [breadcrumb]#Assignments# tab and assign the user to the application.

image::identity-providers/idp-initiated/okta-assign-application-to-user-step-one.png[Pick a user to assign to application step one,width=1200]

image::identity-providers/idp-initiated/okta-assign-application-to-user.png[Assigning a user to the SAML SP application step two,width=1200]

== Test It Out

Open an incognito browser window and visit the [field]#Embed Link# value. This value can be found at the bottom of the General tab of your Okta Application. Log in with your Okta IdP credentials.

image::identity-providers/idp-initiated/okta-login-page.png[Logging in with Okta,width=1200]

When you authenticate successfully, you will eventually land at the URL configured in the application's [field]#Authorized redirect URLs# field. The full URL contains an authorization code.

Since you configured registration for this Identity Provider, if the user did not previously exist in your FusionAuth instance, they will now have an account.

For a production application, the authorization code would be exchanged by your application for a JWT from FusionAuth.

