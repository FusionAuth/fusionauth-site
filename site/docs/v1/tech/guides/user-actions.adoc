---
layout: doc
title: User Actions
description: Using user actions
navcategory: developer
---

== Overview

User Actions in FusionAuth are powerful events you can use to interact with, reward, and discipline users.

Highly customizable events that invoke an action on a user, User Actions can be created and executed using API calls and are sent to external applications using the FusionAuth Webhooks.

You can define User Actions to [coordinate events around a customer purchase](https://fusionauth.io/blog/2023/04/20/using-user-actions), for example, or permanently or temporarily disable access to a user following an infringement or when their account is due for review.

A User Action is a tenant scoped event that can be sent to all tenants or to one or more specified tenants. 

- Types of User Actions
- Creating an API key
- Creating a User Action via the API
- Setting up a Webhook
- Executing a User Action

== Types of User Actions

You can view a User Action's attributes by navigating to [breadcrumb]#Settings -> User Actions#. 

A User Action is defined by its [field]#Name#, how it communicates with its associated link:https://www.redhat.com/en/topics/automation/what-is-a-webhook[webhooks], its temporality, and its notification policy. 

If the User Action is [uielement]#Time-based#, it can also be set to [uielement]#Prevent login# of its associated user and the [uielement]#Send end event# switch can be set to notify webhooks if the action expires or is manually cancelled.

image::tutorials/user-actions/user-actions-edit-top-panel.png[Configuration setup fields for creating a User Action, width=1200px, role=bottom-cropped]

You can configure [uielement]#Email# settings for when an action starts, is modified, is cancelled, or ends. Toggle the [field]#Email user# field to select whether the user should receive an email notification, and [uielement]#Send to Webhook# to select whether FusionAuth will include the email information in the JSON that is sent to the webhook. You can also specify the link:https://fusionauth.io/docs/v1/tech/email-templates/email-templates#overview[email templates] that should be used.

image::tutorials/user-actions/user-actions-edit-email.png[Setting up email configuration for user action, width=1200px]

If the User Action is not [uielement]#Time-based#, you can define a series of [uielement]#Options# associated with it. Admins can select an option when taking an action and they will be included in the Webhook event and available to the email template. You can also localize the options and the localized version will be included in both places as well.

image::tutorials/user-actions/user-actions-edit-options.png[Defining an option and adding a localization to it, width=1200px, role=bottom-cropped]

You can also add [uielement]#Localization# for the name of the User Action itself.

image::tutorials/user-actions/user-actions-edit-localization.png[Adding a localization to the name of the User Action, width=1200px, role=bottom-cropped]

You can refer to our [User Action event guide](https://fusionauth.io/docs/v1/tech/apis/actioning-users) for a full description of User Action event parameters.

== Creating an API key

You can create and execute a User Action with API calls. To set up an API Key, navigate to [breadcrumb]#Settings -> API Keys# and click the [uielement]#Add# button. Make sure `POST` is enabled for the `/api/user-action` and both `POST` and `GET` are enabled for the `/api/user/action` endpoints. You will use the former to create your User Action and the latter to execute it.

image::tutorials/user-actions/user-actions-create-api-key.png[Creating an API Key in FusionAuth,width=1200px]

Be sure to record the value of your API Key.

image::tutorials/user-actions/user-actions-api-key-created.png[Recording the value of the API Key,width=1200px, role=bottom-cropped]

== Creating a User Action via the API

You can create a link:https://fusionauth.io/docs/v1/tech/apis/user-actions[User Action definition] by sending a `POST` request to the `/api/user-action` route. For example, the following code defines a User Action that sends automatic emails to a user who has purchased a temporary subscription to a news site. 

[source,shell,title="User action creation API call"]
----
curl --location --request POST '<YOUR_FUSIONAUTH_BASE_URL>/api/user-action' \
  --header 'Authorization: <YOUR API KEY>' \
  --header 'Content-Type: application/json' \
  --data-raw '{
  "userAction": {
     "name": "Bought Temporary Access",
     "startEmailTemplateId": "5eaf58e7-2e5a-4eea-94b8-74a707724f7b",
     "endEmailTemplateId": "18490dc2-b3d4-462f-9a8e-882b4fb4e76f",
     "modifyEmailTemplateId": "2011460f-bd11-4134-ba8a-9d4c6c4a23ae",
     "cancelEmailTemplateId": "981a1ecf-4a1d-44b8-8211-3215cb80319f",
     "temporal": true,
     "userEmailingEnabled": true,
     "sendEndEvent": true
   }
  }'
----

Here, `<YOUR_FUSIONAUTH_BASE_URL>` would be the URL of the FusionAuth instance and `<YOUR API KEY>` would be the API key noted earlier. Note that the email template Ids are included in the command. Read more about [setting up email in FusionAuth here](https://fusionauth.io/docs/v1/tech/email-templates/configure-email) and [email templates in FusionAuth here](https://fusionauth.io/docs/v1/tech/email-templates/email-templates).

If you set the [field]#temporal# attribute to `true`, you can set an [field]#expiry# time for an action. This means that the action will automatically be removed from the user after the set expiry time. In this example, the [field]#sendEndEvent# field is set to `true` so that the user is notified via webhook when the access period has expired.

FusionAuth should return something similar to the following:

[source,json,title="Returned JSON after User Action creation API call"]
----
{
  "userAction": {
    "active": true,
    "cancelEmailTemplateId": "981a1ecf-4a1d-44b8-8211-3215cb80319f",
    "endEmailTemplateId": "18490dc2-b3d4-462f-9a8e-882b4fb4e76f",
    "id": "6f4115c0-3db9-4734-aeda-b9c3f7dc4269",
    "includeEmailInEventJSON": false,
    "insertInstant": 1674937446558,
    "lastUpdateInstant": 1674937446558,
    "modifyEmailTemplateId": "2011460f-bd11-4134-ba8a-9d4c6c4a23ae",
    "name": "Bought Temporary Access",
    "options": [],
    "preventLogin": false,
    "sendEndEvent": true,
    "startEmailTemplateId": "5eaf58e7-2e5a-4eea-94b8-74a707724f7b",
    "temporal": true,
    "transactionType": "None",
    "userEmailingEnabled": true,
    "userNotificationsEnabled": false
  }
}
----

Note that the User Action is given an [field]#Id# value here. This is a randomly generated Id. If you prefer to provide a unique Id for your User Action, you can add it to the `POST` request in the path, like this: `/api/user-action/{userActionId}`. Make note of this value to use when you execute the User Action.

Verify that the User Action was created by going to [breadcrumb]#Settings -> User Actions# in the FusionAuth admin portal.

image::tutorials/user-actions/user-actions-user-action-created.png[Viewing the created User Action,width=1200px, role=bottom-cropped]

== Setting up a Webhook

To set up a webhook to use with a User Action, navigate to [breadcrumb]#Settings -> Webhooks# and click the [uielement]#Add# button. You can optionally give the webhook an Id and complete the description field. Add the fully qualified URL of the webhookâ€™s endpoint that will accept the event requests from FusionAuth and set the required timeout durations.

image::tutorials/user-actions/user-actions-add-webhook.png[Adding a new Webhook from your RequestBin.",width=1200px]

Scroll down and make sure that the [uielement]#user.action# event is enabled.

image::tutorials/user-actions/user-actions-webhook-switch.png[Ensuring that the user.action Webhook event switch is enabled,width=1200px]

Next, click on the [breadcrumb]#Tenants# tab and select the tenant the User Action will be associated with or select [uielement]#All tenants#.

image::tutorials/user-actions/user-actions-webhook-tenant.png[Enabling Webhook for Tenant,width=1200px]

Navigate to [breadcrumb]#Tenants#, then [uielement]#Your tenant#, and select the [uielement]#Webhooks# tab. Make sure that the webhook is enabled. If you selected [uielement]#All tenants# on the webhook page, this checkbox will be disabled.

image::tutorials/user-actions/user-actions-tenants-webhooks.png[Viewing the enabled webhooks on the Tenant page,width=1200px]

Scroll down and make sure the [uielement]#user.action# event is enabled here too.

image::tutorials/user-actions/user-actions-tenants-switch.png[Ensuring that the user.action Webhook event switch is enabled,width=1200px]

== Executing the User Action

Now you can link:https://fusionauth.io/docs/v1/tech/apis/actioning-users[apply the action] to a specific user with the `api/user/action` endpoint. 

[source,shell,title="User Action execution command"]
----
curl --location --request POST '<YOUR_FUSIONAUTH_BASE_URL>/api/user/action' \
  --header 'Authorization: <YOUR API KEY>' \
  --header 'Content-Type: application/json' \
  --data-raw '{
  "broadcast": true,
  "action": {
    "actioneeUserId": "12e22430-162c-4f7e-bf40-58f7a69a26ce",
    "actionerUserId": "5ea819ea-6ff1-4b17-943f-eb2d1c246c3b",
    "comment": "Signed up for 24 hour premium access",
    "emailUser": true,
    "expiry": 1674903995472,
    "userActionId": "fbff792c-2340-4d72-b4fd-534f94d0a94b"
  }
 }'
----

The [field]#broadcast# field is optional and specifies whether or not FusionAuth will broadcast the User Action to any registered Webhooks. The default is `false`.

The [field]#actioneeUserId# specifies the unique identifier of the user the action is being performed on. The [field]#actionerUserId# specifies the Id of the User that performed the action. If the action was initiated by FusionAuth, this value will not be provided.

The [field]#expiry# time follows the UNIX epoch format in milliseconds. 

The [field]#userActionId# value is the Id you provided or the randomly generated one you recorded when creating the User Action. 

FusionAuth will reply with `200 OK`:

[source,json,title="Response after executing User Action"]
----
{
  "action": {
    "actioneeUserId": "12e22430-162c-4f7e-bf40-58f7a69a26ce",
    "actionerUserId": "5ea819ea-6ff1-4b17-943f-eb2d1c246c3b",
    "applicationIds": [],
    "comment": "Signed up for 24 hour premium access",
    "emailUserOnEnd": true,
    "expiry": 1674939392664,
    "id": "8ed1f910-4e62-4dd1-a88e-e45964b56e21",
    "insertInstant": 1674938412450,
    "localizedName": "Bought Temporary Access",
    "name": "Bought Temporary Access",
    "notifyUserOnEnd": false,
    "userActionId": "6f4115c0-3db9-4734-aeda-b9c3f7dc4269"
  }
}
----

In this example, when the action is executed, the `actionee` will receive an email thanking them for their subscription.

image::tutorials/user-actions/user-actions-email.png[Email confirmation from User Action event,width=1200px, role=bottom-cropped]

== Querying Action Status on a User

You might want to check to see if there are any User Actions currently actioned on a user. To do this, you can link:https://fusionauth.io/docs/v1/tech/apis/actioning-users#retrieve-a-previously-taken-action[query the actions API] and filter by user and action:

[source,shell,title="Query User Action status command"]
----
curl --location --request GET '<YOUR_FUSIONAUTH_BASE_URL>/api/user/action?userId=<USER_ID>&active=true' \
--header 'Authorization: <YOUR API KEY>'
----

FusionAuth will return an object with an array of all actions currently active on the user. You can filter the results using the `userActionId` value:

[source,json,title="Returned JSON after querying User Action status"]
----
{
  "actions": [
    {
      "actioneeUserId": "12e22430-162c-4f7e-bf40-58f7a69a26ce",
      "actionerUserId": "5ea819ea-6ff1-4b17-943f-eb2d1c246c3b",
      "applicationIds": [
        "af4847c4-d183-4e51-ab8a-ce8940909127"
      ],
      "comment": "Signed up for 24 hour premium access",
      "emailUserOnEnd": true,
      "endEventSent": false,
      "expiry": 1675890993000,
      "id": "30e05e8f-fba6-4dd3-852c-abbc2d2e2461",
      "insertInstant": 1675322145449,
      "localizedName": "Bought Temporary Access",
      "name": "Bought Temporary Access",
      "notifyUserOnEnd": false,
      "userActionId": "6f4115c0-3db9-4734-aeda-b9c3f7dc4269"
    }
  ]
}
----

== Further reading

For more information on FusionAuth User Actions, see link:https://fusionauth.io/docs/v1/tech/apis/user-actions#overview[this overview] and link:https://fusionauth.io/docs/v1/tech/apis/actioning-users[this reference on actioning users]. You can also follow this tutorial for a practical example of how to [coordinate events around a customer purchase](https://fusionauth.io/blog/2023/04/20/using-user-actions).
