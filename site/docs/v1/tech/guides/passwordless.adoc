---
layout: doc
title: Passwordless authentication
description: Learn how to create a passwordless experience for your end users.
---

== What is passwordless

Passwordless authentication allows a user to prove their identity without a password.

With FusionAuth, passwordless authentication is by default implemented with a one use, timebound code, delivered by email. However, that is not the only option. If you need more customization, you can use the link:/docs/v1/tech/apis/passwordless[passwordless API] to generate a code. Then you may deliver it by another method, such as an SMS or push notification.

This guide will cover the FusionAuth passwordless authentication implementation including standard configuration, APIs you may use to build a custom experience, and system settings. 

Here's a quick video showing the default passwordless process in FusionAuth:

video::hMqxo68ZJlw[youtube,width=560,height=315]

== When does it make sense

Passwordless authentication smoothes the user's login experience. Rather than having to remember which password they used, the user provides their email address and is sent a one time link. When they click through, they are authenticated.

In addition to being easier for users, a passwordless login experience prevents them from reusing the same password across different sites or applications. No longer do you need to worry about a data breach from another website resulting in illicit access to your system. In addition, password brute forcing is no longer a threat since passwords are one time use.

== Setting up for passwordless

You can either use the FusionAuth default user interface, with possible theme changes. Or you can customize the passwordless flow using the API. Let's look at each in turn. In either case, you should:

* Configure your SMTP server settings under Tenants / Email. If you are testing this flow out locally, you may want to use https://mailcatcher.me/[mailcatcher].
* Create an application.
* Turn on "Passwordless Login" under Security tab of the application configuration.



image::guides/passwordless/turn-on-passwordless.png[Turn on passwordless login,width=500,role=box-shadow margin-right]

* Add a user and register them with your application. Make sure you register a valid email address.

Since passwordless depends on email working, ensure FusionAuth can send email. An easy way to test email delivery is creating a user and sending a password setup email to them.

== Using the FusionAuth user interface

For an easy implementation, use the FusionAuth UI. This uses the link:/docs/v1/tech/oauth/#example-authorization-code-grant[Authorization Code grant], but adds an additional option for a user to receive an email with the one time code. Because this is the Authorization Code grant, any library or framework that supports OAuth will integrate.

Here's how you would do that in the administration user interface:

* Go to your application configuration page in the administration UI.
* Configure the OAuth redirect URL as you would with an application where users authenticate with a password (https://fusionauth.io/docs/v1/tech/oauth/[more on OAuth config here]). Make sure the Authorization Code grant is an enabled grant.
* Go to your application login page.

image::guides/passwordless/login-page-with-magic-link.png[The passwordless login magic link.,width=500,role=box-shadow margin-right]


* Click the "Login with a magic link" button.

image::guides/passwordless/passwordless-email-request-form.png[The passwordless email request form.,width=500,role=box-shadow margin-right]

* Enter the users email.
* Go to the email inbox.
* Click on the link.

As soon as the link is clicked, the user has begun an Authorization Code grant. You can link:/docs/v1/tech/oauth/#example-authorization-code-grant[consume the authorization code] or handle this grant using a library. Whatever you would normally do if someone signed in with a password, you can now do here.

If you want to customize how the login pages look, you can by modifying using link:/docs/v1/tech/themes[themes]. 

While you are editing the theme, you could remove the username/password form. This would require everyone to use passwordless authentication. Since changing a theme modifies it for all of a tenant's applications, this change will be reflected across all applications in a tenant. If you want to hide the username/password form on an application by application basis, set up each application in a separate tenant.

=== Limits

Using the FusionAuth provided user interface requires you to send the passwordless code via email. It also requires you to use the Authorization Code grant.

== Using the API directly

While using the FusionAuth user interface is a quick way to get started, you may need more control.  You can also use the API to authenticate a user with a one time code. The link:/docs/v1/tech/apis/passwordless[passwordless API reference docs] cover each of the API calls, but this guide will take you through the flow. 

When using this method, you must set up an link:/docs/v1/tech/apis/authentication[API key] with the appropriate permissions. The minimum required is `POST` permission to the `/api/passwordless/start` endpoint.

There are a couple of reasons you might choose to this method of integration.

* You can customize every part of the login user experience.
* You can send the code via email but also using a different method such as a text message or Slack direct message.

=== Calling the API

There are three parts to the passwordless flow. 

1. You start the passwordless login via an API call.
1. The user gets the code.
1. The user enters the code and you complete the passwordless login via an API call.

==== Starting the login

You start the login by calling `/api/passwordless/start`

[source,shell]
.Start Passwordless Login API call
----
API_KEY=...
REQUEST_PAYLOAD='{...}'
curl  -H "Content-type: application/json" -H "Authorization: $API_KEY" https://local.fusionauth.io/api/passwordless/start -d $REQUEST_PAYLOAD
----

Here's an example request payload:

[source,json]
.Start Passwordless Login Request JSON
----
include::docs/src/json/passwordless/start-request.json[]
----

The `state` parameter is optional. If present, it delivered back to your application on successful login. This is useful to allow a user to act anonymously on your site, log in, and have data from their anonymous session available. 

For example, if you have a shopping site, you may want to allow a user to add items to their cart before they sign in. Once they have done so, associate the anonymous cart id with the authenticated user. In this case, the `state` key might be set to a JSON object like this:

[source,json]
----
{ "cart_id" : 1234 } 
----

The call to `/api/passwordless/start` begins the authentication process. 

[source,json]
.Start Passwordless Login Response JSON 
----
include::docs/src/json/passwordless/start-response.json[]
----

This is the code that the user must enter. Now you want to get that code to your end user however you want. If you want to use FusionAuth to deliver the code, see <<Sending the code>>.

==== Sending the code

This is an optional API call. If you want to send the passwordless code via the email server configured in FusionAuth, you may use the `/api/passwordless/send` API endpoint. 

Using this gets you the benefits of the FusionAuth locale-aware email templates and email sending capabilities without requiring you to use the FusionAuth login forms.

==== Completing Login

Once the user possesses the code, they must provide it to your application. You need to build the interface for them to do so. 

When the user provides the code to you, call the `/api/passwordless/login` endpoint, passing the code. At this time you can also pass other information such as IP address, but the code is required.

[source,json]
.Complete Passwordless Login Request JSON 
----
include::docs/src/json/passwordless/start-response.json[]
----

If the code is valid, your application will receive the user data object as well as a JWT. If you sent a `state` parameter when starting the authentication process, it will also be inncluded in the response, under the `state` key.

[source,json]
.Complete Passwordless Response JSON 
----
include::docs/src/json/users/passwordless-login-response.json[]
----

The user is now authenticated. Your application has user data, pre-existing state if provided, and a JWT which can be used to represent the user to other applications. If you want to send the JWT to a client as a cookie, you can now do so.

===== Additional passwordless login parameters

JWTs are typically passed to other applications such as an API server to enable access to protected resources (link:/learn/expert-advice/tokens/[more about JWTs]). If you are using passwordless authentication and are only interested in whether the user is authenticated, then the JWT is of no use. Since creating and signing the JWT and take server resources, you can turn off JWT generation.

Do this by setting the optional `noJWT` parameter to true when you call the complete API endpoint. This will increase the number of simultaneous login requests FusionAuth can process.

==== Common failure paths

Every time you start a passwordless login for a given user, all other codes become invalid. Codes are also invalid after a configurable time limit. If a user provides a code that is invalid, their account is locked or if there is anything else incorrect about data provided by the client, a status code in the 400 range will be returned. Please consult the link:/docs/v1/tech/apis/passwordless[passwordless API reference docs] for more details about return values.
If the code has been used already or has exp

== Two factor authentication

You can use two factor authentication in combination with FusionAuth passwordless authentication.

When two factor auth is enabled for a user, after the one time code has been provided they are prompted to provide an additional two factor verification code. 

Learn more about setting up link:/docs/v1/tech/tutorials/two-factor/[two factor authentication].

=== 2fa and the passwordless API

Two factor authentication also works when <<Using the API directly>>. In that case, when you complete the passwordless authentication, instead of getting the user data, you'll get a code:

[source,json]
----
{"twoFactorId":"VnNILnXs_EDG-cjwokwITRApmAxCMkojeT3CUqqLhLc"}0
----

You then have to prompt the user for their two factor code from SMS or an application like Google Authenticator. Note that this is an entirely different code than the one time code used for the initial passwordless flow. Pass the `twoFactorId` and the two factor code to the `/api/two-factor/login` endpoint to link:/docs/v1/tech/apis/login#complete-two-factor-authentication[complete the two factor authentication].

If a user has previously completed a two factor authentication and has decided to trust the device, you may have a `twoFactorTrustId` value. This can be passed to the passwordless authentication complete endpoint. If valid, it will skip the two factor challenge.

== Customizing passwordless

You can configure the FusionAuth passwordless implementation to meet your application's needs in a number of ways.

=== Templates

If you are using the FusionAuth provided email templates, whether you are using the standard FusionAuth user interface or the `/api/passwordless/send` API call, you will need to customize them. Since the template references "FusionAuth", simply duplicate the template and modify it with your branding and messaging. 

image::guides/passwordless/duplicating-email-template.png[Duplicate the passwordless login email template.,width=500,role=box-shadow margin-right]

image::guides/passwordless/modifying-email-template.png[Modifying the passwordless email template.,width=500,role=box-shadow margin-right]

Then configure the tenant email template settings to use your passwordless login template.

image::guides/passwordless/update-tenant-with-new-template.png[Updating the tenant to use the new passwordless email template.,width=500,role=box-shadow margin-right]

You can use any Apache FreeMarker built-ins within the template. Make sure you modify both the HTML and text templates:

.The default passwordless HTML template
[source,text]
----
include::docs/src/email/passwordless.html[] 
----

.The default passwordless text template
[source,text]
----
include::docs/src/email/passwordless.txt[]
----

You can localize the template as well:

image::guides/passwordless/localization-screen-for-email-template.png[The localization screen for your email templates.,width=500,role=box-shadow margin-right]

More about link:/docs/v1/tech/email-templates[email templates]. 

=== One time code customization

You may modify the lifetime of the code sent to users. By default it is 180 seconds, but you can change this in the tenant settings.

image::guides/passwordless/tenant-settings.png[The tenant settings to customize code lifetime and generation strategy.,width=500,role=box-shadow margin-right]

You can also change the type of the code generated. Both the length of the code and the contents of the code may be customized. The current limits are:

TBD include framgment with limits

You may change your code length or content generation strategy for security or user experience reasons. You may have requirements that specify a certain code length. If you deliver the code by text message, having a user enter a six digit alphanumeric code sent to them by SMS is a lot easier than a 64 byte string. 

== Security

With passwordless authentication, if the userâ€™s email account is hijacked, their account on your system is compromised. However, many organizations have heightend security policies and protections around email account passwords. It is often easier to protect and regularly change an email account password than to change all of a user's passwords. Email accounts are also more likely to have two factor authentication enabled.

One way to increase the security of your passwordless authentications is to decrease the lifetime of the code. This will help if the email is compromised or accidentally forwarded. 

There are no limits on how many passwordless requests can be placed for a single email address, but only the most recent code is valid. Any of the others, even if they have not yet expired, will display an `Invalid login credentials` message to the user if provided.

If someone tries to use an email that is not present in the FusionAuth user database, they'll see the same notification as they would if the email existed, but no email message will be sent.

If you use the API, follow the principle of lease privilege and lock down the calls to which the API key has access. If all you are using the API key for is passwordless login, then don't associate any other permissions with this key.

=== What about user's passwords

When FusionAuth is your user datastore, when you add a user, you must provide a password or send them a link to reset their password. 

If you are requiring passwordless authentication, rather than just offering it as an option, set the user's initial password to a long string of random characters. Since they won't be using it, it doesn't matter how long it is.
