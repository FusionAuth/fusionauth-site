---
layout: doc
title: Families guide
description: What are families in FusionAuth and how are they useful?
---

The family API in FusionAuth is a powerful way to logically group family members. It also pairs nicely with the consent API to manage consents provided to children by parents.

You can review the link:../apis/families[family API] for detailed API documentation.


== Why would you use Families?

There are two main reasons you might want to use the family API. The first is to easily add family relationships to your application. You can have associations and different roles for each type of family member. Based on these roles, your application can offer different functionality. 

These relationships may be complex; for example, a child may be a member of multiple families all headed by different parents.

The second reason to consider using the family API is because you are legally obligated to obtain parental consent due to the age of your users and what you are doing with their data. FusionAuth can help you send emails to verify consent and track the consents given to each user. While restrictions and age limits vary by legal jurisdiction, applications often need some form of parental consent. 

We'll walk through these scenarios below.

== Setting up family management

The first step is to enable the family settings. 

Go to [breadcrumb]#Tenants -> Default -> Family# and enable the family, if you want the functionality to be available to the "Default" tenant.

image::guides/families/default-family-settings.png[Default family settings,width=700,role=box-shadow margin-right]

You'll also want to make sure your "Maximum child age" and "Minimum owner age" are set appropriately. The defaults are correct for the current laws of the USA, but ages will differ according to your legal jurisdiction. If you are serving different countries with different ages, you'll need different tenants, as these values are set on a tenant basis.

Different use cases will require modifying additional Tenant attributes, but for now let's leave the defaults and examine different use cases.

== Use cases

Let's walk through some cases where you might want to use families. 

We'll cover the following

* <<Family management>>
* <<Parental approval>>
* <<Legal consent frameworks>> such as COPPA

=== Family management

In this case, you'll be using the Family APIs to create a family and associate users within that family.

Each user account is independent, with its own data, email address or username and password. A family lets you group them together.  Users are associated with the family by actions of the owner, so consent is implied in the act of creation and not captured in the system. Imaging adding a family member to a Netflix or Amazon account. When you are doing so, the consent is in the act.

==== Creating and adding family members 

First, create a FusionAuth application using the link:../apis/applications[Application API] and a user with the link:../apis/users[User API]. Or, use the administration user interface to create these users. Make sure the user's age is greater than the "Minimum owner age" you specified.

Then, create a family associated with this user by calling the link:../apis/families#create-a-family[`/api/user/family`] endpoint. Here's an example of how you might do this using curl.

[source,shell]
.Creating a Family
----
API_KEY=...
REQUEST_PAYLOAD='{...}'
curl -XPOST -H 'Content-type: application/json' -H "Authorization: $API_KEY" https://local.fusionauth.io/api/user/family -d $REQUEST_PAYLOAD
----

The first user of a family must be an adult and an owner. Here's an example request payload:

[source,json]
.Create Family Request JSON
----
include::docs/src/json/family/request.json[]
----

Here's an example response:

[source,json]
.Create Family Response JSON
----
include::docs/src/json/family/response.json[]
----

After family creation, there is only one member, the owner. Your application can then add family members as needed. To do so, ensure they exist, adding them via the API if needed. 

The request to add users to a family is similar to the request to create a family. The main differences are:

* You provide the existing family id
* You use the `PUT` method instead of the `POST` method
* You can add users with any family role

[source,shell]
.Adding a User to a Family
----
API_KEY=...
REQUEST_PAYLOAD='{...}'
curl -XPUT -H 'Content-type: application/json' -H "Authorization: $API_KEY" https://local.fusionauth.io/api/user/family -d $REQUEST_PAYLOAD
----

Here's an example request payload:
[source,json]
.Add A Member To A Family Request JSON
----
include::docs/src/json/family/request-child.json[]
----

After each addition, you'll receive back the entire family object. Here's an example response payload:

[source,json]
.Add A Member To A Family Response JSON
----
include::docs/src/json/family/response-after-child-added.json[]
----

===== Allowing a Child to Request an Account

You may be using the FusionAuth OAuth login and registration templates and want to allow a child to indicate interest in your application, but not register.

In this case, you want to enable self service registrations on the application, and disable child registrations on the tenant. You may want to use update the "Family request template". If the value for that email template is not set, then no email will be sent. FusionAuth will then require a birthday at registration and if the user is under the "Maximum child age", then they'll see a message prompting them to ask their parents. 

image::guides/families/parent-request-no-child-allowed.png[Form for a child requesting an account from a parent,width=700,role=box-shadow margin-right]

If the child submits an email address, presumably for their parents, an email will be sent. If you need to resend this email, you can do so using the link:../apis/families#request-parental-approval[Request Parental Approval] API.

Here's an example of an email:

.Sample Family Registration Request HTML Template
[source,text]
----
include::docs/src/email/family-registration.html[]
----

You should customize and localize this email as required. Please see the link:../email-templates/email-templates[Email Templates documentation] for variables accessible in the template as well as more information. 

==== Retrieving family members

If you are building a family interface, you'll want to display all the members. You'd make this API call when you wanted to display all the associated accounts, just like in Netflix when you choose which account's shows to watch.

To find family members, you must provide a user id or a family id. Which method to choose depends on what you are trying to do.

If you are looking for related family members, provide the user id of the family member you know. If, on the other hand, you know the family id and are looking for all members, search by family id. 


[source,shell]
.Retrieving a Family By Family Id
----
API_KEY=...
FAMILY_ID=a815b480-d52d-4755-96ac-749c067925d7
curl -H 'Content-type: application/json' -H "Authorization: $API_KEY" 'https://local.fusionauth.io/api/user/family/'$FAMILY_ID
----

[source,shell]
.Retrieving a Family By User Id
----
API_KEY=...
USER_ID=b3360a2d-e81d-4314-b9f1-244a916ca52f
curl -H 'Content-type: application/json' -H "Authorization: $API_KEY" 'https://local.fusionauth.io/api/user/family?userId='$USER_ID
----

Here's an example response payload:

[source,json]
.Retrieve Family Response JSON
----
include::docs/src/json/family/response-after-child-added.json[]
----

You can also see all family members in the administrative user interface. Go to [breadcrumb]#Users# and then view the user details. Navigate to the "Family" tab to see family members. From there, you can manage the details of each family member.

image::guides/families/display-family-members-admin-ui.png[Display of family members in the administrative user interface,width=700,role=box-shadow margin-right]

==== Update family members 

You can update information about a family member. You might do this if their family role has changed. FusionAuth does not automatically change the role of a user based on their age.

[source,shell]
.Little e4440a4d Is All Grown Up, Let's Mark Them As a Teenager
----
API_KEY=...
FAMILY_ID=a815b480-d52d-4755-96ac-749c067925d7
REQUEST_PAYLOAD='{...}'
curl -XPUT -H 'Content-type: application/json' -H "Authorization: $API_KEY" https://local.fusionauth.io/api/user/family/
----

Here's an example request payload:

[source,json]
.Update Family Member Request JSON
----
include::docs/src/json/family/request-update-child.json[]
----

Here's an example response payload, indicating that indeed, the user's family role has changed:

[source,json]
.Update Family Member Response JSON
----
include::docs/src/json/family/response-after-child-updated.json[]
----

==== Removing family members and families

You may also remove family members. An example of why you might do this is if someone signed up for their own Netflix account. They then won't need to be associated with the family account.

[source,shell]
.Removing a Family Member 
----
API_KEY=...
FAMILY_ID=a815b480-d52d-4755-96ac-749c067925d7
USER_TO_REMOVE=e4440a4d-b81d-4314-c9f1-844a916ca52f
curl -XDELETE -H "Authorization: $API_KEY" 'https://local.fusionauth.io/api/user/family/'$FAMILY_ID'/'$USER_TO_REMOVE
----

You can't delete a family object via an API call. Similarly to the way families are implicitly created, they are deleted implicitly. If you remove all members of a family, it becomes unavailable. At that point any API calls against the deleted family will fail. For example, if you attempt to retrieve it, a 404 will be returned.

=== Parental approval

In this scenario, a child creates an account but has no or limited access until a parent has approved the signup. Depending on your application, you may make limited application functionality available, however. Think of a game aimed at children like Roblox. An example of functionality that may be unlocked by parental approval is in-game chat. Unlike the previous scenario, consent is not implied in the account creation, so you'll need to record it.

Parents approve signups by receiving an email and clicking on a link contained in that email. FusionAuth sends the email, but you need to make sure the content of the email is correct and that your application handles the click.

This scenario only differs from the previous one in how users are added to a family and how consent is recorded. How you update and remove family members is unchanged. 

Finally, a parent may or may not have an account, but if they do not, they'll be prompted to create one. At the end of the parental approval use case, both parent and child will have FusionAuth user accounts.

==== Setting up the email

You may want to create two email templates. The first is the 
"Confirm child account template" and the second is the "Parent registration request template" to deliver emails based on the parent user account state.

The "Confirm child account template"  will be sent when a parent already has an account and merely needs to confirm the child's account creation. The "Parent registration request template", on the other hand, is sent when a parent has no account and must register. You cannot resend these emails.

If the templates are not set, no emails will be sent; FusionAuth assumes you'll request child account confirmation using some other notification means, such as a mobile push notification or SMS.

.Sample Confirm Child Email HTML Template
[source,text]
----
include::docs/src/email/confirm-child.html[]
----

.Sample Parent Registration Request HTML Template
[source,text]
----
include::docs/src/email/parent-registration.html[]
----

You can customize and localize these emails as required. Please see the link:../email-templates/email-templates[Email Templates documentation] for variables accessible in the template as well as more information.

Note that before version 1.17.2 there was a link:https://github.com/FusionAuth/fusionauth-issues/issues/685[bug affecting template variables] in these emails. 

==== Registering the child

[source,shell]
.Registering a Child With Parental Consent
----
API_KEY=...
REQUEST_PAYLOAD='{...}'
curl -XPUT -H 'Content-type: application/json' -H "Authorization: $API_KEY" https://local.fusionauth.io/api/user -d $REQUEST_PAYLOAD
----

Here's an example request payload:

[source,json]
.Registering a Child With Parental Consent Request JSON
----
{
  "registration": {
    "applicationId": "78bd26e9-51de-4af8-baf4-914ea5825355"
  },
  "user": {
    "parentEmail": "parent@example.com",
    "birthDate": "2016-01-01",
    "email": "child@example.com",
    "password": "password"
  }
}
----

Provide the parent's email address and birthday as well as the application, email and password information. As soon as you create the child account, one of the above emails will be sent. 

At this point, the path forks. On one side, the parent has a FusionAuth account. In this case, the "Confirm child account template" email will be sent. This email should contain a link displaying the child account to confirm.

In the other case, the "Parent registration request template" email is sent. This prompts the parent to register and create a user account. If you never want a parent to be so prompted, you may create a parent account for the given email address via the API prior to creating the child account. You could then let the parent reset the password when they receive the "Confirm child account template" email.

In both these cases, there should be a link in the customized email template. You as the application developer are responsible for handling that what happens when the user clicks that link.

==== Handling the link

When the link in the email is clicked by the parent, they must register or log in to your application. After they do so, you should present the parent with the list of one or more child accounts to confirm.

You can retrieve the list of child accounts by calling the "Retrieve Pending Family Members" API. 

[source,shell]
.Retrieving Pending Family Members
----
API_KEY=...
PARENT_EMAIL_ADDRESS=parent@example.com

curl -XGET -H "Authorization: $API_KEY" 'http://local.fusionauth.io/api/user/family/pending?parentEmail='$PARENT_EMAIL_ADDRESS
----

This will return a list of User objects corresponding to the unconfirmed, associated child user accounts. Make sure this page is protected.

You may then add them to the family using the sames APIs as you would in the <<Family management>> scenario. Adding a child to the family will remove the `parentEmail` field from the child User object. The `parentEmail` field is essentially the indicator that the child does not yet belong to a family.

==== After confirmation

When the child is confirmed as part of the family, you may want to capture more infomration about that consent. You have a couple alternatives:

- You can create and record a consent using the link:../apis/consent[Consent API]. This is the recommended option.
- You can record it elsewhere in your application. For example, confirmation page could call another API.
- You can add the date, type and other consent information to the `user.data` field of the child account.
- You could treat membership in a family as the record of consent.

Creating a consent object is the recommended way to capture a record of the parental consent. Using this API has the following benefits:

* You can create multiple kinds of consents for different purposes. 
* Consents can be listed per user.
* Consents may be granularly granted and revoked.

In general, using a consent gives you much more flexibility.

However, whichever way you choose, know that it doesn't happen automatically. 

==== Using consents

When using consents, your application capture how and when parental consent was provided. You can retrieve consents for each child and user. You can build a user interface to allow a parent to temporarily or permanently revoke a consent.

Consents are entirely disjoint from families in terms of the API. That is, you don't need to be part of a family to grant consent to another user. However, if you're using the Consent API to capture parental consent, you'll want to validate that:

* the user granting consent is in the same family as the user recieving it
* if the user receiving consent is a child, the user granting consent is a parent

If a user is less than the "Maximum child age" setting, however, they will not be able to grant consent to themselves. If a user is older than that, they can self consent.

To use a consent, first, create a consent. Let's do that via the admin UI. I'm going to add a consent called 'Email consent'. I'll leave the other settings at their default values, but please consult the link:../apis/consent[Consent API] documentation for more information on the various options.

image::guides/families/add-consent.png[Adding a custom consent,width=700,role=box-shadow margin-right]

Second, when the parent verifies the child, create a user consent, capturing the grant. We'd do this with the following curl command, though you can of course use the link:../client-libraries[client libraries]:

[source,shell]
.Granting Consent 
----
API_KEY=...
REQUEST_PAYLOAD='{...}'

curl -XPOST -H 'Content-type: application/json' -H "Authorization: $API_KEY" 'http://local.fusionauth.io/api/user/consent' -d $REQUEST_PAYLOAD
----

Here's an example request payload:

[source,json]
.Granting Consent Request JSON
----
include::docs/src/json/user-consent/request.json[]
----

This gives the following response:

[source,json]
.Granting Consent Response JSON
----
include::docs/src/json/user-consent/response-no-email-plus.json[]
----

The consent is now granted. In your application, you can pull the consents for a given user at login or any other time to know the appropriate level of access to allow. You can also pull it for reporting. 

==== Unverified children

If a child registers and the parent never confirms their account, you may delete the child accounts automatically, after a certain number of days. Or you can keep the accounts indefinitely, if that works better for you.

==== Using the FusionAuth OAuth interface

While this document has primarily focused on how to use the APIs, which requires integrating with your own user interface, you can also use the FusionAuth OAuth interface for registration and login. To do so, in addition to the settings mentioned in <<Setting up family management>>, change the following settings:
 
. Enable the self service registration on the application
. Enable "Allow child registrations on the tenant"
. Enable "Parent email required during registration" 

These settings only affect the OAuth registration interface. With these settings, FusionAuth will prompt anyone registering for their birth date before any other information is requested.

image::guides/families/register-birth-date.png[Form requiring a registering user to enter their birth date,width=700,role=box-shadow margin-right]

And then will require the parent email address, if their birth date indicates they are under the "Maximum child age" configured in the Tenant Family tab.

image::guides/families/register-prompt-parent-email.png[Form for a child registering and requesting consent from a parent,width=700,role=box-shadow margin-right]

Similarly to when you use the APIs directly, if a child registers using these themed pages, the parent will be emailed; the template used will be the "Parent registration request template" if they are not registered, but if they are, the "Confirm child account template" email will be sent.

When the parent registers, you'll still have to handle the displaying the pending family members using your own API calls and have the parents approve them. The OAuth registration pages don't provide for that. If you'd like to modify the registration pages to look like your own application, link:../themes[change the tenant theme].

==== Updating and removing members

There are no differences in updating or removing family members in this scenario.

=== Legal consent frameworks 

For applications specifically targetted at young children, laws come into play. For example the https://www.ftc.gov/enforcement/rules/rulemaking-regulatory-reform-proceedings/childrens-online-privacy-protection-rule[Children's Online Privacy Protection Act, or COPPA], in the USA and the https://gdpr-info.eu/art-8-gdpr/[General Data Protection Regulation, or GDPR] in the EU both outline specific requirements for informed parental consent when applications aim certain online activities at children.

FusionAuth allows you to build custom consent frameworks, as shown above, but also supports COPPA. If you're building a child-directed game (that is, one aimed at children) in the USA, and you'll be collecting data about the children for such purposes as marketing and gameplay improvement, you need to comply with COPPA.

This guide will focus on COPPA; please check your local laws for child consent requirements.

==== COPPA support

There are two different ways for companies to comply with COPPA, according to the FTC. Which you choose depends on how you're going to use the data. 

You can use verified parental consent (VPC) or "email plus". While FusionAuth supports both, the COPPA "email plus" compliance method is available out of the box. "Email plus" is more common.

==== COPPA consent

The only difference between COPPA and Parental Approval is in the consent required. COPPA "email plus" requires two emails to be sent at different times, to ensure that parents have ample opportunity to grant or revoke consent. FusionAuth has built this workflow.

To enable the COPPA consent, review the COPPA Email+ consent and make any content or setting changes needed.

image::guides/families/coppa-email-plus-consent.png[The default COPPA consent,width=700,role=box-shadow margin-right]

Then review both the COPPA notice email templates for language and branding. Modify them so that they point to the correct application URL to enable consent grant. Here are the sample email templates.

.The COPPA Notice
[source,text]
----
include::docs/src/email/coppa-notice.html[]
----

.The Email Plus COPPA Notice
[source,text]
----
include::docs/src/email/coppa-plus-notice.html[]
----

When a child is verified by a parent and added to the family create the COPPA consent. Here's an example of how you might do so for a child.

[source,shell]
.Granting Consent 
----
API_KEY=...
REQUEST_PAYLOAD='{...}'

curl -XPOST -H 'Content-type: application/json' -H "Authorization: $API_KEY" 'http://local.fusionauth.io/api/user/consent' -d $REQUEST_PAYLOAD
----

Here's an example request payload:

[source,json]
.Granting Consent Request JSON
----
include::docs/src/json/user-consent/request.json[]
----

Which responds with the following:

[source,json]
.Granting Consent Response JSON
----
include::docs/src/json/user-consent/response.json[]
----

For a user who is older than a child but not yet an adult, your application can allow them to perform self consent. In that case the `giverUserId` and the `userId` for the consent request would be the same `userId`, that of the teenager.

==== Revocation

You must handle the consent revocation. There will be two consent reminder emails sent. In either one, a parent may login and and view the granted consents for their family. In that view, which you as the application developer should build, the parent should be able to grant or revoke consent for any child in the family.

Here's how you'd revoke a previously granted consent, using curl:

[source,shell]
.Revoking Consent 
----
API_KEY=...

curl -v -XDELETE -H "Authorization: $API_KEY" 'http://local.fusionauth.io/api/user/consent/841d8b33-bf4d-488d-9f2f-2f50d769c3d2' 
----

Here's the response you'll receive on successful revocation. Note that `status` has changed:

[source,json]
.Revoked Consent Response JSON 
----
include::docs/src/json/user-consent/response-revoked.json[]
----

If you wanted to create an audit log of the consents granted or revoked, you'd need to do this in your own application at the same time as you called the consent API.

Here's how you'd pull a list of consents for a user to determine if they'd been given a particular consent. You might do this if a user was trying to access the chat section of your application, for example. You'd want to call this after the child's login and prevent the child from accessing part or all of the application if consent has been revoked.

[source,shell]
.Listing User Consents
----
API_KEY=...

curl -XGET -H "Authorization: $API_KEY" 'http://local.fusionauth.io/api/user/consent?userId=841d8b33-bf4d-488d-9f2f-2f50d769c3d2'
----

This call responds with this JSON when the consent has been granted.

[source,json]
.Listing Consent Response JSON When Consent Granted
----
include::docs/src/json/user-consent/response.json[]
----

This is the response when consent has been revoked:

[source,json]
.Listing Consent Response JSON When Consent Revoked
----
include::docs/src/json/user-consent/response-revoked.json[]
----

when the consent has been revoked. 

[NOTE]
====
This means that you need to check the value of the consent `status`, not just whether the consent exists.
====

== Alternatives

If you don't need to model parent child relationships, but instead simply want a way of associating arbitrary users, consider link:/docs/v1/tech/core-concepts/groups[Groups].

If you want to tie permissions in your application to users or groups of users, but don't need to worry about parent child relationships, consider link:/docs/v1/tech/core-concepts/roles[Roles].

== Example application

There is an [example nodejs application](https://github.com/FusionAuth/fusionauth-example-family) which allows for confirmation of child accounts and granting and revocation of parental consent.

== Limitations

There are three family roles available:

* `Adult`
* `Child`
* `Teen`

These roles have no relationship to the birth date of a user. These roles are completely assigned by you and if you want to categorize a 25 year old as a teenager, FusionAuth won't stop you. Ages are only checked for the family creator. The first user added to a family must be older than the "Minimum owner age". All other owners, however, may be any age. Family roles have no relationship whatsoever to application roles, except they share the name "role". 

A family consists of at least one adult, and an arbitrary number of teens, children and other adults.

Families display in the administration user interface. You can configure settings related to families as detailed above in the administration user interface as well. But you may not create or modify families using the admin interface. 

If you are going to use families, you're going to be writing code against the APIs, either directly or using the client libraries. However, there is support in the FusionAuth provided login screens for the child registrations.

Most family configuration is set at the tenant level. If you require different configurations, you need multiple tenants. For example, if the maximum age of a child is 12 for one application and 15 for another, you can't manage them in the same FusionAuth tenant. However, creating multiple tenants in one FusionAuth installation is simple; see the link:../apis/tenants[Tenants APIs] for more information.

Users with the `Child` or `Teen` family roles may belong to more than one family, but a user with the `Adult` role may not belong to more than one family. 
