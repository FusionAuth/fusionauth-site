---
layout: doc
title: Two Factor APIs
description: APIs for enabling and disabling Two Factor Authentication
---

== Overview

This API allows you to manage multi factor authentication (MFA) for users.

[NOTE]
====
This API underwent breaking changes in version 1.26. You can view the link:../two-factor-1-25[1.25 documentation] if needed.
====

include::docs/v1/tech/shared/_premium-edition-blurb.adoc[]

The TOTP implementation is not a premium feature.

* <<Enable Two Factor>>
* <<Disable Two Factor>>

* <<Send a Two Factor Code During Login or Step Up>>
* <<Send a Two Factor Code When Enabling MFA>>
* <<Send a Two Factor Code When Disabling MFA>>

* <<Generate a Secret>>
* <<Start Two Factor>>

Here's a general outline of how you might use FusionAuth's MFA.

* Enable it at the tenant level, configuring allowed MFA options. Please see the tenant documentation for that API.
* Enable it on a user in a tenant, configuring allowed MFA options.
* The user can log in and must provide MFA.
* The user can be interacting with an application and take a privileged action and be required to provide a code.
* Disable it on a user in a tenant.



The "Send" API is used to send a Two Factor verification code to a User. There are three main use cases:

* The user is logging in or is in a "step up auth" flow where they are undertaking a privileged action.
* The user is enabling MFA
* The user is disabling MFA


== Authentication

Some of these operations can use JWT authentication instead of API key authentication. 

Learn more about link:/docs/v1/tech/apis/authentication/#jwt-authentication[JWT authentication and see examples here].

If you have a valid [field]#twoFactorId#, neither a JWT nor an API key is required.

== Start Two Factor

Starts a two factor request. This would be used for step up auth, such as when sensitive data is requested or for where you need to control the Two Factor Authentication process.

=== Request

[.api-authentication]
link:/docs/v1/tech/apis/authentication#api-key-authentication[icon:lock[type=fas]] Start Two Factor Authentication
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/user/two-factor/start#
--

include::docs/v1/tech/apis/_x-fusionauth-tenant-id-header-scoped-operation.adoc[]

include::docs/v1/tech/apis/_two-factor-start-request-body.adoc[]

=== Response

TBD


:missing_message: The User does not exist. The response will be empty.
include::docs/v1/tech/apis/_standard-post-response-codes.adoc[]
:missing_message!:

include::docs/v1/tech/apis/_two-factor-start-response-body.adoc[]

== Generate a Secret

This API is used to generate a new Two Factor secret for use when enabling Two Factor authentication for a User. This is provided
as a helper to assist you in enabling Two Factor authentication.

If this secret will be used with a QR code to allow the User to scan the value it will need utilize the Base32 encoded value returned in
the response.

=== Request

[.api-authentication]
link:/docs/v1/tech/apis/authentication#api-key-authentication[icon:lock[type=fas]] Generate a Two Factor Secret
[.endpoint]
.URI
--
[method]#GET# [uri]#/api/two-factor/secret#
--

[.api-authentication]
link:/docs/v1/tech/apis/authentication#jwt-authentication[icon:id-badge[type=fas]] Generate a Two Factor Secret
[.endpoint]
.URI
--
[method]#GET# [uri]#/api/two-factor/secret#
--

=== Response

The response for this API contains a Two Factor secret suitable for an authenticator like Google Authenticator.

:never_missing:
:no_errors:
include::docs/v1/tech/apis/_standard-get-response-codes.adoc[]
:no_errors!:
:never_missing!:

==== Response Body

[.api]
[field]#secret# [type]#[String]#::
A Base64 encoded secret that may be used to enable Two Factor authentication.

[field]#secretBase32Encoded# [type]#[String]#::
A Base32 encoded form of the provided secret. This useful if you need to provide a QR code to the User to enable Two Factor authentication.

[source,json]
.Example Response JSON
----
include::docs/src/json/two-factor/secret/response.json[]
----

== Send a Two Factor Code During Login or Step Up

This operations allows you to send a message with a code to finish a Two Factor flow, and requires an existing `twoFactorId`. No API key is required. 

=== Request

[.api-authentication]
link:/docs/v1/tech/apis/authentication#no-authentication-required[icon:unlock[type=fas]] Send a Two Factor code to complete Two Factor Login
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/two-factor/send/`{twoFactorId}`#
--

==== Request Parameters

[.api]
[field]#twoFactorId# [type]#[String]# [required]#Required#::
The `twoFactorId` returned by the Login API or the Start Two Factor request.

include::docs/v1/tech/apis/_x-fusionauth-tenant-id-header-scoped-operation.adoc[]

==== Request Body

[.api]
[field]#methodId# [type]#[String]# [required]#Required#::
The Id of the MFA method to be used.

[source,json]
.Example Request JSON
----
include::docs/src/json/two-factor/send/twoFactorId-request.json[]
----

=== Response

This API does not return a JSON response body.

:success_code: 200
:success_message: The request was successful.
include::docs/v1/tech/apis/_standard-post-response-codes.adoc[]
:success_code!:
:success_message!:

== Send a Two Factor Code When Enabling MFA

You are enabling MFA for a user. You must provide an API key or a valid JWT for the User you are modifying. You are using FusionAuth as your delivery mechanism.

=== Request

[.api-authentication]
link:/docs/v1/tech/apis/authentication#api-key-authentication[icon:lock[type=fas]] Send a Two Factor code to an existing User by Id
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/two-factor/send#
--

include::docs/v1/tech/apis/_x-fusionauth-tenant-id-header-scoped-operation.adoc[]

==== Request Body

[.api]
[field]#email# [type]#[String]# [optional]#Optional#::
The email to which send Two Factor codes. If the [field]#method# is equal to `email`, this is required.

[field]#method# [type]#[String]# [required]#Required#::
The type of the MFA method which will be added. The value provided here must be allowed in the Tenant MFA configuration as well.
+
Valid values are:
+
* `email`
* `sms`

[field]#mobilePhone# [type]#[String]# [optional]#Optional#::
The mobile phone to which send Two Factor codes. If the [field]#method# is equal to `sms`, this is required.

[field]#userId# [type]#[UUID]# [required]#Required#::
The User Id. 

[source,json]
.Example Request JSON
----
include::docs/src/json/two-factor/send/enable-userId-request.json[]
----


[.api-authentication]
link:/docs/v1/tech/apis/authentication#jwt-authentication[icon:id-badge[type=fas]] Send a Two Factor code to an authenticated User using a JWT
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/two-factor/send#
--

include::docs/v1/tech/apis/_x-fusionauth-tenant-id-header-scoped-operation.adoc[]

==== Request Body

[.api]
[field]#email# [type]#[String]# [optional]#Optional#::
The email to which send Two Factor codes. If the [field]#method# is equal to `email`, this is required.

[field]#method# [type]#[String]# [required]#Required#::
The type of the MFA method which will be added. The value provided here must be allowed in the Tenant MFA configuration as well.
+
Valid values are:
+
* `email`
* `sms`

[field]#mobilePhone# [type]#[String]# [optional]#Optional#::
The mobile phone to which send Two Factor codes. If the [field]#method# is equal to `sms`, this is required.

[source,json]
.Example Request JSON
----
include::docs/src/json/two-factor/send/enable-jwt-request.json[]
----

=== Response

This API does not return a JSON response body.

:success_code: 200
:success_message: The request was successful.
include::docs/v1/tech/apis/_standard-post-response-codes.adoc[]
:success_code!:
:success_message!:


== Send a Two Factor Code When Disabling MFA

You are disabling MFA for a user. You must provide an API key or a valid JWT for the User you are modifying. You are using FusionAuth as your delivery mechanism.

=== Request

[.api-authentication]
link:/docs/v1/tech/apis/authentication#api-key-authentication[icon:lock[type=fas]] Send a Two Factor code to an existing User by Id
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/two-factor/send#
--

include::docs/v1/tech/apis/_x-fusionauth-tenant-id-header-scoped-operation.adoc[]

==== Request Body

[.api]
[field]#methodId# [type]#[String]# [required]#Required#::
The Id of the MFA method which will be removed.

[field]#userId# [type]#[UUID]# [required]#Required#::
The User Id of the User to send a Two Factor verification code. This User is expected to already have Two Factor enabled.

[source,json]
.Example Request JSON
----
include::docs/src/json/two-factor/send/disable-userId-request.json[]
----

[.api-authentication]
link:/docs/v1/tech/apis/authentication#jwt-authentication[icon:id-badge[type=fas]] Send a Two Factor code to an authenticated User using a JWT
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/two-factor/send#
--

include::docs/v1/tech/apis/_x-fusionauth-tenant-id-header-scoped-operation.adoc[]

==== Request Body

[.api]
[field]#methodId# [type]#[String]# [required]#Required#::
The Id of the MFA method which will be removed.

[source,json]
.Example Request JSON
----
include::docs/src/json/two-factor/send/disable-jwt-request.json[]
----

=== Response

This API does not return a JSON response body.

:success_code: 200
:success_message: The request was successful.
include::docs/v1/tech/apis/_standard-post-response-codes.adoc[]
:success_code!:
:success_message!:


BUSTED BELOW THIS LINE

=== Request

[.api-authentication]
link:/docs/v1/tech/apis/authentication#api-key-authentication[icon:lock[type=fas]] Send a Two Factor code to an existing User by Id
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/two-factor/send#
--

This request is intended to be used to send a Two Factor code to a User that already has enabled Two Factor authentication and has at least one MFA method configured.

include::docs/v1/tech/apis/_x-fusionauth-tenant-id-header-scoped-operation.adoc[]

==== Request Body

[.api]
[field]#email# [type]#[String]# [optional]#Optional#::
The email to which send the Two Factor code. If the [field]#mobilePhone# is not provided, this is required when enabling MFA.

[field]#methodId# [type]#[String]# [optional]#Optional#::
The MFA method to use for this request.

[field]#method# [type]#[String]# [optional]#Optional#::
The MFA method to use for this request. Valid values are:
+
* `authenticator`
* `email`
* `sms`

[field]#mobilePhone# [type]#[String]# [optional]#Optional#::
The mobile phone to which send the Two Factor code. If the [field]#mobilePhone# is not provided, this is required to enabling MFA.

[field]#userId# [type]#[UUID]# [required]#Required#::
The User Id of the User to send a Two Factor verification code. This User is expected to already have Two Factor enabled.


[source,json]
.Example Request JSON
----
include::docs/src/json/two-factor/send/request_userId.json[]
----

[.api-authentication]
link:/docs/v1/tech/apis/authentication#api-key-authentication[icon:lock[type=fas]] Send a Two Factor code to a mobile phone
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/two-factor/send#
--

This request is intended to be used to send a Two Factor code to a User to assist in enabling Two Factor authentication.

==== Request Body

[.api]
[field]#mobilePhone# [type]#[String]# [required]#Required#::
A mobile phone to send the Two Factor verification code.

[field]#secret# [type]#[String]# [required]#Required#::
The Two Factor secret used to generate a Two Factor verification code to send to the provided mobile phone.
+
You may optionally use value provided in the `secret` field returned by the link:/docs/v1/tech/apis/two-factor#generate-a-secret[Two Factor Secret] API instead of generating this value yourself.

[source,json]
.Example Request JSON
----
include::docs/src/json/two-factor/send/request.json[]
----




=================================== review below this line

== Enable Two Factor

This API is used to enable Two Factor authentication for a single User. To use this API the User must provide a valid
Two Factor verification code.

To enable using `TextMessage` delivery, you may use the link:/docs/v1/tech/apis/two-factor#send-a-two-factor-code[Two Factor Send] API to deliver a
code to the User, the User will then provide this code as input.

=== Request

[.api-authentication]
link:/docs/v1/tech/apis/authentication#api-key-authentication[icon:lock[type=fas]] Enable Two Factor Authentication
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/user/two-factor/`{userId}`#
--

==== Request Parameters

[.api]
[field]#userId# [type]#[UUID]# [required]#Required#::
The Id of the User to enable Two Factor authentication.

include::docs/v1/tech/apis/_x-fusionauth-tenant-id-header-scoped-operation.adoc[]

[.api-authentication]
link:/docs/v1/tech/apis/authentication#jwt-authentication[icon:id-badge[type=fas]] Enable Two Factor Authentication
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/user/two-factor#
--

include::docs/v1/tech/apis/_x-fusionauth-tenant-id-header-scoped-operation.adoc[]

include::docs/v1/tech/apis/_two-factor-request-body.adoc[]

=== Response

[cols="1,9"]
.Response Codes
|===
|Code |Description

|200
|The request was successful. Two Factor has been enabled for the User.

|400
|The request was invalid and/or malformed. The response will contain an link:/docs/v1/tech/apis/errors/[Errors] JSON Object with the specific errors.

|401
|You did not supply a valid Authorization header. The header was omitted or your API key was not valid. The response will be empty. See link:/docs/v1/tech/apis/authentication/[Authentication].

|404
|The User does not exist. The response will be empty.

|421
|The `code` request parameter is not valid. The response will be empty.

|500
|There was an internal error. A stack trace is provided and logged in the FusionAuth log files. The response will be empty.

|503
|The search index is not available or encountered an exception so the request cannot be completed. The response will contain a JSON body.
|===

== Disable Two Factor

This API is used to disable Two Factor authentication for a single User. To use this API the User must provide a valid
Two Factor verification code.

If the User has configured `TextMessage` delivery, you may use the link:/docs/v1/tech/apis/two-factor#send-a-two-factor-code[Two Factor Send] API to deliver a
code to the User, the User will then provide this code as input.

=== Request

[.api-authentication]
link:/docs/v1/tech/apis/authentication#api-key-authentication[icon:lock[type=fas]] Disable Two Factor Authentication
[.endpoint]
.URI
--
[method]#DELETE# [uri]#/api/user/two-factor/`{userId}?code={code}`#
--

==== Request Parameters

[.api]
[field]#userId# [type]#[UUID]# [required]#Required#::
The Id of the User to enable Two Factor authentication.

[field]#code# [type]#[String]# [required]#Required#::
The time based one time use password, also called a Two Factor verification code.

include::docs/v1/tech/apis/_x-fusionauth-tenant-id-header-scoped-operation.adoc[]

[.api-authentication]
link:/docs/v1/tech/apis/authentication#jwt-authentication[icon:id-badge[type=fas]] Disable Two Factor Authentication
[.endpoint]
.URI
--
[method]#DELETE# [uri]#/api/user/two-factor``?code={code}``#
--

==== Request Parameters

[.api]
[field]#code# [type]#[String]# [required]#Required#::
The time based one time use password, also called a Two Factor verification code.

include::docs/v1/tech/apis/_x-fusionauth-tenant-id-header-scoped-operation.adoc[]

=== Response

[cols="1,9"]
.Response Codes
|===
|Code |Description

|200
|The request was successful. Two Factor has been disabled for the User.

|400
|The request was invalid and/or malformed. The response will contain an link:/docs/v1/tech/apis/errors/[Errors] JSON Object with the specific errors.

|401
|You did not supply a valid Authorization header. The header was omitted or your API key was not valid. The response will be empty. See link:/docs/v1/tech/apis/authentication/[Authentication].

|404
|The User does not exist. The response will be empty.

|421
|The `code` request parameter is not valid. The response will be empty.

|500
|There was an internal error. A stack trace is provided and logged in the FusionAuth log files. The response will be empty.

|503
|The search index is not available or encountered an exception so the request cannot be completed. The response will contain a JSON body.
|===

