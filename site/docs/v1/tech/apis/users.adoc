---
layout: doc
title: User APIs
description: APIs for creating, retrieving, updating, deleting, importing, searching for and verifying users
---

== Overview

This page contains all of the APIs for managing users.

* <<Create a User>>
* <<Retrieve a User>>
* <<Update a User>>
* <<Delete a User>>
* <<Bulk Delete Users>>
* <<Reactivate a User>>
* <<Import Users>>
* <<Search for Users>>
* <<Retrieve Recent Logins>>
* link:#verify-a-users-email[Verify a User's Email]
* <<Resend Verification Email>>
* <<Start Forgot Password Workflow>>
* link:#change-a-users-password[Change a User's Password]
* <<Flush the Search Engine>>


== Create a User

This API is used to create a new User.

=== Request

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Create a User with a randomly generated Id
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/user#
--

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Create a User with the provided unique Id
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/user/`\{userId\}`#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#userId# [type]#[UUID]# [optional]#Optional# [default]#defaults to secure random UUID#
|The Id to use for the new User. If not specified a secure random UUID will be generated.
|===

:http_method: POST
include::docs/v1/tech/apis/_user-request-body.adoc[]

=== Response

The response for this API contains the User that was just created. The password, salt and other sensitive fields will not be returned on the API response.

:webhook_event:
:create_user:
include::docs/v1/tech/apis/_standard-post-response-codes.adoc[]
:create_user!:
:webhook_event!:

include::docs/v1/tech/apis/_user-response-body.adoc[]


== Retrieve a User

This API is used to retrieve the information about a single User. You can use the User's Id, username or email address to retrieve the User. The Id is specified on the URI and the username or email are specified as URL parameters.

=== Request

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Retrieve a User by Id
[.endpoint]
.URI
--
[method]#GET# [uri]#/api/user/`\{userId\}`#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#userId# [type]#[UUID]# [required]#Required#
|The unique Id of the User to retrieve.
|===

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Retrieve a User by login Id
[.endpoint]
.URI
--
[method]#GET# [uri]#/api/user``?loginId=\{loginId\}``#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#loginId# [type]#[String]# [required]#Required#
|The unique Id of the User to retrieve. The loginId can be either the email or username.
|===

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Retrieve a User by email
[.endpoint]
.URI
--
[method]#GET# [uri]#/api/user``?email=\{email\}``#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#email# [type]#[String]# [required]#Required#
|The email of the User to retrieve.
|===

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Retrieve a User by username
[.endpoint]
.URI
--
[method]#GET# [uri]#/api/user``?username=\{username\}``#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#username# [type]#[String]# [required]#Required#
|The username of the User to retrieve.
|===

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Retrieve a User by Change Password Id
[.endpoint]
.URI
--
[method]#GET# [uri]#/api/user``?changePasswordId=\{changePasswordId\}``#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#changePasswordId# [type]#[String]# [required]#Required#
|The change password Id associated with the user when the Forgot Password workflow has been started.
|===

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Retrieve a User by Email Verification Id
[.endpoint]
.URI
--
[method]#GET# [uri]#/api/user``?verificationId=\{verificationId\}``#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#verificationId# [type]#[String]# [required]#Required#
|The verification Id associated with the user when the Email verification process has been started.
|===

[.api-authentication]
link:authentication#jwt-authentication[icon:id-badge[role=green]] Retrieve a User using a JWT
[.endpoint]
.URI
--
[method]#GET# [uri]#/api/user#
--

=== Response

The response for this API contains the User.

include::docs/v1/tech/apis/_standard-get-response-codes.adoc[]

include::docs/v1/tech/apis/_user-response-body.adoc[]


== Update a User

This API is used to update an existing User. You must specify the Id of the User you are updating on the URI. You must specify all of the properties of the User when calling this API. This API doesn't merge the existing User and your new data. It replaces the existing User with your new data.

If you specify a new password for the User, it will be encrypted and stored. However, if you do not provide a new password, the User's old password will be preserved. This is the only field that is merged during an update.

=== Request

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Update the User with the given Id
[.endpoint]
.URI
--
[method]#PUT# [uri]#/api/user/`\{userId\}`#
--

[NOTE.since]
This API has been available since 1.12.0

[.endpoint]
--
[method]#PATCH# [uri]#/api/user/`\{userId\}`#
--
_All request body parameters are optional for_ `PATCH`

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#userId# [type]#[UUID]# [required]#Required#
|The Id of the User to update.
|===

:http_method: PUT
include::docs/v1/tech/apis/_user-request-body.adoc[]
:http_method!:

=== Response

The response for this API contains the User that was updated. The password hash and other sensitive fields are never returned on the API response.

:webhook_event:
include::docs/v1/tech/apis/_standard-put-response-codes.adoc[]
:webhook_event!:

include::docs/v1/tech/apis/_user-response-body.adoc[]


== Delete a User

This API is used to delete a User. You must specify the Id of the User on the URI. You can also specify whether or not the User is soft or hard deleted. Soft deleted Users are marked as inactive but not deleted from FusionAuth.

=== Request

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Deactivate a User (Soft Delete)
[.endpoint]
.URI
--
[method]#DELETE# [uri]#/api/user/`\{userId\}`#
--
[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Permanently Delete a User
[.endpoint]
.URI
--
[method]#DELETE# [uri]#/api/user/`\{userId\}?hardDelete=true`#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#userId# [type]#[UUID]# [required]#Required#
|The Id of the User to delete.

|[field]#hardDelete# [type]#[Boolean]# [optional]#Optional# [default]#defaults to `false`#
|To Permanently delete a user from FusionAuth set this value to `true`. Once a user has been permanently deleted, the action cannot be undone. When this value is set to `false` the user is marked as inactive and the user will be unable log into FusionAuth. This action may be undone by reactivating the user.
|===

=== Response

This API does not return a JSON response body.

:webhook_event:
include::docs/v1/tech/apis/_standard-delete-response-codes.adoc[]
:webhook_event!:

== Bulk Delete Users
This API is used to deactivate or delete multiple users in a single request.

=== Request

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Deactivate Users by User Id
[.endpoint]
.URI
--
[method]#DELETE# [uri]#/api/user/bulk``?userId=\{userId\}&userId=\{userId\}``#
--

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Deactivate Users by Search Query
[.endpoint]
.URI
--
[method]#DELETE# [uri]#/api/user/bulk``?searchQuery=\{searchQuery\}&dryRun=false``#
--

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Permanently Delete Users by User Id
[.endpoint]
.URI
--
[method]#DELETE# [uri]#/api/user/bulk``?userId=\{userId\}&userId=\{userId\}&hardDelete=true``#
--

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Permanently Delete Users by Search Query
[.endpoint]
.URI
--
[method]#DELETE# [uri]#/api/user/bulk``?searchQuery=\{searchQuery\}&hardDelete=true&dryRun=false``#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#dryRun# [type]#[Boolean]# [optional]#Optional# [default]#defaults to `false`#
|To preview the user Ids to be deleted by the request without applying the requested action set this value to `true`.

|[field]#hardDelete# [type]#[Boolean]# [optional]#Optional# [default]#defaults to `false`#
|To Permanently delete a user from FusionAuth set this value to `true`. Once a user has been permanently deleted, the action cannot be undone. When this value is set to `false` the user is marked as inactive and the user will be unable log into FusionAuth. This action may be undone by reactivating the user.

|[field]#queryString# [type]#[String]# [optional]#Optional#
|The Elasticsearch query string that used to search for Users to be deleted. This parameter is required when the [field]#userId# parameter is not provided.

|[field]#userId# [type]#[UUID]# [optional]#Optional#
|The Id of the User to delete. Repeat this parameter for each user to be deleted. This parameter is required when the [field]#queryString# parameter is not provided.  When both the [field]#userId# and [field]#queryString# parameters are provided, the [field]#userId# value will be honored.
|===

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Bulk delete using the request body. This allows for larger requests than are possible using request parameters.
[.endpoint]
.URI
--
[method]#DELETE# [uri]#/api/user/bulk#
--

include::docs/v1/tech/apis/_user-bulk-delete-request-body.adoc[]


=== Response

The response for this API contains the information for the Users that were affected by the request.

:success_code: 200
:success_message: pass:normal[The request was successful. The response will contain a JSON body.]
:never_missing:
:webhook_event:
include::docs/v1/tech/apis/_standard-delete-response-codes.adoc[]
:webhook_event!:
:never_missing!:
:success_code!:
:success_message!:

include::docs/v1/tech/apis/_user-bulk-delete-response-body.adoc[]

== Reactivate a User

This API is used to reactivate an inactive Users. You must specify the Id of the User on the URI.

=== Request

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Reactivate the User
[.endpoint]
.URI
--
[method]#PUT# [uri]#/api/user/`\{userId\}?reactivate=true`#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#userId# [type]#[UUID]# [required]#Required#
|The Id of the User to reactivate.
|===

=== Response

The response for this API contains the information for the User that was reactivated.

:webhook_event:
include::docs/v1/tech/apis/_standard-put-response-codes.adoc[]
:webhook_event!:

include::docs/v1/tech/apis/_user-response-body.adoc[]


== Import Users

This API is used to bulk import multiple Users into FusionAuth. Each User must have at least an **email** or a **username**. This request is useful for migrating data from an existing database into FusionAuth. Additionally, you can provide an Id for each User inside the JSON User object of the request body.

=== Request

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Import Multiple Users
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/user/import#
--

include::docs/v1/tech/apis/_users-request-body.adoc[]

=== Response

Only a status code is available on the Import API, no JSON body will be returned.

:webhook_event:
include::docs/v1/tech/apis/_standard-post-response-codes.adoc[]
:webhook_event!:

== Search for Users

This API is used to search for Users. This API may be called using the `GET` or `POST` HTTP methods, examples of each are provided below. The `POST` method is provided to allow for a richer request object without worrying about exceeding the maximum length of a URL. Calling this API with either the `GET` or `POST` HTTP method will will provide the same search results given the same query parameters.

=== Request

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Search for Users by Id
[.endpoint]
.URI
--
[method]#GET# [uri]#/api/user/search``?ids=\{uuid\}&ids=\{uuid\}``#
--

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Search for Users by a query string
[.endpoint]
.URI
--
[method]#GET# [uri]#/api/user/search``?queryString=\{queryString\}``#
--

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Search for Users by a query string and sort the response
[.endpoint]
.URI
--
[method]#GET# [uri]#/api/user/search``?queryString=\{queryString\}&sortFields[0].name=\{name\}&sortFields[0].order=\{order\}``#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#ids# [type]#[UUID]# [optional]#Optional#
|A User Id to retrieve. By specifying this URL parameter multiple times you can lookup multiple Users. Using this parameter is mutually exclusive with the `queryString` and is not paginated or sorted using the `sortFields`.

Using this parameter will not hit the Elasticsearch index, instead it will cause users to be retrieved by Id only.

|[field]#numberOfResults# [type]#[Integer]# [optional]#Optional# [default]#defaults to `25`#
|The number of search results to return. Used for pagination.

|[field]#queryString# [type]#[String]# [optional]#Optional#
|The Elasticsearch query string that used to search for Users.

|[field]#startRow# [type]#[Integer]# [optional]#Optional# [default]#defaults to 0#
|The start row within the search results to return. Used for pagination.

|[field]#sortFields# [type]#[Array]# [optional]#Optional#
|An array of sort fields used to sort the result. The order the sort fields are provided will be maintained in the sorted output.

|[field]#sortFields``[x]``.missing# [type]#[String]# [optional]#Optional# [default]#defaults to `_last`#
|The value to substitute if this field is not defined. Two special values may be used:

* `_first` When the field is not defined sort this record first.
* `_last` When the field is not defined sort this record last.

|[field]#sortFields``[x]``.name# [type]#[String]# [required]#Required#
|The name of the field to sort.

Due to how the search index is structured not all fields on the user are sortable. The following field names are supported.

* `birthDate`
* `email`
* `fullName`
* `insertInstant`
* `login`
* `tenantId`
* `username`

|[field]#sortFields``[x]``.order# [type]#[String]# [optional]#Optional# [default]#defaults to `asc`#
|The order to sort the specified field. Possible values are:

* `asc`
* `desc`
|===

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Search for Users using a JSON request body. This allows for larger requests than are possible using request parameters.
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/user/search#
--

include::docs/v1/tech/apis/_user-search-request-body.adoc[]

=== Response

The response contains the User objects that were found as part of the lookup or search.

include::docs/v1/tech/apis/_standard-get-response-codes.adoc[]

:search_result:
include::docs/v1/tech/apis/_users-response-body.adoc[]
:search_result!:

== Retrieve Recent Logins

[NOTE.since]
====
Available Since Version 1.4.0
====

This API is used to retrieve recent logins.

=== Request

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Retrieve recent logins
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/user/recent-login``?limit=\{limit\}&offset=\{offset\}&userId=\{userId\}``#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#limit# [type]#[Integer]# [optional]#Optional# [default]#defaults to `10`#
|This parameter indicates the maximum amount of logins to return for a single request.

|[field]#offset# [type]#[Integer]# [optional]#Optional# [default]#defaults to `0`#
|This parameter provides the offset into the result set. Generally speaking if you wish to paginate the results, you will increment this parameter on subsequent API request by the size of the `limit` parameter.

|[field]#userId# [type]#[UUID]# [optional]#Optional#
|This parameter will narrow the results to only logins for a particular user. When this parameter is omitted, the most recent logins for all of FusionAuth will be returned.
|===


=== Response

The response will contain recent logins containing no more than the value set by the `limit` parameter. By design, this API does not return the total number of results and only lets paginate through the results from newest to oldest.

include::docs/v1/tech/apis/_standard-get-response-codes.adoc[]

[cols="3a,7a"]
[.api]
.Response Body
|===
|[field]#logins# [type]#[Array]#
|A list of recent logins.

|[field]#logins``[x]``.applicationId# [type]#[UUID]#
|The unique Id of the application that is represented by this login record.

|[field]#logins``[x]``.applicationName# [type]#[String]#
|The name of the application at the time this record was created.

|[field]#logins``[x]``.instant# [type]#[Long]#
|The link:../reference/data-types#instants[instant] this login occurred.

|[field]#logins``[x]``.ipAddress# [type]#[String]#
|The IP address if provided during the login request.

|[field]#logins``[x]``.loginId# [type]#[String]#
|The User's email address or username at the time of the login request.

|[field]#logins``[x]``.userId# [type]#[UUID]#
|The unique Id of the user that is represented by this login record.
|===

[source,json]
.Example Response JSON
----
include::docs/src/json/users/recent-logins-response.json[]
----

== Verify a User's Email

This API is used to mark a User's email as verified. This is usually called after the User receives the verification email after they register and they click the link in the email.

=== Request

[.api-authentication]
link:authentication#no-authentication-required[icon:unlock-alt[role=green]] Verifies the User's email address using the `verificationId`.
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/user/verify-email/`\{verificationId\}`#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#verificationId# [type]#[String]# [required]#Required#
|The verification Id generated by FusionAuth used to verify the User's account is valid by ensuring they have access to the provided email address.
|===

=== Response

The response does not contain a body. It only contains one of the status codes below.

include::docs/v1/tech/apis/_standard-put-response-codes.adoc[]


== Resend Verification Email

This API is used to resend the verification email to a User. This API is useful if the User has deleted the email, or the verification Id has
 expired. By default, the verification Id will expire after 24 hours.

=== Request

[.api-authentication]
link:authentication#no-authentication-required[icon:unlock-alt[role=green]] Resend the verification email
[.endpoint]
.URI
--
[method]#PUT# [uri]#/api/user/verify-email``?email=\{email\}``#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#email# [type]#[String]# [required]#Required#
|The email address used to uniquely identify the User.
|===

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Resend the verification email using an API key
[.endpoint]
.URI
--
[method]#PUT# [uri]#/api/user/verify-email``?email=\{email\}&sendVerifyEmail=\{sendVerifyEmail\}``#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#email# [type]#[String]# [required]#Required#
|The email address used to uniquely identify the User.

|[field]#sendVerifyEmail# [type]#[Boolean]# [optional]#Optional# [default]#defaults to `true`#
|If you would only like to generate a new `verificationId` and return it in the JSON body without FusionAuth attempting to send the User an email
set this optional parameter to `false`.

This may be useful if you need to integrate the Email Verification process using a third party messaging service.
|===

=== Response

When authenticated using an API key a response body will be provided. If an API key was not used to authenticate the request no body is returned.

:success_code: 200
:success_message: The request was successful. The response will contain a JSON body if an API key was used for authentication. If no API key was provided no response body will be returned.
:403_message: The verify email functionality has been disabled. FusionAuth is unable to send Email Verification emails.
include::docs/v1/tech/apis/_standard-put-response-codes.adoc[]
:success_code!:
:success_message!:
:403_message!:

[cols="3a,7a"]
[.api]
.Response Body
|===
|[field]#verificationId# [type]#[String]#
|The email verification Id that was generated by this API request. This identifier may be used by the <<verify-a-user-s-email,Verify a Userâ€™s Email>> API.
This field is only returned in the JSON response body if the request was authenticated using an API key, if an API key is not used no response body is returned.
|===

[source,json]
.Example Response JSON
----
include::docs/src/json/users/resend-verify-email-response.json[]
----

== Start Forgot Password Workflow

This API is used to start the forgot password workflow for a single User.

For example, on your login form you may have a button for _Forgot your password_. This would be the API you would call to initiate the request for the user. If the email configuration is complete, the user will be sent the forgot password email containing a link containing the `changePasswordId`. The provided link should take the user to a form that allows them to change their password. This form should contain a hidden field for the `changePasswordId` generated by this API.

By default the `changePasswordId` is valid to be used with the link:#change-a-user-s-password[Change Password] API for 10 minutes. If a `404` is returned when using this Id to change the password, the workflow
will need to be started again to generate a new identifier. This duration can be modified using the System Configuration API or in the FusionAuth UI.

You may optionally authenticate this request with an API key to allow for some additional request parameters and the generated `changePasswordId` will be returned in the JSON body. This may be helpful if you wish to use your own email system or you have an alternative method to call the link:#change-a-user-s-password[Change Password] API.

[NOTE]
====
If FusionAuth sends an email to the user, it will either use the `email` top level property on the user or it will use a custom data attribute named `email` as well (i.e. `data.email`). This allows you to have a user that has no email address for login or have user's that share email addresses.
====

=== Request

[.api-authentication]
link:authentication#no-authentication-required[icon:unlock-alt[role=green]] Start the forgot password workflow without an API Key.
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/user/forgot-password#
--

[cols="3a,7a"]
[.api]
.Request Body
|===
|[field]#loginId# [type]#[String]# [required]#Required#
|The login identifier of the user. The login identifier can be either the `email` or the `username`. The username is not case sensitive.
|===

[source,json]
.Example Request JSON
----
include::docs/src/json/users/forgot-password-request.json[]
----

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Start the forgot password workflow using an API key
[.endpoint]
.URI
--
[method]#POST# [uri]#/api/user/forgot-password#
--

[cols="3a,7a"]
[.api]
.Request Body
|===
|[field]#changePasswordId# [type]#[String]# [optional]#Optional#
|The optional change password Id to be used on the <<change-a-user-s-password,Change a User's Password>> API.

It is recommended to omit this parameter and allow FusionAuth to generate the identifier. Use this parameter only if you must supply your own
value for integration into existing systems.

|[field]#loginId# [type]#[String]# [required]#Required#
|The login identifier of the user. The login identifier can be either the `email` or the `username`. The username is not case sensitive.

|[field]#sendForgotPasswordEmail# [type]#[Boolean]# [optional]#Optional# [default]#defaults to `true`#
|Whether or not calling this API should attempt to send the user an email using the Forgot Password Email Template. Setting this to
false will skip the email attempt and only set the `changePasswordId` for the user.
|===

[source,json]
.Example Request JSON
----
include::docs/src/json/users/forgot-password-request-advanced.json[]
----

=== Response

[cols="1,9"]
.Response Codes
|===
|Code |Description

|200
|The request was successful. A JSON response body will be provided when authenticated using an API key, when the API key has been omitted from the request, no response body is provided.

|400
|The request was invalid and/or malformed. The response will contain an link:errors[Errors] JSON Object with the specific errors.

|401
|You did not supply a valid Authorization header. The header was omitted or your API key was not valid. The response will be empty. See link:authentication[Authentication].

|403
|The forgot password functionality has been disabled. This is caused by an administrator setting the Forgot Password Email Template to the option _Feature Disabled_ under **Settings** -> **System** in FusionAuth.

|404
|The User could not be found.

|422
|The User does not have an email address, this request cannot be completed. Before attempting the request again add an email address to the user.

|500
|There was an internal error. A stack trace is provided and logged in the FusionAuth log files.

|503
|The search index is not available or encountered an exception so the request cannot be completed. The response will contain a JSON body.
|===

[cols="3a,7a"]
[.api]
.Response Body
|===
|[field]#changePasswordId# [type]#[String]#
|The change password Id that was generated by this API request. This identifier may be used by the <<change-a-user-s-password,Change Password>> API. This field is only returned in the JSON response body if the request was authenticated using an API key, if an API key is not used no response body is returned.
|===

[source,json]
.Example Response JSON
----
include::docs/src/json/users/forgot-password-response.json[]
----


== Change a User's Password

This API is used to change the User's password.

This API may be used as the second part of the Forgot Password workflow. For example, after the User is sent an email that contains a link to
 a web form that allows them to update their password you will call this API with the `changePasswordId` and their updated password. If the
  `changePasswordId` is valid then the User's password will be updated.

This API may also be used separately from the Forgot Password workflow by omitting the `changePasswordId` and using the `loginId` instead.

By default the `changePasswordId` is valid for 10 minutes after it was generated. If a `404` is returned when using the change password Id,
the workflow will need to be started again to generate a new identifier. This duration can be modified using the System Configuration API or in the FusionAuth UI.


[NOTE]
====
When this API successfully completes, all refresh tokens and outstanding Change Password Ids (i.e. `changePasswordId`) currently assigned to the user will be expired or revoked. This means
that if a user is using a refresh token they will be forced to re-authenticate with their new password.
====


=== Request

[.api-authentication]
link:authentication#no-authentication-required[icon:unlock-alt[role=green, title="No authentication required"]] Changes a User's password using the change password Id.

This usage is generally intended to be part of an email workflow and does not require authentication. The `changePasswordId` used on this API request will have been previously generated by the Start Forgot Password API or by using the Forgot Password workflow on the FusionAuth login page.

[.endpoint]
.URI
--
[method]#POST# [uri]#/api/user/change-password/`\{changePasswordId\}`#
--

[cols="3a,7a"]
[.api]
.Request Parameters
|===
|[field]#changePasswordId# [type]#[String]# [required]#Required#
|The `changePasswordId` that is used to identity the user after the Start Forgot Password workflow has been initiated.

If this `changePasswordId` was sent via an email to the User by FusionAuth during User create in order to set up a new password, or as
part of a Forgot Password request, then successful use of this identifier to change the User's password will implicitly complete Email Verification if not already verified.
|===

[cols="3a,7a"]
[.api]
.Request Body
|===
|[field]#currentPassword# [type]#[String]# [optional]#Optional#
|The User's current password. When this parameter is provided the current password will be verified to be correct.

|[field]#password# [type]#[String]# [required]#Required#
|The User's new password.
|===

[source,json]
.Example JSON Request
----
include::docs/src/json/users/change-password-request.json[]
----

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Changes a User's password using an email address or username.

This usage requires and API key and allows you to change any user's password if you have a unique email or username.

[.endpoint]
.URI
--
[method]#POST# [uri]#/api/user/change-password#
--

[cols="3a,7a"]
[.api]
.Request Body
|===
|[field]#currentPassword# [type]#[String]# [optional]#Optional#
|The User's current password. When this parameter is provided the current password will be verified to be correct.

|[field]#loginId# [type]#[String]# [required]#Required#
|The login identifier of the user. The login identifier can be either the `email` or the `username`. The username is not case sensitive.

When this value is provided it should be in place of the `changePasswordId` request parameter. If both the `changePasswordId` and `loginId` are provided on the request, the `changePasswordId` will take precedence.

|[field]#password# [type]#[String]# [required]#Required#
|The User's new password.
|===

[source,json]
.Example JSON Request
----
include::docs/src/json/users/change-password-request-api-key.json[]
----

[.api-authentication]
link:authentication#jwt-authentication[icon:id-badge[role=green]] Changes a User's password using a JWT

[NOTE.since]
====
Available Since Version 1.5.0
====

This API will use a JWT as authentication. See link:authentication#jwt-authentication[JWT Authentication] for examples of how you can send the JWT to FusionAuth.

A common use case for using this API with a JWT will be if you want to allow the user to change their own password. Specifically if you are attempting to perform this request in a frontend  browser that cannot store an API key.

Because changing a User's password will revoke all existing refresh tokens if you allow the user to change their password they will need to re-authenticate to stay logged into your application if you are utilizing JWTs and Refresh Tokens.

For this reason, this API will return a `oneTimePassword` that is intended to be used programatically after a Change Password request completes to keep the user logged in and provide a better user experience. A successful login will return you a new access token (JWT) and a refresh token. This will allow you to make the change password workflow seamless to the user.

[.endpoint]
.URI
--
[method]#POST# [uri]#/api/user/change-password#
--

[cols="3a,7a"]
[.api]
.Request Body
|===
|[field]#currentPassword# [type]#[String]# [required]#Required#
|The User's current password. This is required when using a JWT to change your password.

|[field]#password# [type]#[String]# [required]#Required#
|The User's new password.

|[field]#refreshToken# [type]#[String]# [optional]#Optional#
|The user's existing refresh token. If you have access to your current refresh token, it can be provided in the request body using this parameter. If the `refresh_token` cookie also exists and is present on the request it will take precedence over this parameter.

This parameter is used to determine if the `oneTimePassword` that is returned from this API will be eligible to request a refresh token when used by the Login API. If this parameter is not provided and no cookie is found on the request, a refresh token will not be provided on the Login response when using the returned `oneTimePassword`.
|===

[source,json]
.Example JSON Request
----
include::docs/src/json/users/change-password-request.json[]
----

=== Response

[cols="1,9"]
.Response Codes
|===
|Code |Description

|200
|The request was successful. Starting in version `1.5.0` a JSON response body will be returned unless the API was called with an API key was used with a `loginId`. Prior to version `1.5.0` a JSON body was not returned.

|400
|The request was invalid and/or malformed. The response will contain an link:errors[Errors] JSON Object with the specific errors.

|401
|You did not supply a valid Authorization header. The header was omitted or your API key was not valid. The response will be empty. See link:authentication[Authentication].

|404
|The User could not be found using the `changePasswordId` or `loginId` value from the request. If using the `changePasswordId` the id is either incorrect or expired. Another reason for this status code is that you have provided the `currentPassword` parameter and it does not match the current password.

|500
|There was an internal error. A stack trace is provided and logged in the FusionAuth log files.

|503
|The search index is not available or encountered an exception so the request cannot be completed. The response will contain a JSON body.
|===


[cols="3a,7a"]
[.api]
.Response Body
|===
|[field]#oneTimePassword# [type]#[String]# [since]#Available Since 1.5.0#
|A one time password that can be used as a substitute for your `loginId` and `password` on the Login API.

This JSON response body will only be returned when using a `changePasswordId` or JWT to change the password. When calling this API with an API key no response body will be returned.
|===

[source,json]
.Example Response JSON
----
include::docs/src/json/users/change-password-response.json[]
----


== Flush the Search Engine

This API is used to issue a flush request to the FusionAuth Search. This will cause any cached data to be written to disk. In practice it is unlikely
 you'll find a need for this API in production unless you are performing search requests immediately following an operation that modifies the index and
  expecting to see the results immediately.

=== Request

[.api-authentication]
link:authentication#api-key-authentication[icon:lock[role=red]] Flushes the Search Engine
[.endpoint]
.URI
--
[method]#PUT# [uri]#/api/user/search#
--

=== Response

The response does not contain a body. It only contains one of the status codes below.

include::docs/v1/tech/apis/_standard-post-response-codes.adoc[]
