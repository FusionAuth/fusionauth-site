---
layout: doc
title: SAML v2 & Aiven
description: Setting up Aiven to login using FusionAuth via SAML v2
navcategory: login-methods
---

== Overview

include::docs/v1/tech/samlv2/_saml_idp_note.adoc[]

=== Prerequisites

This document assumes you have a running instance of FusionAuth and a working Aiven application with a project already created. You will also need admin accounts for both to configure them correctly.

== Configure Aiven

=== Create team

First, we need to create a team where new users will be added to.

In your https://console.aiven.io/[Aiven console], browse to [breadcrumb]#Admin -> Organization# and click [uielement]#Create team# in the organization details section.

Set the [field]#Team name# as `Developers` and click [uielement]#Create team#. When arriving back to the teams page, click on the newly created team and go to the [uielement]#Projects and Roles# tab.

Click [uielement]#Add projects#, select the project, the desired [field]#Permission level# (e.g. `Developer`) and click [uielement]#Add project# to finish setting up the team.

=== Configure SSO

Go to the [breadcrumb]#Admin# page if you aren't there yet and click [breadcrumb]#Authentication# in the sidebar.

Click on the [uielement]#Add authentication method# button, name it `FusionAuth`, select `SAML` as the [field]#Method Type# and choose the `Developers` team you just created in [field]#Team to autojoin on signup#.

Click [uielement]#Add method# to save. Write down both [field]#Metadata URL# and [field]#ACS URL# values and click [uielement]#Finish#.

== Configure FusionAuth

=== Generating certificate

We need to generate a custom RSA certificate and upload it to your FusionAuth instance's Key Master.

To do so, there's a script in our https://github.com/FusionAuth/fusionauth-example-scripts[Example scripts GitHub repository] that can do all of this for you.

Before running it, you need to create an API Key in your FusionAuth instance. Browse to [breadcrumb]#Settings -> API Keys# and click icon:plus[role=ui-button green,type=fas].

Set the [field]#Description# as `Certificate generator` and locate `/api/key/import` in the [uielement]#Endpoints# section. Click the `POST` switch to enable it and confirm generating the key by clicking icon:save[role=ui-button blue,type=fas].

image::samlv2/aiven/create-api-key.png[Creating API Key.,width=1200]

After being redirected back to the [breadcrumb]#API Keys# page, click on the `Key` for the created item to reveal its actual value and copy it. You'll have to provide this value to the script soon.

image::samlv2/aiven/grab-api-key.png[Grabbing API Key.,width=1200,role=bottom-cropped]

Now that your application is ready, clone our https://github.com/FusionAuth/fusionauth-example-scripts[Example scripts GitHub repository] and execute the script located in `rsa-certificate`.

[source,shell]
---
$ git clone git@github.com:FusionAuth/fusionauth-example-scripts.git
$ cd fusionauth-example-scripts/rsa-certificate
$ ./generate-certificate
---

Answer the questions the script will ask you and make sure to give the key a meaningful name, like `Aiven key`. After finishing, you'll have a certificate in the Key Master in your FusionAuth instance ready to be used. The script will also print the generated certificate. Write it down.

=== Creating application

You need to create an application in your FusionAuth instance. Navigate to [breadcrumb]#Applications# and click icon:plus[role=ui-button green,type=fas] and name it `Aiven`. Go to the [breadcrumb]#SAML# tab and toggle the [field]#Enabled# switch. Paste the [field]#Metadata URL# and [field]#ACS URL# you copied from Aiven to [field]#Issuer# and [field]#Authorized redirect URLs# fields in your FusionAuth application, respectively.

.Mapping fields
[cols="1,1"]
|===
|Aiven|FusionAuth

|[field]#Metadata URL#
|[field]#Issuer#

|[field]#ACS URL#
|[field]#Authorized redirect URLs#
|===

Scroll down to the [uielement]#Authentication response# section and change the [field]#Signing key# to the `Aiven key` you created above.

Click icon:save[role=ui-button blue,type=fas] to save your application. When redirected to the [breadcrumb]#Applications# page, view your application details by clicking icon:search[role=ui-button green,type=fas].

In [uielement]#SAML v2 Integration details#, write down both [field]#Entity Id# and [field]#Login URL# fields.

== Finish Aiven configuration

Go back to the authentication methods in your https://console.aiven.io/[Aiven console] and click on `FusionAuth`, which still has a `PENDING CONFIGURATION` state until we finish setting it up.

Scroll down to the [uielement]#SAML config# section and click the [uielement]#Edit# button and fill in the information below.

* [field]#SAML IDP Url#: the [field]#Login URL# from your FusionAuth application.
* [field]#SAML Entity ID#: the [field]#Entity Id# from your FusionAuth application.
* [field]#SAML Signature Algorithm#: you can leave this blank.
* [field]#SAML Digest Algorithm#: you can leave this blank.
* [field]#SAML Field Mapping#: you can leave this blank.
* [field]#SAML Certificate#: paste the certificate you've copied from the `Generating certificate` two steps above.

Finally, click [uielement]#Edit method# to save the changes.

Scroll to the beginning of the page and click the [field]#Enable authentication method# switch to enable it.

Copy the [uielement]#Signup URL# from the [uielement]#Signup and link accounts URLs# section in the `FusionAuth` authentication method you created. You'll use it to test the integration and, if succeeded, share it with others to sign up to your Aiven application.

== Testing

Open the [uielement]#Signup URL# you copied above in an incognito tab or using another browser. You'll reach the signup page below.

image::samlv2/aiven/login-sso.png[Logging in to Aiven.,width=542,role=custom]

Click on [uielement]#Sign up with FusionAuth#, which will redirect you to the FusionAuth login page. Fill in your credentials and submit the form to be taken back to the Aiven console, already logged in and part of the `Developers` team.
